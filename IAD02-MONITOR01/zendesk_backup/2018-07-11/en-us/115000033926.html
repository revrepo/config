<h1>Image Optimization</h1>
<div class="row show-box wysiwyg-text-align-center" style="padding: 10px;">
<h1 class="wysiwyg-text-align-left"><span style="font-weight: 400;">Introduction</span></h1>
<p class="wysiwyg-text-align-left"><span class="wysiwyg-font-size-medium wysiwyg-color-black">Image optimization service was implemented through a commercial partnership with <a href="https://www.scientiamobile.com/">ScientiaMobile</a> and nuu:bit. The ScientiaMobile product is <a href="https://www.scientiamobile.com/page/imageengine">ImageEngine</a>. ImageEngine uses <a href="http://wurfl.sourceforge.net/">WURFL</a>, which is the industry standard for device detection. The WURFL Device Description Repository provides incredible accuracy as it was developed over 15 years containing over 45,000 device profiles. The ImageEngine implementation is currently native to the nuu:bit platform.  Each of the nuu:bit edge servers makes use of a custom Varnish module (written in C) and a set of VCLs rules to process the User Agent and deliver the best image for a given device/browser.   Having such a low level integration with the nuu:bit edge means short Time to First Byte when making the delivery decision.  </span></p>
<span class="wysiwyg-font-size-medium wysiwyg-color-black"><img src="https://support.nuubit.net/hc/en-us/article_attachments/115000080683/ImageEngineLogo.png" alt=""></span>
</div>
<div class="row show-box" style="padding: 10px;"><span class="wysiwyg-font-size-medium wysiwyg-color-black">With the current implementation, the actual image processing is centralized.  When a new device/browser makes a request for an image the first time, the edge nuu:bit’s logic sends a 307 redirect to the image processing engine. The first request will take a performance hit, much like a cache miss, but on a per device/browser basis.  Any subsequent requests for that image from that device type will be fetched from cache as the edge ImageEngine logic will know that the image has been processed and available. </span></div>
<div class="row show-box" style="padding: 10px;">
<span class="wysiwyg-font-size-medium wysiwyg-color-black">Running at scale, we see on average 20 different image variations (some devices/browsers will share the same optimizations), therefore it does not take long for the optimization to impact a given web property.</span>
<h3> </h3>
<ul>
<li><a href="#gettingstarted">Getting Started</a></li>
<li><a href="#hostname">Setup</a></li>
<li><a href="#originserver">Origin Server</a></li>
<li><a href="#formats">Formats and colors</a></li>
<li><a href="#usingIE">Using ImageEngine</a></li>
<li><a href="#automode">Auto Mode</a></li>
<li><a href="#directives">Directives</a></li>
<li><a href="#CDN">Content Delivery Network</a></li>
<li><a href="#bestpractice">Best Practices</a></li>
<li><a href="#native">ImageEngine and native apps</a></li>
<li><a href="#respimg">ImageEngine and Responsive Images</a></li>
<li><a href="#clienthints">Working with Client Hints</a></li>
<li><a href="#plugins">Plugins</a></li>
<li><a href="#examples">Examples</a></li>
</ul>
<h1>
<a name="gettingstarted"></a>Getting Started with ImageEngine</h1>
<p>ImageEngine is an intelligent Content Delivery Network for images. Mobile now account for the majority of web traffic in many countries. ImageEngine emphasizes image optimization for mobile use cases, and also demonstrates significant value for traditional desktop-based browsing.</p>
<p>Using ImageEngine will reduce the image payload significantly and increase the website's performance.</p>
<p>The easiest way to understand ImageEngine is to see it as an intelligent Content Delivery Network (CDN). The built-in intelligence automatically (or explicitly) optimizes images for the requesting device or browser. In most cases the data traffic generated by images will be reduced by 60-70 percent compared to the original images.</p>
<h2>
<a name="hostname"></a>Setting up</h2>
<p>The first step is to <a href="https://www.scientiamobile.com/page/imageengine">sign up for an ImageEngine account</a>. We offer free trials at our Pro tier. Our team will then reach out to you and provide you with an account and a unique hostname for the service. Your hostname will follow this template:</p>
<pre><code>  {token}.imgeng.in
</code></pre>
<p>For example: <code>abcd.imgeng.in</code></p>
<p>Our team will also provide you with access to a <a href="https://www.scientiamobile.com/myaccount">dashboard</a> with statistics and configuration options to suit your needs.</p>
<p>Your account is now ready for use. Note that there are two ways the account can be set up:</p>
<ol>
<li>
<strong>Use the <code>abcd.imgeng.in</code> hostname directly</strong><br> For example: <code>http://abcd.imgeng.in/http://example.com/image.jpeg</code>. Easy way to get started.</li>
<li>
<strong><a name="cname"></a>Point your own custom domain to the unique ImageEngine hostname (Create a CNAME record in your DNS).</strong><br> You can point your own domain, for example <code>images.example.com</code>, to <code>abcd.imgeng.in</code> (or any other hostname provided by ScientiaMobile). This will enable you to refer to images like this: <code>http://images.example.com/images/image.jpeg</code>
</li>
</ol>
<p>Our team will assist with setting up your account to your needs.</p>
<h2>
<a name="originserver"></a>Origin server</h2>
<p>The original image must be available on a publicly available URL. As ImageEngine is a "pull-based" CDN, there is no need to upload or publish images in any specific way. The only requirement is that each image is reachable through its own URL.</p>
<p>Your origin image can be in any of the following formats:</p>
<ul>
<li>PNG</li>
<li>GIF</li>
<li>JPG</li>
<li>BMP</li>
<li>WEBP</li>
<li>JPEG2000</li>
<li>SVG <sup>*</sup>
</li>
<li>TIF</li>
</ul>
<p>*) SVG files are not resized or converted, just optimized and compressed.</p>
<p>Do note that the maximum file size of origin images is <strong>5 MB</strong>. It is also good practice to publish images in high resolution to account for high DPI devices.</p>
<p>ImageEngine will pull images on demand from the origin server and cache them according to the caching directives in the HTTP header. You may configure many aspects of ImageEngine by tweaking the HTTP headers on your origin servers. Also, do note that ImageEngine will pass on most of the HTTP headers from the origin server to the client (cookies are not passed on).</p>
<p>Because ImageEngine is pull-based, the first time an image is requested the response may be slower than usual. This is because ImageEngine will first have to download the image from the origin, transform it, and then cache it on the edge servers. This will of course normalize as the cache gets populated. Given this behavior, it should be noted that your origin may be bombarded with requests when ImageEngine is launched on the site for the first time because the cache needs to populate. Please discuss this with our support team before launch. Once fully operational, the ImageEngine CDN cache typically handles 98% of the traffic, while the origin servers see only 2% of the actual traffic.</p>
<h2>
<a name="formats"></a>Input ColorSpaces Supported</h2>
<table>
<thead>
<tr>
<th>Image Format</th>
<th>Greyscale</th>
<th>Indexed Color</th>
<th>RGB</th>
<th>sRGB</th>
<th>CMYK</th>
</tr>
</thead>
<tbody>
<tr>
<td>JPG</td>
<td>Y</td>
<td>N/A</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>JPG2000</td>
<td>Y</td>
<td>N/A</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>WEBP</td>
<td>Y</td>
<td>N/A</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>GIF</td>
<td>Y</td>
<td>Y</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr>
<td>8-Bit PNG</td>
<td>Y</td>
<td>Y</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr>
<td>24-Bit PNG</td>
<td>Y</td>
<td>N/A</td>
<td>Y</td>
<td>Y</td>
<td>N/A</td>
</tr>
<tr>
<td>BMP</td>
<td>Y</td>
<td>N/A</td>
<td>Y</td>
<td>Y</td>
<td>N/A</td>
</tr>
<tr>
<td>TIFF</td>
<td>Y</td>
<td>N/A</td>
<td>Y</td>
<td>Y</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h2>Output ColorSpaces Supported</h2>
<table>
<thead>
<tr>
<th>Image Format</th>
<th>Greyscale</th>
<th>Indexed Color</th>
<th>RGB</th>
<th>sRGB</th>
<th>CMYK</th>
</tr>
</thead>
<tbody>
<tr>
<td>JPG</td>
<td>Y</td>
<td>N/A</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>JPG2000</td>
<td>Y</td>
<td>N/A</td>
<td>Y</td>
<td>Y</td>
<td>N/A</td>
</tr>
<tr>
<td>JPGXR</td>
<td>Y</td>
<td>N/A</td>
<td>Y</td>
<td>Y</td>
<td>N/A</td>
</tr>
<tr>
<td>WEBP</td>
<td>Y</td>
<td>N/A</td>
<td>Y</td>
<td>Y</td>
<td>N/A</td>
</tr>
<tr>
<td>GIF</td>
<td>Y</td>
<td>Y</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr>
<td>8-Bit PNG</td>
<td>Y</td>
<td>Y</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr>
<td>24-Bit PNG</td>
<td>Y</td>
<td>N/A</td>
<td>Y</td>
<td>Y</td>
<td>N/A</td>
</tr>
<tr>
<td>BMP</td>
<td>Y</td>
<td>N/A</td>
<td>Y</td>
<td>Y</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<p>Embedded meta data, such as EXIF, is removed as a part of the optimization process. If you want to keep the meta data in the optimized image, use the <code>meta_true</code> directive or the <code>pass_true</code> directive. For <code>jpeg</code> images the ICC profile is maintained in the optimized image. Colors may change slightly if the image is converted between formats. If it is important for the optimized image to exactly match the colors of the origin image (rare cases), the origin image should be a <code>jpeg</code> and you should specify the format with the <code>f_jpeg</code> directive. That said, in most cases color shifting is not an issue.</p>
<h1>
<a name="usingIE"></a>Using ImageEngine</h1>
<p>Once the account is created, origin server is online, and integration method is chosen, ImageEngine is ready to be implemented on your site(s) or app(s). ImageEngine offers a fully automated mode and a customizable mode where you can specify how an image is treated.</p>
<h2>
<a name="automode"></a>Auto mode</h2>
<p>Depending on your configuration, you may need to make changes to the HTML on your web site and/or the way images are displayed in native apps.</p>
<p>If you have an <code>img</code> tag like this:</p>
<pre><code>  &lt;img src="//example.com/img/car.jpeg"&gt;
</code></pre>
<p>You will need to prepend the URL with your unique ImageEngine hostname:</p>
<pre><code>  &lt;img src="//try.imgeng.in/http://example.com/img/car.jpeg"&gt;
</code></pre>
<p>If your account is set up with CNAME, the image tags may look like this:</p>
<pre><code>  &lt;img src="//images.example.com/img/car.jpeg"&gt;
</code></pre>
<p>In the case of CNAME, the origin - location of your original images - is registered in the account settings.</p>
<p>The examples above demonstrate the full automated optimization. In most cases, these are the recommended way to use the ImageEngine CDN.</p>
<p>The automatic optimization process is quite complex and and uses WURFL, Client Hints, and other available information to determine the optimal size, resolution, compression, and format. Auto-mode works well for desktop devices, and even better for mobile devices, due to the diversity of sizes, resolutions, and capabilities.</p>
<h3>Device intelligence in action</h3>
<p>In auto-mode, the most notable optimizations done to an image are format conversion, change in pixel size, and compression rate. ImageEngine in auto-mode will make sure that your customers get the highest quality image with the lowest possible byte-size.</p>
<h3>Format conversion</h3>
<p>Thanks to ImageEngine's built in device detection (WURFL), it will choose the most efficient format for a given image. The input needed to make this decision comes from WURFL device detection, manual verification, and an advanced rule set. For example, ImageEngine can accurately identify devices and browsers that support the WEBP format. This means ImageEngine can confidently convert from JPEG to WEBP, deliver huge savings in terms of byte size, and dramatically improve the web browsing experience.</p>
<h3>Resizing</h3>
<p>On the web today, where the majority of traffic comes from mobile devices, one size is not enough to offer a great user experience. Again, the built-in device detection knows the size of the screen - both in pixels and millimeters - and is able to resize the image to perfectly fit the viewport. This is further enhanced by ImageEngine's support for <a href="#clienthints">Client Hints</a>. It can also handle high resolution displays, like Retina, out of the box and will scale the image at the actual pixel size needed to produce high quality images.</p>
<h3>Compression</h3>
<p>Depending on the screen size (in inches or millimeters) and the resolution of the screen, different amounts and types of compression can be applied without compromising the visual quality of the image. Furthermore, if <a href="#clienthints">Client Hints</a> give indications that additional data should be saved, ImageEngine automatically applies more compression.</p>
<h2>
<a name="directives"></a>Directives</h2>
<p>Directives are commands you can pass to ImageEngine in the URL which explicitly instructs ImageEngine on what to do with the image. In other words, directives override the automated decisions made by ImageEngine. In most cases it's best to leave the discussions to ImageEngine. For example, if you explicitly ask for an image to be served as webp, <strong>all</strong> devices will get webp, even those not supporting it. However, if there are cases where you need explicit control, directives will save you.</p>
<p>Directives can be "mixed and matched" and some work only when others are present too. For example, fit methods are dependent on height and/or width directives.</p>
<p>Furthermore, some directives are not compatible with each others. For example <code>/w_100/pc_100/</code> instructs ImageEngine to serve the images as 100px wide and 100% of screen size. In this case <code>w_100</code> will have precedence because it is more specific.</p>
<p>There are two ways to make use of directives. You can append directives in the query string using the <code>imgeng</code> parameter (if you have a CNAME record pointing to your ImageEngine hostname, this is the only option):</p>
<pre><code>&lt;img src="<span style="color: green;">//images.example.com</span><span style="color: red;">/images/image.jpeg</span>?<span style="color: blue;">imgeng=/f_webp/w_300/</span>"&gt;</code></pre>
<p>The above example will produce a webp image 300px wide.</p>
<table>
<thead>
<tr>
<th>Section</th>
<th>Values</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><span style="color: green;">Your hostname</span></td>
<td>URL</td>
<td>Your hostname with a CNAME record pointing to the ImageEngine hostname.</td>
</tr>
<tr>
<td><span style="color: red;">Image path</span></td>
<td>Path</td>
<td>Path to image relative from your origin host.</td>
</tr>
<tr>
<td><span style="color: blue;">ImageEngine directives</span></td>
<td>
<code>key_value</code> pairs</td>
<td>These settings instruct ImageEngine what transformations are expected. Optional.</td>
</tr>
</tbody>
</table>
<p>If your using the ImageEngine hostname directly, directives can also be in the path:</p>
<pre><code>&lt;img src="<span style="color: green;">//try.imgeng.in</span>/<span style="color: blue;">w_300/f_webp</span>/<span style="color: red;">http://jelly.com/bread.png</span>"&gt;</code></pre>
<p>The above example will produce a webp image 300px wide.</p>
<table>
<thead>
<tr>
<th>Section</th>
<th>Values</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><span style="color: green;">ImageEngine URL</span></td>
<td>URL</td>
<td>This is the URL of the ImageEngine service.</td>
</tr>
<tr>
<td><span style="color: blue;"> ImageEngine directives </span></td>
<td>
<code>key_value</code> pairs</td>
<td>These settings instruct ImageEngine what transformations are expected. Optional.</td>
</tr>
<tr>
<td><span style="color: red;">Image URL</span></td>
<td>URL</td>
<td>This is the image that is to be displayed. The image itself does not need to be on the client site.</td>
</tr>
</tbody>
</table>
<h3>
<a name="directiveslist"></a>List of supported directives</h3>
<p>Supported directives are listed and explained below.</p>
<table>
<thead>
<tr>
<th>Directive</th>
<th>Name</th>
<th>Value</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>w</code></td>
<td>Width</td>
<td>Integer</td>
<td>Desired width in pixels of resized picture. <sup>1</sup> <sup>2</sup>
</td>
<td><code>/w_200/</code></td>
</tr>
<tr>
<td><code>w_auto</code></td>
<td>Auto width with fallback</td>
<td>Integer</td>
<td>ImageEngine will try to automatically detect the best size based on Client Hints. If no reliable size is found, it will fall back to the pixel size specified. <sup>2</sup>
</td>
<td><code>/w_auto,200/</code></td>
</tr>
<tr>
<td><code>h</code></td>
<td>Height</td>
<td>Integer</td>
<td>Desired height in pixels of resized picture. <sup>1</sup> <sup>2</sup>
</td>
<td><code>/h_200/</code></td>
</tr>
<tr>
<td><code>cmpr</code></td>
<td>Compression</td>
<td>Integer (0-100)</td>
<td>Amount of compression to apply. Values 0 (less compression) to 100 (maximum compression). Note that the value will have different impact on different file formats and that too much compression will have impact on visual quality.</td>
<td><code>/cmpr_50/</code></td>
</tr>
<tr>
<td><code>f</code></td>
<td>Format</td>
<td>
<code>jpg</code>, <code>gif</code>, <code>png</code>, <code>bmp</code>, <code>webp</code>, <code>jpegxr</code>,<code>jp2</code>
</td>
<td>Desired format of image. Note that even if the file extension say for example <code>jpeg</code>, the HTTP header <code>content-type</code> will have the correct mime type of the requested format.</td>
<td><code>/f_webp/</code></td>
</tr>
<tr>
<td><code>m</code></td>
<td>Fit method</td>
<td>
<code>stretch</code>, <code>box</code>, <code>letterbox</code>, <code>cropbox</code>
</td>
<td>Used together with <code>w_*</code> and/or <code>h_*</code> to decide how to fit the image.</td>
<td>
<code>/m_box/</code> <code>/m_letterbox_ff0000_50/</code>
</td>
</tr>
<tr>
<td><code>pass</code></td>
<td>Pass through</td>
<td><code>true</code></td>
<td>When set, ImageEngine will pass through the origin image unmodified.</td>
<td><code>/pass_true</code></td>
</tr>
<tr>
<td><code>s</code></td>
<td>Sharpness</td>
<td>Integer (0-100)</td>
<td>Adjust the sharpness of the image. Values from <code>0</code> (no sharpening) to <code>100</code> (maximum sharpening).</td>
<td><code>/s_20/</code></td>
</tr>
<tr>
<td><code>r</code></td>
<td>Rotate</td>
<td>Integer</td>
<td>Will rotate the image by provided degrees. Values from -360 to 360.</td>
<td><code>/r_20/</code></td>
</tr>
<tr>
<td><code>pc</code></td>
<td>Percentage of screen</td>
<td>1-100 (float)</td>
<td>This field will use WURFL to calculate the screen width and then scale the image accordingly. <sup>2</sup>
</td>
<td><code>/pc_50/</code></td>
</tr>
<tr>
<td><code>cr</code></td>
<td>Crop</td>
<td>Integers</td>
<td>The four crop arguments are: <strong>width</strong>, <strong>height</strong> of final image, <strong>left</strong> and <strong>top</strong> (pixels from the left and top edges of the image). Note that this function does not scale the image to fit inside width and height.</td>
<td><code>/cr_10,10,100,100/</code></td>
</tr>
<tr>
<td><code>in</code></td>
<td>Inline</td>
<td><code>true</code></td>
<td>Return the image as a base64 encoded string for use in data urls</td>
<td><code>/in_true/</code></td>
</tr>
<tr>
<td><code>meta</code></td>
<td>Strip EXIF data</td>
<td><code>true</code></td>
<td>Set to <code>true</code> to maintain EXIF data. ICC profile will always be kept.</td>
<td><code>/meta_true/</code></td>
</tr>
</tbody>
</table>
<p><sup>1</sup>) If a fit method is not specified, and only width or height is specified, it will select "box". If both width and height are specified, but fit is not explicitly specified, then it will assume the fit method is "stretch". <br> <sup>2</sup>) The target pixel size is actual intrinsic pixels ("CSS pixels") and does not account for high DPI screens. For example, if you request a 200 px wide image for a screen with <code>DPR: 2</code>, the image will still be 200 px wide, not 400 px. </p>
<h4>Fit methods</h4>
<p><code>box</code> scales the image to fit within the specified dimensions. Note that the image that is returned will not necessarily be the same size as the requested dimensions, but it will fit inside a box of those dimensions</p>
<p><code>cropbox</code> method will resample the image as small as possible while showing no canvas. This will result in some cropping if the source and output aspect ratios differ.</p>
<p><code>letterbox</code> is the same as box, except the returned image is the exact specified size. Bars of white are placed around the image if necessary, but the image will not be scaled up. To use a color other than white, you can specify the HEX color code after the letterbox directive, like this for red: /m_letterbox_ff0000/. The canvas opacity can also be specified for images that support transparency. This is would be specified as a third parameter of m: <code>/m_letterbox_ff0000_65/</code></p>
<p><code>stretch</code> will change aspect ratio of the image to fill the new canvas defined by <code>w_*</code> and <code>h_*</code>.</p>
<p>Examples:</p>
<p><code>m_box</code></p>
<p><img src="/img/wit/Fit-Modes-Examples-Box.jpg" alt="Box"></p>
<p><code>m_cropbox</code></p>
<p><img src="/img/wit/Fit-Modes-Examples-Cropbox.jpg" alt="Cropbox"></p>
<p><code>m_letterbox</code></p>
<p><img src="/img/wit/Fit-Modes-Examples-Letterbox.jpg" alt="Letterbox"></p>
<p><code>m_stretch</code></p>
<p><img src="/img/wit/Fit-Modes-Examples-Stretch.jpg" alt="Stretch"></p>
<h2>Testing and Monitoring</h2>
<p>A general recommendation on how to test and monitor the effect and performance of ImageEngine is to continue to use the same tools you're currently using. This will give the best before-and-after comparison. It is recommended to use both real user metrics (RUM) and syntetic testing. Ultimately, according to the majority of studies done on the topic, a faster loading site will also be visible in business metrics like increased conversion rates, lower bounce rate, cart size, page views per session etc. However, there are a few things to keep in mind when setting up monitoring.</p>
<h3>Size, format and compression are dynamic</h3>
<p>The size, format and compression (and then also the byte size) of a specific image will vary based on quite a few variables. At the very least make sure to test</p>
<ul>
<li>
<code>User-Agents</code> on different devices with different screen sizes and resolutions</li>
<li>
<code>User-Agents</code> on different operating systems and versions</li>
<li>
<code>User-Agents</code> with- and without support for Client Hints</li>
</ul>
<p>For development and simple testing <code>curl</code> is a useful tool. Here is a sample command:</p>
<pre><code>curl  \
    -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8" \
    -H "DPR: 2" \
    -H "Width: 200" \
    -H "Viewport-Width: 400" \
    -A "Mozilla/5.0 (Linux; Android 5.1.1; Nexus 6 Build/LYZ28E) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Mobile Safari/537.36"  \
    -I http://try.imgeng.in/http://wurfl.github.io/i/pencils.jpg
</code></pre>
<p>This example include Client Hints in the request. Change the <code>User-Agent</code> and the additional HTTP header fields and note the difference in the response. Pay special attention to the response headers <code>Content-Type</code>, <code>Content-Length</code> and <code>Content-DPR</code> and see how it changes for different requests for the same image.</p>
<h3>Tools</h3>
<p>Even if <a href="#managementc">the management console</a> will keep track of bytes saved, it might be useful to see the numbers from different perspectives. Here is a list of tools which are useful when monitoring page speed:</p>
<ul>
<li><a href="http://www.webpagetest.org/">WebPageTest</a></li>
<li><a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed Insights</a></li>
<li><a href="https://gtmetrix.com/">GTmetrics</a></li>
<li><a href="https://developer.chrome.com/devtools">Chrome Devtools</a></li>
</ul>
<h2>
<a name="CDN"></a>Content Delivery Network</h2>
<p>The ImageEngine CDN spans over 40 Points of Presence (POPs), located around the globe, to deliver your digital content fast. Coupled with the added benefits of our API structure, you are in control of every aspect of delivery.</p>
<h3>Functionality</h3>
<p>In addition to image delivery, the CDN can also cache and serve other kinds of content, including HTML, CSS, and JavaScript. It is a fully fledged CDN with all the necessary features to keep your site safe, fast, and available. Additional highlights include:</p>
<ul>
<li>TCP Acceleration</li>
<li>Intelligent analytics that provides visibility to network performance and traffic diagnostics</li>
<li>Web Application Firewall security services</li>
<li>Mobile SDK, acceleration to the true edge, the device, using our Xamarin, iOS, and Android SDKs</li>
</ul>
<h3>
<a name="managementc"></a>Management console</h3>
<p>You will have access to a web interface where you can manage your account, tune the settings, see real time statistics, and more. For example, you can see how much data ImageEngine has saved you:</p>
<p><img src="//img.imgeng.in/w_auto,600/https://docs.scientiamobile.com/img/IEstats.jpg" alt="ImageEngine stats"></p>
<h3>API</h3>
<p>In addition to the management console, all important aspects of the CDN can be managed through our APIs. Examples of operation are:</p>
<ul>
<li>Account management</li>
<li>DNS management</li>
<li>Domain configuration</li>
<li>Location management</li>
<li>Log shipping</li>
<li>SSL management</li>
<li>Staging environment management</li>
<li>Statistics</li>
<li>Security operations</li>
</ul>
<h1>
<a name="bestpractice"></a>Best Practices</h1>
<p>While there are no strict requirements on how to use ImageEngine, below is a list of best practices to get the most out of ImageEngine.</p>
<h2>Always define display size of images</h2>
<p>In your markup, you should always specify a display pixel size (width and height) in the image tags. Either by the width attribute or CSS styles. Additionally, if you've implemented <a href="#respimg">Responsive Images</a> on your site, include the <code>sizes</code> attribute.</p>
<p>In some cases, ImageEngine may return a bigger image than expected to cater to high DPI screens. If the design of the page expects a 400 pixel wide image and ImageEngine returns a 800 pixel wide image for devices with a pixel ratio of 2, the design may be broken if the markup does not define a display size of the image. Similar situations may occur when using <a href="#clienthints">Client Hints</a>.</p>
<h2>Origin image in high resolution</h2>
<p>If your publishing -system or -workflow supports it, and based on the design of you page, origin images should be of higher resolution than you strictly need. For example, if your design has a hero image with a display width of 1000 pixels (CSS pixels), ImageEngine will try to serve this image at 2000 pixels width for screens with a pixel ratio of 2. Because ImageEngine does not scale images up, the origin image need to be at least 2000 physical pixels wide in order to get the best possible quality. See also <a href="#clienthints">Client Hints</a>.</p>
<h2>Use Auto mode</h2>
<p>In most cases using ImageEngine without <a href="#directives">directives</a> is the best option. Only use directives for specific cases. When you use directives, some, or all, of the built in optimization logic may not be applied. For example, if you specify <code>/f_webp/</code> all devices/browsers, even those not supporting webp, will be served a webp image.</p>
<h2>Use Resource Hints</h2>
<p><a href="https://w3c.github.io/resource-hints/">Resource Hints</a> will speed up the connection to ImageEngine by telling the browser as early as possible to connect to the ImageEngine server. This way, the browser will have the connection open when it is needed later. Resource hints are enabled in the <code>&lt;head&gt;</code> section of your markup this:</p>
<pre><code>&lt;link rel="preconnect" href="//images.example.com" crossorigin&gt;
</code></pre>
<p>Or alternatively in the HTTP response headers of your web server like this:</p>
<pre><code>Link: &lt;//images.example.com&gt;; rel=preconnect
</code></pre>
<h2>Use a CNAME DNS record</h2>
<p>Why use a CNAME DNS record? A CNAME DNS record does not expose the originImageEngine hostname directly, so it appears more secure. In terms of functionality, there is no difference between using a <a href="https://docs.scientiamobile.com/documentation/ImageEngine/index#cname">CNAME'd hostname</a> versus the ImageEngine hostname directly. However, some of our <a href="https://docs.scientiamobile.com/documentation/ImageEngine/index#plugins">plugins</a> only work with the ImageEngine hostname.</p>
<h2>Use Responsive Images</h2>
<p>The main reason why ImageEngine benefits from Responsive Images syntax is <a href="#clienthints">Client Hints</a>. You can read more about <a href="#respimg">Responsive Images and ImageEngine</a> below.</p>
<p>Summarized, the <code>w_auto</code> <a href="#directives">directive</a>, and the <code>sizes</code> attribute is key. Here is an example:</p>
<pre><code>&lt;img src="//try.imgeng.in/w_auto,800/http://wurfl.github.io/i/pencilsx.jpg" sizes="90vw"&gt; 
</code></pre>
<p>If you need different sized images to be served, depending on viewport size, you can use media queries in the <code>sizes</code> attribute.</p>
<h2>
<a name="bpclienthints"></a>Use Client Hints</h2>
<p><a href="#clienthints">Client Hints</a> enable the browser to send more detailed information about what size the image should be, relative to the viewport size.</p>
<p>To enable Client Hints you'll have to explicitly enable it by adding the below <code>&lt;meta&gt;</code> tag to your <code>&lt;head&gt;</code> element:</p>
<pre><code>  &lt;meta http-equiv="Accept-CH" content="DPR, Viewport-Width, Width, Save-Data"&gt;
</code></pre>
<p>or adding a <code>Link</code> HTTP header in the response of the html:</p>
<pre><code>Accept-CH: DPR, Width, Viewport-Width, Save-Data
</code></pre>
<p>Using client hints and ImageEngine with responsive images will generate a perfectly sized and optimized image. However, note that the <code>Width</code> header is only sent if the browser is able to determine the intended display size of the image. Hence, you must provide a <code>sizes</code> attribute to the image tags. ImageEngine will only return <code>Content-DPR</code> when <code>Width</code> header is present in the request. If the origin image is smaller than the intended display size, <code>Content-DPR</code> will be &lt; 0 because ImageEngine does not scale images to larger sizes than the original.</p>
<p>The Client Hints <a href="http://httpwg.org/http-extensions/client-hints.html">specification can be found here</a>. For more details, please read this <a href="https://www.smashingmagazine.com/2016/01/leaner-responsive-images-client-hints/">article on Client Hints, Responsive Images and ImageEngine</a>.</p>
<h2>
<a name="native"></a> Native Apps: Use meaningful User Agents</h2>
<p>Optimizing images is equally important for apps. ImageEngine relies heavily on device detection. For this reason, it is important that applications (fully native or hybrids) provide meaningful <code>User-Agent</code>-strings in the request. For hybrid apps this is less of a challenge, but for fully native apps this issue must be addressed in order to avoid the default values.</p>
<p>The <code>User-Agent</code> for Andorid apps must follow this syntax:</p>
<pre><code>&lt;AppName&gt;/&lt;version&gt; Dalvik/&lt;version&gt; (Linux; U; Android &lt;android version&gt;; &lt;device ID&gt; Build/&lt;buildtag&gt;)
</code></pre>
<p>For example:</p>
<pre><code>Myapp/1 Dalvik/2.1.0 (Linux; U; Android 6.0.1; vivo 1610 Build/MMB29M)
</code></pre>
<p>The <code>User-Agent</code> for iOS apps must follow this syntax:</p>
<pre><code>&lt;AppName&gt;/&lt;version&gt; &lt;iDevice platform&gt;&lt;model identifier&gt; iOS/&lt;OS version&gt; CFNetwork/&lt;version&gt; Darwin/&lt;version&gt;
</code></pre>
<p>For example:</p>
<pre><code>MyApp/1 iPhone5,2 iOS/10_1 CFNetwork/808.3 Darwin/16.3.0
</code></pre>
<p>See the blog post <a href="https://www.scientiamobile.com/page/correctly-form-user-agent-for-mobile-apps">How to Correctly Form User-Agents for Mobile Apps</a> for more information.</p>
<h1>
<a name="respimg"></a>ImageEngine and Responsive Images</h1>
<p>ImageEngine is designed to make the work with <a href="https://www.smashingmagazine.com/2014/05/responsive-images-done-right-guide-picture-srcset/">responsive images</a> easier and more efficient. If you implement Responsive images "by the book", the markup and image logistics quickly become unmanageable long term. Still, responsive images solves critical issues regarding performance and art direction among other things. Thanks to <a href="https://developers.google.com/web/updates/2015/09/automating-resource-selection-with-client-hints">Client Hints</a> backed by <a href="https://www.scientiamobile.com">device detection</a> ImageEngine will <a href="https://www.smashingmagazine.com/2016/01/leaner-responsive-images-client-hints/">reduce complexity, make image logistics easier and, of course, speed up your site due to lower byte size of the images</a>. Below are a few examples.</p>
<p>Implementing responsive images on your site can quickly become a <a href="https://www.smashingmagazine.com/2016/01/leaner-responsive-images-client-hints/">difficult to maintain</a>.</p>
<p>TL;DR: With ImageEngine you can replace the image tag below...</p>
<pre><code>&lt;picture&gt;
  &lt;!-- serve WebP to Chrome and Opera --&gt;
  &lt;source
    media="(min-width: 50em)"
    sizes="50vw"
    srcset="/image/thing-200.webp 200w, /image/thing-400.webp 400w,
        /image/thing-800.webp 800w, /image/thing-1200.webp 1200w,
        /image/thing-1600.webp 1600w, /image/thing-2000.webp 2000w"
    type="image/webp"&gt;
  &lt;source
    sizes="(min-width: 30em) 100vw"
    srcset="/image/thing-crop-200.webp 200w, /image/thing-crop-400.webp 400w,
        /image/thing-crop-800.webp 800w, /image/thing-crop-1200.webp 1200w,
        /image/thing-crop-1600.webp 1600w, /image/thing-crop-2000.webp 2000w"
    type="image/webp"&gt;
  &lt;!-- serve JPEGXR to Edge --&gt;
  &lt;source
    media="(min-width: 50em)"
    sizes="50vw"
    srcset="/image/thing-200.jpgxr 200w, /image/thing-400.jpgxr 400w,
        /image/thing-800.jpgxr 800w, /image/thing-1200.jpgxr 1200w,
        /image/thing-1600.jpgxr 1600w, /image/thing-2000.jpgxr 2000w"
    type="image/vnd.ms-photo"&gt;
  &lt;source
    sizes="(min-width: 30em) 100vw"
    srcset="/image/thing-crop-200.jpgxr 200w, /image/thing-crop-400.jpgxr 400w,
        /image/thing-crop-800.jpgxr 800w, /image/thing-crop-1200.jpgxr 1200w,
        /image/thing-crop-1600.jpgxr 1600w, /image/thing-crop-2000.jpgxr 2000w"
    type="image/vnd.ms-photo"&gt;
  &lt;!-- serve JPEG to others --&gt;
  &lt;source
    media="(min-width: 50em)"
    sizes="50vw"
    srcset="/image/thing-200.jpg 200w, /image/thing-400.jpg 400w,
        /image/thing-800.jpg 800w, /image/thing-1200.jpg 1200w,
        /image/thing-1600.jpg 1600w, /image/thing-2000.jpg 2000w"&gt;
  &lt;source
    sizes="(min-width: 30em) 100vw"
    srcset="/image/thing-crop-200.jpg 200w, /image/thing-crop-400.jpg 400w,
        /image/thing-crop-800.jpg 800w, /image/thing-crop-1200.jpg 1200w,
        /image/thing-crop-1600.jpg 1600w, /image/thing-crop-2000.jpg 2000w"&gt;
  &lt;!-- fallback for browsers that don't support picture --&gt;
  &lt;img src="/image/thing.jpg" width="50%"&gt;
&lt;/picture&gt;
</code></pre>
<p>...with this...</p>
<pre><code>&lt;img src="//images.example.com/images/thing.jpg" sizes="50vw"&gt; 
</code></pre>
<h2>Retrofit your existing <code>img</code> tags</h2>
<p>The key to optimizing ImageEngine and responsive images is to enable <a href="#clienthints">Client Hints</a>. This will make supporting browsers send extra HTTP headers that ImageEngine can use with surgical precision to optimize the image. In addition to opting-in to Client Hints, you'll need to change your <code>&lt;img&gt;</code> tags slightly. If your current image tags look like this:</p>
<pre><code>&lt;img src="//images.example.com/images/thing.jpg" width="200px"&gt; 

</code></pre>
<p>You'll need to add the <code>sizes</code> attribute:</p>
<pre><code>&lt;img src="//images.example.com/images/thing.jpg" width="200px" sizes="200px"&gt; 

</code></pre>
<p>By adding the <code>sizes</code> attribute, the browser will be able to figure out the value of the <code>width</code> Client Hint header, which will be added to the image request. For browsers that don't support Client Hints, you can use the <code>w_auto</code> <a href="#directives">directive</a>:</p>
<pre><code>&lt;img src="//images.example.com/images/thing.jpg?imgeng?/w_auto,200/" width="200px" sizes="200px"&gt; 
</code></pre>
<p>If ImageEngine is unable to determine an accurate size for the image, the fallback will be 200 pixels. Of course, you can add media queries in the <code>sizes</code> attribute too:</p>
<pre><code>&lt;img src="//images.example.com/images/thing.jpg?imgeng?/w_auto,200/" syle="@media  {(min-width: 30em) 200px, 500px;}" sizes="(min-width: 30em) 200px, 500px"&gt; 
</code></pre>
<p>Regarding the above example, don't worry about the "format switching", <code>&lt;source type="image/webp" srcset="..."&gt;</code>. ImageEngine will automatically handle this based on the browser's capabilities.</p>
<h1>
<a name="clienthints"></a>Working with Client Hints</h1>
<p>ImageEngine supports the following Client Hints:</p>
<table>
<thead>
<tr>
<th>Client Hint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DPR</code></td>
<td>Device Pixel Ratio of the device. If the DPR is <code>2</code>, one CSS pixel is 4 physical pixels on the screen.</td>
</tr>
<tr>
<td><code>Width</code></td>
<td>Intrinsic size of the image in pixels. Physical pixels.</td>
</tr>
<tr>
<td><code>Viewport-Width</code></td>
<td>Size of Viewport in CSS pixels</td>
</tr>
<tr>
<td><code>Save-Data</code></td>
<td>Indicate client's preference for reduced data usage. More compression will be applied.</td>
</tr>
</tbody>
</table>
<p>To make use of Client Hints, you'll need to <a href="#bpclienthints">activate it on your web server</a>.</p>
<p>In order to fully utilize ImageEngine and Client Hints, it is important to understand the basics. Before the arrival of high density displays (such as the Retina display), designers only needed to worry about one type of pixels. 200px is 200px regardless. However, with high DPI displays, there are now two types of pixels to keep in mind. The pixel size we already know is dubbed as "CSS pixels" or "display pixels". For example, when you define a <code>&lt;div&gt;</code> to be 200px wide in CSS, the div will actually be displayed at 200px, regardless of how many physical pixels the screen uses to display the div.</p>
<p>With the arrival of high dpi displays, one quickly needed a way to show crisp "retina images" even on webpages. This means that, for a device like the iPhone with a DPR of 2, an image on your webpage with a width of 200 pixels defined in your CSS file actually needs to be 400 pixels wide - simply double the size. The formula is <code>CSS pixels x DPR = physical image size</code>. So now, a designer or developer has to make two sizes of the image. If only it was that easy... Today DPR range from 1 to 4. With decimals. Which make the task unscalable.</p>
<p>ImageEngine will automatically resolve this <strong>provided that the origin image is high resolution</strong>. If an origin image is 200 pixels wide and the display size is 200 pixels, ImageEngine will not scale the image up to support high DPI screens and you'll lose the high DPI support. A good rule of thumb is to have the origin image be at least twice the size of its intended display size.</p>
<p>The response from ImageEngine will confirm the actual DPR of the image in a response HTTP header:</p>
<pre><code>Content-DPR: &lt;long&gt;
</code></pre>
<p>The value of the header depends on the <code>DPR</code> and <code>Width</code> headers of the requesting device and the size of the origin image.</p>
<p>If <code>DPR</code> is 1, <code>Width</code> is 100 and the origin image is 100 pixels, <code>Content-DPR</code> will be <code>1</code>.</p>
<p>If <code>DPR</code> is 2, <code>Width</code> is 200 and the origin image is 100 pixels, <code>Content-DPR</code> will be <code>0.5</code>. (poor quality)</p>
<p>If <code>DPR</code> is 2, <code>Width</code> is 200 and the origin image is 200 pixels, <code>Content-DPR</code> will be <code>2</code>. (best quality)</p>
<p><code>Content-DPR</code> response header will only be sent if the request has a <code>Width</code> header.</p>
<p>More information:</p>
<ul>
<li><a href="https://developers.google.com/web/updates/2015/09/automating-resource-selection-with-client-hints">Automating resource selection with client hints</a></li>
<li><a href="https://www.smashingmagazine.com/2016/01/leaner-responsive-images-client-hints/">Leaner responsive images with client hints</a></li>
<li><a href="http://httpwg.org/http-extensions/client-hints.html">Client hints specification</a></li>
</ul>
<h1>
<a name="plugins"></a>Plugins</h1>
<p>To ease the use and integration of ImageEngine, we've made a few plugins (free and open source) for popular frameworks and platforms. More information and documentation are available in the links below:</p>
<ul>
<li><a href="http://docs.scientiamobile.com/documentation/ImageEngine/magento-integration">Magento</a></li>
<li><a href="http://docs.scientiamobile.com/documentation/ImageEngine/shopify-integration">Shopify</a></li>
<li><a href="http://docs.scientiamobile.com/documentation/ImageEngine/wordpress-integration">Wordpress</a></li>
<li><a href="http://docs.scientiamobile.com/documentation/ImageEngine/drupal-integration">Drupal</a></li>
<li><a href="http://docs.scientiamobile.com/documentation/ImageEngine/javascript-integration">JavaScript</a></li>
</ul>
<h1>
<a name="examples"></a>Examples</h1>
<p>Auto mode. Size, format and compression decided based on browser- and device capabilities.</p>
<p><img style="max-width: 100%;" src="https://img.imgeng.in/http://wurfl.github.io/i/pencils.jpg"></p>
<pre><code>&lt;img src="https://try.imgeng.in/http://wurfl.github.io/i/pencils.jpg"&gt;
</code></pre>
<hr>
<p>Explicitly requesting an image 300 pixels wide</p>
<p><img src="https://img.imgeng.in/w_300/http://wurfl.github.io/i/pencils.jpg"></p>
<pre><code>&lt;img src="https://try.imgeng.in/w_300/http://wurfl.github.io/i/pencils.jpg"&gt;
</code></pre>
<hr>
<p>Letter-boxing the image inside a 500x500 box with red padding and opacity.</p>
<p><img style="max-width: 100%;" src="https://img.imgeng.in/w_500/h_500/m_letterbox_ff0000_65/http://wurfl.github.io/i/pencils.jpg"></p>
<pre><code>&lt;img src="https://try.imgeng.in/w_500/h_500/m_letterbox_ff0000_65/http://wurfl.github.io/i/pencils.jpg"&gt;
</code></pre>
<hr>
<p>Setting compression to 80.</p>
<p><img style="max-width: 100%;" src="https://img.imgeng.in/w_500/cmpr_80/http://wurfl.github.io/i/pencils.jpg"></p>
<pre><code>&lt;img src="https://try.imgeng.in/w_500/cmpr_80/http://wurfl.github.io/i/pencils.jpg"&gt;
</code></pre>
<hr>
<p>Fallback size when no specific size can be determined automatically.</p>
<p><img style="max-width: 100%;" src="https://img.imgeng.in/w_auto,300/http://wurfl.github.io/i/pencils.jpg"></p>
<pre><code>&lt;img src="https://try.imgeng.in/w_auto,300/http://wurfl.github.io/i/pencils.jpg"&gt;
</code></pre>
<hr>
<p>Rotate the image 90 degrees.</p>
<p><img style="max-width: 100%;" src="https://img.imgeng.in/w_auto,200/r_90/http://wurfl.github.io/i/pencils.jpg"></p>
<pre><code>&lt;img src="https://try.imgeng.in/w_auto,200/r_90/http://wurfl.github.io/i/pencils.jpg"&gt;
</code></pre>
<hr>
<p>Cropping the image.</p>
<p><img style="max-width: 100%;" src="https://img.imgeng.in/cr_500,500,100,100/http://wurfl.github.io/i/pencils.jpg"></p>
<pre><code>&lt;img src="https://try.imgeng.in/cr_500,500,100,100/http://wurfl.github.io/i/pencils.jpg"&gt;
</code></pre>
<hr>
<p>Manually sharpening the image. Good for thumbnails.</p>
<p><img style="max-width: 100%;" src="https://img.imgeng.in/h_100/s_50/http://wurfl.github.io/i/pencils.jpg"></p>
<pre><code>&lt;img src="https://try.imgeng.in/h_200/s_50/http://wurfl.github.io/i/pencils.jpg"&gt;
</code></pre>
<hr>
<p>Responsive images enhanced with client hints and fallback size.</p>
<p><img style="max-width: 100%;" src="https://img.imgeng.in/w_auto,300/http://wurfl.github.io/i/pencils.jpg" sizes="30vw"></p>
<pre><code>&lt;img src="https://try.imgeng.in/w_auto,300/http://wurfl.github.io/i/pencils.jpg" sizes="30vw"&gt;
</code></pre>
<hr>
<script>// <![CDATA[
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-92590791-2', 'auto'); ga('send', 'pageview');
// ]]></script>
</div>