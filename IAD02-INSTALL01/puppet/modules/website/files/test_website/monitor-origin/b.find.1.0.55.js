
var redirected=false;(function(SH){SH.Modules.UI=SH.Modules.UI||function(sandbox){var ua=navigator.userAgent;var uiFormfactor;var enableAnimation=sandbox.getGVar('exec.enableAnimation');var enablePaneSwipe=false;var supportsNativeScroll=!(ua.match(/Android\s[1-3]/)||(ua.match(/iPad/)&&ua.match(/OS\s[1-4]/))||!ua.match(/WebKit/i));var nativeScroll=supportsNativeScroll;var isStandAloneMode=false;if("standalone"in window.navigator&&window.navigator.standalone){isStandAloneMode=window.navigator.standalone;}
if(sandbox.getGVar('standalone')){isStandAloneMode=true;}
var transitionType=(function(){var t;var el=document.createElement('testelement');var transitions={'transition':['transitionStart','transitionEnd'],'OTransition':['oTransitionStart','oTransitionEnd'],'MSTransition':['msTransitionStart','msTransitionEnd'],'MozTransition':['transitionstart','transitionend'],'WebkitTransition':['webkitTransitionStart','webkitTransitionEnd']};for(t in transitions){if(typeof el.style[t]!=='undefined'){return transitions[t];}}})();var windowDimensions=function(){var width,height,orientation,formfactor,formfactorchange;if(window.innerWidth&&window.innerHeight){width=window.innerWidth;height=window.innerHeight;}else if(document.documentElement){width=document.documentElement.clientWidth;height=document.documentElement.clientHeight;var h_d=sandbox.getGVar('exec.clientHeightDelta');if(h_d){height+=h_d;}}
if(width>height){orientation="landscape";}else{orientation="portrait";}
formfactor=width>1020?4:width>760?3:width>500?2:1;if(uiFormfactor!==formfactor){sandbox.core.publish("ui-formfactor-changed",formfactor);$("body").attr("data-formfactor",formfactor);uiFormfactor=formfactor;formfactorchange=true;}else{formfactorchange=false;}
return{width:width,height:height,orientation:orientation,formfactor:formfactor,formfactorchange:formfactorchange};};var menuHeight=parseInt($(".ui-menu").css("height"),10)||0;var headerHeight=parseInt($(".ui-header").css("height"),10)||0;var footerHeight=parseInt($(".ui-footer").css("height"),10)||0;function UIModel(){this.constructor.apply(this,arguments);}
UIModel.prototype=new StubHubCore.Model();function UIView(){this.constructor.apply(this,arguments);this.render=function(keys){if(keys){switch(keys[0]){}}};}
UIView.prototype=new StubHubCore.View();function UIController(){this.constructor.apply(this,arguments);var geoSelectorOpen=false;this.init=function(sandbox){this.sandbox=sandbox;if(typeof bindGlobalEvents=='function'){bindGlobalEvents.call(this,this.sandbox);}
var container=this.sandbox.getContainer();if(this.view){if(container){this.view.container=container;}
if(typeof bindViewEvents=='function'){bindViewEvents.call(this,this.sandbox);}}
startModule("GeoDetection");addSpinner();var state=sandbox.getCurrentState();if(state){loadPaneSet=true;setLoadPane(state);}
if(!sandbox.getGVar('exec.isUK')){setTimeout(function(){sandbox.core.publish('geo.request.location');},500);}
setLayout(true);addTouchSupport();};function addSpinner(){var $spinner=$('#spinner').remove().removeClass('hidden').attr('id','');if($spinner.length==1){$('.processing').forEach(function(p){$(p).prepend($spinner.clone());});}}
function addTouchSupport(){if(enablePaneSwipe&&window.Hammer){var hammer=new window.Hammer($(".ui-panes").get(0));hammer.onswipe=function(e){if(e.direction=="right"){sandbox.revertToPreviousState();}};}}
function setLogo(isLanding,formfactor){var $logo=$('#shlogo');if(formfactor>=3){$logo.removeClass('logo');if(isLanding){$logo.removeClass("logo_header").addClass("logo_landing");}else{$logo.removeClass("logo_landing").addClass("logo_header");}}else{$logo.removeClass('logo_landing logo_header').addClass('logo');}}
var loadPaneSet=false;function setLoadPane(state){state=state||sandbox.getCurrentState();var dims=windowDimensions();if(state&&state.type){var type=state.type;setLogo(type=="home",dims.formfactor);if(type==="section"||type==="ticket"){$("#eventPane").addClass("ui-pane-active");}
hideMwebUI();setState({state:state,load:true});}else{$("#homePane").addClass("ui-pane-active");startModuleForPane("home");}}
function setLayout(init){init=init===true;var dims=windowDimensions(),$activePane=$(".ui-pane-active"),$shlogo=$('#shlogo'),activePane=($activePane.attr("id")||"homePane").replace("Pane","");setLogo(activePane=="home",dims.formfactor);if(dims.formfactor>=3){if(activePane==="geo"){}else if(activePane==="home"){openSearch();}else{if(activePane!=="search"){closeSearch();}}}
if(!$shlogo.hasClass('sprite')){$shlogo.addClass('sprite');}
if(init){if(dims.formfactor<=2){nativeScroll=false;}
if(!nativeScroll){$(".ui-scrollable").removeClass("ui-scrollable");}}
setMenuLayout(dims.formfactor,activePane,init);setPaneDimensions();if(!init){var scrollY=window.scrollY;window.scrollTo(0,scrollY);}}
function setMenuLayout(formfactor,pane,init){var $menu=$(".ui-menu"),miniMenu=formfactor>=3&&(pane==="event"||pane==="section"||pane==="ticket");if(pane=='genre'){var isLeaf=$('#genrePane').attr('data-leaf')=='1';if(isLeaf&&formfactor>=3){miniMenu=true;}}
if(init){if(!nativeScroll){$menu.css("position","absolute");}}
if(formfactor<=2){if(!$menu.hasClass("ui-menu-undocked")){closeMenu();}}else{if(init){$menu.removeClass("ui-menu-docked");}
if($menu.hasClass("ui-menu-docked")||$menu.hasClass("ui-menu-undocked")){$(".ui-main").removeClass("ui-main-menu-docked");$(".ui-content").removeClass("ui-content-menu-undocked");$menu.removeClass("ui-menu-docked").removeClass("ui-menu-undocked");}
if(miniMenu){minimizeMenu();}else{maximizeMenu();}}}
function setPaneDimensions(){setTimeout(function(){var dims=windowDimensions(),$activePane=$(".ui-pane-active"),activePane=($activePane.attr("id")||"homePane").replace("Pane",""),contentHeight=parseInt($activePane.css("height"),10)||0;headerHeight=parseInt($(".ui-header").css("height"),10)||0;var eventControlHeight=parseInt($('#eventControllerPane').css('height'),10)||0;var noScrollMaxContentHeight=dims.height-headerHeight-contentHeight;if(dims.formfactor>=3&&noScrollMaxContentHeight<412){noScrollMaxContentHeight=412;}else if(dims.formfactor<3){noScrollMaxContentHeight=dims.height-contentHeight-headerHeight;}
if(dims.formfactorchange){}
if(activePane==="event"){contentHeight+=noScrollMaxContentHeight;if(dims.formfactor>=3){$('#map').css('height',noScrollMaxContentHeight+"px");}else{}}
if(dims.formfactor>=3){if(nativeScroll){$(".ui-scrollable").css("height",noScrollMaxContentHeight+"px");$(".ui-menu").css("height",dims.height+"px");}else{$(".ui-menu").css("minHeight",Math.max(dims.height,headerHeight+contentHeight+footerHeight)+"px");}}else{$(".ui-column-close-icon").hide();menuHeight=Math.max(dims.height,headerHeight+contentHeight);$(".ui-menu").css("minHeight",menuHeight+"px");if(nativeScroll){$(".ui-scrollable").css("height","");}
if(activePane==="home"||activePane==="search"){$("#searchTriggerButton").addClass("invisible");}else{$("#searchTriggerButton").removeClass("invisible");}}
if(activePane==="event"){if(dims.formfactor>=3){$(".ui-panes").css("minHeight",contentHeight+"px");}else{var titleHeight=parseInt($('#EventTitleModule').css("height"),10)||0;var pricePromote=parseInt($('#pricePromote').css("height"),10)||0;var mapBarHeight=parseInt($('#MAP-bar').css('height'),10)||0;$('#map').css('height',(dims.height-eventControlHeight-mapBarHeight)+"px");var column1Height=parseInt($activePane.find(".ui-column-active").css("height"),10)||0;var column2Height=parseInt($activePane.find(".ui-column-secondary").css("height"),10)||0;var maxHeight=Math.max(column1Height,column2Height);if(maxHeight<noScrollMaxContentHeight){$(".ui-panes").css("minHeight",(dims.height-headerHeight)+"px").css("height","");}else{var panesHeight=menuHeight;if(dims.height>=maxHeight){if($('#sectionColumn').hasClass('ui-column-active')){panesHeight=maxHeight+titleHeight+eventControlHeight;}else if($('#ticketColumn').hasClass('ui-column-active')){panesHeight=maxHeight+titleHeight;}else{panesHeight=maxHeight+titleHeight+eventControlHeight;}}else{if($('#sectionColumn').hasClass('ui-column-active')){panesHeight=maxHeight+titleHeight+eventControlHeight;}else if($('#ticketColumn').hasClass('ui-column-active')){panesHeight=maxHeight+titleHeight;}else{panesHeight=maxHeight+titleHeight+headerHeight+pricePromote+30;}}
menuHeight=panesHeight+headerHeight;$(".ui-panes").css("minHeight",panesHeight+"px");$(".ui-menu").css("minHeight",menuHeight+"px");if(dims.formfactor<=2&&$('#eventColumn').hasClass('ui-column-active')){sandbox.core.publish("ui-panedimension-complete");}}}}else{if(activePane==="genre"&&$("#genrebrowse_bottom_ad").length>0){contentHeight=contentHeight+10;}
$(".ui-panes").css("minHeight",Math.max(menuHeight-headerHeight,contentHeight,dims.height-headerHeight)+"px");}},0);}
function onScroll(){}
function bindViewEvents(){var _container='.ui-context',$container=$(_container);$('.li-menu').bind("click",function(){if($(this).hasClass('noLeftNavTrack')){return;}
var $menu=$(this).find("a"),text=$menu.text(),prop62;if($(this).hasClass('li-menu-nested')&&!$(this).parent().hasClass("aboutus")){var genre=$menu.attr("data-chname");text=genre+" : "+text;prop62="left nav :"+genre;}else{prop62="left nav touch";}
if($(this).hasClass('redirectNav')){window.setTimeout(function(){sandbox.trackInOmniture(null,null,prop62,prop62+": "+text+": "+sandbox.getOmniPageName());},500)}else{sandbox.trackInOmniture(null,null,prop62,prop62+": "+text+": "+sandbox.getOmniPageName());}});$container.delegate('.ui-switch-pane',"click",function(e){e.preventDefault();e.stopPropagation();var $this=$(this),href=$this.attr('href'),type=$this.attr('data-type')||href.replace("/",""),$parent=$this.parent(),service=$this.attr('data-service'),paneSettings={},genreId=$this.attr('data-genreid');continueToMwebMenuClick();function continueToMwebMenuClick(){showMwebUI();$(".li-menu-active").removeClass("li-menu-active");$parent.addClass("li-menu-active");switch(type){case'upcoming':sandbox.trackInOmniture(null,null,'upcoming events touch',null);break;case'home':if($this.attr("id")=="shlogo"){sandbox.trackInOmniture(null,null,"logo touch",null,"stubhub logo touch");}
break;}
if(genreId){paneSettings={channelId:$this.attr('data-chid'),channelName:$this.attr('data-chname'),genre:{id:genreId,leaf:$this.attr('data-leaf'),desc:$this.text()}};}
if(service==="content"){paneSettings={service:service,type:$this.attr('data-type')};}
setState({state:{type:type,url:href,paneSettings:paneSettings}});if(!$parent.hasClass("li-menu-nested")){collapseMenu();}
if(uiFormfactor<=2){closeMenu();}}});$(".ui-menu").delegate(".ui-accordion-toggle","click",function(){var text=$(this).text();sandbox.trackInOmniture(null,null,"left nav touch: "+text,"left nav: "+text+": "+sandbox.getOmniPageName(),"left nav touch");maximizeMenu();setPaneDimensions();});$container.find('#menuButton').bind('click.fast',function(e){e.preventDefault();e.stopPropagation();var isHomePaneActive=$("#homePane").hasClass("ui-pane-active");if(!isHomePaneActive&&isStandAloneMode){sandbox.revertToPreviousState();return;}
toggleMenu();});$('#searchTriggerButton').bind('click.fast',function(e){e.preventDefault();e.stopPropagation();sandbox.trackInOmniture(null,null,"search icon touch",null);setState({state:{type:"search",url:"/search"}});});$container.delegate('.ui-link',"click",function(e){e.preventDefault();e.stopPropagation();var target=$(this).attr('data-ui-target');if(target!="menu"&&target!='search'){setState({state:{type:target,url:"/"+target}});}});$(".ui-column-close-icon").bind("click",function(e){e.preventDefault();e.stopPropagation();var target=$(this);handleCloseClick(target);});$('#selllink').bind("click",function(e){e.preventDefault();e.stopPropagation();if(window.confirm(sandbox.getGVar("MSG.shared.exec.goToSellPage"))){var prop62="left nav touch",pagename=sandbox.getOmniPageName()||"mWeb: Home";sandbox.trackInOmniture(null,pagename,prop62,prop62+": Sell link : "+pagename);var baseurl=this.getAttribute("href");var s=sandbox.getCurrentState();var newurl=baseurl;if(s&&s.paneSettings){var ps=s.paneSettings;if(s.type=="event"&&ps.event&&ps.event.id){newurl+="?eventId="+ps.event.id;}else if(s.type=="genre"&&ps.genre&&ps.genre.id){newurl+="/findevent?genreId="+ps.genre.id;}}
sandbox.setInCookie('sc.f','m66',false,90*24,sandbox.getGVar("exec.cookieDomain"));window.setTimeout(function(){location.href=newurl;},100);}
return 0;});$('#fullsite_link, #fullsite_link_mainmenu').bind("click",function(e){e.preventDefault();e.stopPropagation();var isMenuExpanded=!$("#mainMenu").hasClass("ui-menu-mini");if(isMenuExpanded||(window.confirm(sandbox.getGVar("MSG.shared.exec.goToFullSite")))){var prop62="left nav touch",pagename=sandbox.getOmniPageName()||"mWeb: Home";sandbox.trackInOmniture(null,pagename,prop62,prop62+": Full site : "+pagename);sandbox.setInCookie('sc.t','touch',true,0,sandbox.getGVar("exec.cookieDomain"));sandbox.setInCookie('sc.f','m66',false,90*24,sandbox.getGVar("exec.cookieDomain"));var _url=$(this).attr('url'),winUrl=window.location.href,ty=sandbox.getCurrentState().type;if(ty=='home'||ty=='genre'||ty=='event'){winUrl=winUrl.replace(window.location.host,_url);}else{winUrl=window.location.protocol+'//'+_url;}
winUrl=sandbox.appendParamToUrl(winUrl,'ref','mweb');window.setTimeout(function(){location.href=winUrl;},500);}
return 0;});$('#feedback_link').bind("click",function(e){e.preventDefault();e.stopPropagation();var _url=$(this).attr('href');window.setTimeout(function(){window.open(_url);},500);});}
function handleCloseClick(target){if(target.attr('pst-flag')=='1'){var _state=sandbox.getCurrentState();if(_state.type=='ticket'){_state.type='section';var _params={};var _url=_state.url.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){if(key=='section_id'){_params[key]=value;}
return'';});_state.url=_url+"?section_id="+_params.section_id;setState({state:{type:'section',url:_state.url,paneSettings:_state.paneSettings,direction:'back'},replace:true});}else if(_state.type=='section'){_state.type='event';_state.url=_state.url.replace(/[?&]+([^=&]+)=([^&]*)/gi,'');setState({state:{type:'event',url:_state.url,paneSettings:_state.paneSettings,direction:'back'},replace:true});}}else{sandbox.revertToPreviousState();}}
function handleLinkClick(opts){setState({state:{type:opts.target,url:opts.href,data:opts.data,paneSettings:opts.paneSettings,f:'ui-link-clicked'},replace:opts.replace});}
function displayUnscrubebd(toPane){var current_state=sandbox.getCurrentState();switchToPane(toPane,current_state,true);$("#sectionColumn").removeClass("ui-column-primary").removeClass("ui-column-shade");}
function handleStateUpdate(opts){var type=opts.state.type,reverse=opts.direction==="back"||opts.state.direction==='back',paneSettings=opts.state.paneSettings;if(paneSettings&&paneSettings.service){var service=paneSettings.service;var $servicePane=$("#"+type+"Pane");if(!$servicePane.hasClass("ui-loaded")){if(service==="content"){var url="/"+service+"/"+type;$.get(url,function(htmlFrag){var $tc=$("#"+type+"Content");$tc.addClass("ui-loaded").html(htmlFrag);if(type=='overview'){$tc.find('.abtus-main-timg').remove();$tc.find('#abtus-main-middle').remove();$tc.find('#abtus-main-bpannel').remove();}
setPaneDimensions();});}}}
if(!loadPaneSet){loadPaneSet=true;setLoadPane(opts.state);}
if(type=='genre'&&paneSettings&&paneSettings.genre){if(""+paneSettings.genre.leaf=='true'){$('#genrePane').attr('data-leaf','1');}else{$('#genrePane').attr('data-leaf','0');}}
switchToPane(type,opts.state,reverse);if(geoSelectorOpen){geoSelectorOpen=false;}}
function loadFilterModule(opts){var ps=opts.paneSettings,evt=ps&&ps.event;$('#EventInitializerModule').removeClass("hidden");}
function hideMwebUI(){var $grid=$('#GridMiddle'),$spinner=$($(".spinner")[0]);$grid.append('<div id="global_overlay" class="processing global_overlay vertical"></div>');$("#global_overlay").append($spinner.clone().attr("class","global_spinner"));}
function sendContextToGlobalMbox(state){var context="";var screenWidth=window.innerWidth||window.screen.width;if(state.type=="genre"){if(state.paneSettings&&state.paneSettings.genre){var gps=state.paneSettings.genre;var data=StubHubCore.ls.getGenreFromLSById(gps.id);if(data){var dg=data.ancestorGenreIds;dg=dg.split(" ").join("_")+"_0";mboxUpdate(mweb_mbox_name.Global,"pageType=genre","scrWidth="+screenWidth,'isGenreLeaf='+data.leaf,'genreId='+data.id,'ancestorGenreIds='+dg,'canHaveEventsFlag='+data.canHaveEventsFlag);}
else{mboxUpdate(mweb_mbox_name.Global,"pageType=genre","scrWidth="+screenWidth,'isGenreLeaf='+gps.leaf,'genreId='+gps.id);}}}
else if(state.type=="event"||state.type=='section'){if(state.paneSettings&&state.paneSettings.event){var eps=state.paneSettings.event;var m=sandbox.getMboxEventData(eps);mboxUpdate(mweb_mbox_name.Global,"pageType=event","scrWidth="+screenWidth,'book_of_business_id='+eps.book_of_business_id,'totalPostings='+eps.totalPostings,'totalTickets='+eps.totalTickets,'minPrice='+eps.minPrice,'is_ga_event='+eps.is_ga_event,'event_id='+eps.id,'venue_config_map_type='+eps.venue_config_map_type,"ancestorGenreIds="+m.ancestorGenreIds,"ancestorGeoIds="+m.ancestorGeoIds,'userGeo='+sandbox.getGVar('geo.location.geoId'));}}else{mboxUpdate(mweb_mbox_name.Global,"pageType="+state.type,"scrWidth="+screenWidth);}}
function setState(opts){var state=opts.state,evt=state&&state.paneSettings&&state.paneSettings.event;if(!opts.load){sandbox.setOmnitureReferrer(location.href);}else{var shref=sandbox.getGVar('exec.shref');if(shref){setOmniturePageName(opts.state.type,opts.unscrubbed);sandbox.setGVar('exec.shref',undefined,true);sandbox.trackInOmniture(null,null,'StubHub Redirect','StubHubRedirect:'+shref);}}
if(state.type=='event'||state.type=='section'){var eventdata=state.data;if(eventdata&&eventdata.book_of_business_id!=sandbox.getGVar("exec.book_of_business_id")){if(window.confirm(sandbox.getGVar("MSG.shared.exec.goToEvents")[""+(eventdata.book_of_business_id||"1")])){var _href=sandbox.getHostByBobId(eventdata.book_of_business_id);if(eventdata.urlpath){_href=_href+'/'+eventdata.urlpath;}else if(eventdata.id){_href=_href+'/?event_id='+eventdata.id;}
sandbox.goToDomainUrl(_href);}else{return;}}}
if(state.f=='ui-link-clicked'){if(state.type=='section'){$("#closeTicketColumnIcon").attr('pst-flag','0');}else if(state.type!='ticket'){$("#closeTicketColumnIcon").attr('pst-flag','0');$("#SectionModule").attr('pst-flag','0');}}else{if(state.type=='section'){$("#SectionModule").attr('pst-flag','1');}else if(state.type=='ticket'){$("#SectionModule").attr('pst-flag','1');$("#closeTicketColumnIcon").attr('pst-flag','1');}else{$("#closeTicketColumnIcon").attr('pst-flag','0');$("#SectionModule").attr('pst-flag','0');}}
sendContextToGlobalMbox(state);sandbox.pollProperty(StubHubCore.exec,"unifiedredirect",function(){if(sandbox.getGVar('exec.unifiedredirect')){}else{switchState(state,opts);showMwebUI();}},function(){switchState(state,opts);showMwebUI();},undefined,1000);}
function switchState(state,opts){if(typeof sandbox.switchToState=='function'){sandbox.switchToState(state,opts.replace);}else{switchToPane(opts.state.type,opts.state,opts.direction);}}
function switchToPane(toPane,opts,reverse){var primaryColumnClass="ui-column-primary",secondaryColumnClass="ui-column-secondary",tertiaryColumnClass="ui-column-tertiary",activeColumnClass="ui-column-active",eventPaneIsActive=$("#eventPane").hasClass("ui-pane-active"),$activePane=$(".ui-pane-active"),isColumnPane=(toPane==="section"||toPane==="ticket"||(toPane==="event"&&$activePane.attr('id')=='eventPane')),activeClass=isColumnPane&&eventPaneIsActive?activeColumnClass:"ui-pane-active",$fromPane=$("."+activeClass),$toPane=isColumnPane?$("#"+toPane+"Column"):$("#"+toPane+"Pane"),isSwitchComplete=false,hamburgerIcon=$("#menuButton").find("span.sprite");if(typeof opts==="boolean"){reverse=opts;opts=undefined;}
if(toPane==="home"){hamburgerIcon.removeClass("sprite-back_icon");}else{if(isStandAloneMode){hamburgerIcon.addClass("sprite-back_icon");}else{hamburgerIcon.removeClass("sprite-back_icon");}}
if(!opts.error&&($toPane.length===0||$toPane.hasClass(activeClass))){scrollToTop(isColumnPane);if(uiFormfactor===3&&toPane==="genre"){setMenuLayout(uiFormfactor,toPane);}
if(uiFormfactor<=2&&toPane==="event"&&opts.filter){loadFilterModule(opts);}
return false;}
opts=opts||{};if(opts&&!opts.unscrubbed){var ps=opts.paneSettings,event=ps&&ps.event;if(event&&!event.isScrubbed){opts.unscrubbed=true;}}
startModuleForPane(toPane,opts);var $eventPane=$('#eventPane');if(isColumnPane&&eventPaneIsActive){var $eventColumn=$eventPane.find('#eventColumn'),$sectionColumn=$eventPane.find("#sectionColumn");$fromPane.removeClass(primaryColumnClass);$eventPane.find("."+secondaryColumnClass).removeClass(secondaryColumnClass);$eventPane.find("."+tertiaryColumnClass).removeClass(tertiaryColumnClass);$eventPane.find("."+activeColumnClass).removeClass(activeColumnClass);if(toPane=="event"){}else if(toPane=='section'){$toPane.addClass(primaryColumnClass);if(!opts.unscrubbed){$eventColumn.addClass(secondaryColumnClass);}}else if(toPane=='ticket'){$toPane.addClass(primaryColumnClass);$eventColumn.addClass(tertiaryColumnClass);$sectionColumn.addClass(secondaryColumnClass);}
if(toPane==="ticket"){$("#closeSectionColumnIcon").addClass("invisible");}else{$("#closeSectionColumnIcon").removeClass("invisible");}
if(toPane=="section"||opts.unscrubbed){$sectionColumn.addClass("ui-column-shade");if(opts.unscrubbed){$("#closeSectionColumnIcon").addClass("invisible");$sectionColumn.addClass("unscrubbed");if(toPane=="section"){$sectionColumn.removeClass("ui-column-shade").removeClass("ui-column-primary");}}}}else if(toPane==="event"){$eventPane.find("."+primaryColumnClass).removeClass(primaryColumnClass);$eventPane.find("."+secondaryColumnClass).removeClass(secondaryColumnClass);$eventPane.find("."+tertiaryColumnClass).removeClass(tertiaryColumnClass);$eventPane.find("."+activeColumnClass).removeClass(activeColumnClass);$("#eventColumn").addClass(activeColumnClass);if(opts&&!opts.unscrubbed){$("#sectionColumn").removeClass("unscrubbed");}else{$("#sectionColumn").addClass("unscrubbed");}}else if(toPane==="section"||toPane==="ticket"){$eventPane.find("."+primaryColumnClass).removeClass(primaryColumnClass);$eventPane.find("."+secondaryColumnClass).removeClass(secondaryColumnClass);$eventPane.find("."+tertiaryColumnClass).removeClass(tertiaryColumnClass);$eventPane.find("."+activeColumnClass).removeClass(activeColumnClass);$("#"+toPane+"Column").addClass(activeColumnClass).addClass(primaryColumnClass);if(toPane=='ticket'){$("#sectionColumn").addClass(secondaryColumnClass);}
if(opts.unscrubbed){$("#sectionColumn").removeClass("ui-column-shade").addClass("unscrubbed");$("#closeSectionColumnIcon").hide();if(toPane=='section'){$("#sectionColumn").removeClass(primaryColumnClass);}}else{$("#sectionColumn").addClass("ui-column-shade").removeClass("unscrubbed");if(toPane==='section'){$("#eventColumn").addClass(secondaryColumnClass);}else{$("#eventColumn").addClass(tertiaryColumnClass);}}
toPane="event";$toPane=$("#eventPane");}
if(uiFormfactor>=3&&toPane!=="geo"){if(toPane==="home"){$(".ui-header").addClass("ui-header-home");}else{$(".ui-header").removeClass("ui-header-home");}
setMenuLayout(uiFormfactor,toPane);}
if($fromPane.attr("id")==="homePane"&&toPane==="geo"){setLogo(true,uiFormfactor);}else{setLogo(toPane==="home",uiFormfactor);}
if(toPane==="search"){openSearch();}else if(toPane==="home"){openSearch();$("#searchresult").hide();}else{closeSearch();}
if(enableAnimation&&window.addEventListener&&toPane!='search'){var callback=function animationEnd(){if(!isSwitchComplete){isSwitchComplete=true;$toPane[0].removeEventListener(transitionType[1],callback);$fromPane.removeClass(activeClass+' ani-out ani-start ani-slide'+(reverse?' ani-reverse':''));$toPane.removeClass('ani-in ani-start ani-slide'+(reverse?' ani-reverse':''));$toPane.addClass(activeClass);setPaneDimensions();}};$toPane[0].addEventListener(transitionType[1],callback);$fromPane.addClass('ani-out ani-slide'+(reverse?' ani-reverse':''));$toPane.addClass('ani-in '+activeClass+' ani-slide'+(reverse?' ani-reverse':''));window.setTimeout(function(){$fromPane.addClass('ani-start');$toPane.addClass('ani-start');window.setTimeout(callback,1000);},20);}else{$fromPane.removeClass(activeClass);$toPane.addClass(activeClass);setPaneDimensions();}
scrollToTop(isColumnPane);setOmniturePageName(toPane,opts.unscrubbed);}
function scrollToTop(isColumnPane){if(!isColumnPane||!nativeScroll){var offsetTop=(isColumnPane&&uiFormfactor>=3)?$(".ui-column-active").offset().top-20:1;window.scrollTo(0,offsetTop);}}
function bindGlobalEvents(sandbox){sandbox.core.subscribe('view-rendered',function(name){if(name!=='ESPN Genre'){setPaneDimensions();}});sandbox.core.subscribe('unscrubbed-map-click',function(data){displayUnscrubebd(data);});sandbox.core.subscribe('unscrubbed-list-display',function(data){displayUnscrubebd(data);});sandbox.core.subscribe('ui-link-clicked',handleLinkClick);sandbox.core.subscribe('url.update.state',handleStateUpdate);sandbox.core.subscribe('close-section-click',function(id){handleCloseClick($('#'+id));});bindToggles();var geoHandler=function(location){if(geoSelectorOpen===true){var current_state=sandbox.getCurrentState();switchToPane(current_state.type,current_state,true);geoSelectorOpen=false;}};sandbox.core.subscribe('geo-current-location',geoHandler);$(document).delegate('.geo_request',"click",function(e){e.preventDefault();e.stopPropagation();sandbox.trackInOmniture("Choose Location",null,"choose location touch",null,'choose location touch');if(!geoSelectorOpen){switchToPane("geo",{});geoSelectorOpen=true;}});$('#search_keyword').bind('focus',function(){if(sandbox.getCurrentState().type!='search'){setState({state:{type:'search',url:'/search',paneSettings:{}}});}});$('#search_button').bind("click",function(e){e.preventDefault();if(sandbox.getCurrentState().type!='search'){setState({state:{type:'search',url:'/search',paneSettings:{}}});}});$('#closeGeo').bind("click",function(){geoHandler();});if(window.addEventListener){window.addEventListener('onorientationchange'in window?'orientationchange':'resize',setLayout,false);window.addEventListener('scroll',onScroll,false);}}
function openMenu(){$("#main").removeClass("ui-main-menu-docked");$("#mainContent").addClass("ui-content-menu-undocked");$("#mainMenu").removeClass("ui-menu-docked").addClass("ui-menu-undocked");}
function closeMenu(){$("#main").addClass("ui-main-menu-docked");$("#mainContent").removeClass("ui-content-menu-undocked");$("#mainMenu").addClass("ui-menu-docked").removeClass("ui-menu-undocked");if(uiFormfactor<=2){collapseMenu();}}
function toggleMenu(){if($("#mainMenu").hasClass("ui-menu-docked")){openMenu();}else{closeMenu();}}
function minimizeMenu(){collapseMenu();$(".ui-main").addClass("ui-main-menu-mini");$("#mainMenu").addClass("ui-menu-mini");$('#mainContent').addClass("border-box");}
function maximizeMenu(){$("#mainMenu").removeClass("ui-menu-mini");$("#main").removeClass("ui-main-menu-mini");$('#mainContent').removeClass("border-box");}
function collapseMenu(){$("#mainMenu").find(".ui-accordion-toggle").each(function(){toggle.call(this,null,true);});setPaneDimensions();}
function openSearch(){$(".ui-search").show();}
function closeSearch(){$(".ui-search").hide();}
function setOmniturePageName(pane,unscrubbed,holdTrigger){var pgn,pt,opts={"events":""};switch(pane){case'geo':pgn="mWeb: Choose Location";pt="Choose Location";break;case'upcoming':pgn="mWeb: Upcoming Events";pt="Upcoming Events";break;case'search':pgn="mWeb: Search";opts.prop1="Search";break;case'home':pgn="mWeb: Home";pt=opts.prop1="Homepage";var winUrl=window.location.href;if(winUrl.search("concert-tickets")!==-1){pgn="mWeb: Concert";pt="Concerts Hub";opts.prop1="Genre";opts.prop4="Concert";}else if(winUrl.search("sports-tickets")!==-1){pgn="mWeb: Sports";pt="Sports Hub";opts.prop1="Genre";opts.prop4="Sports";}else if(winUrl.search("theater-tickets")!==-1){pgn="mWeb: Theater";pt="Theater Hub";opts.prop1="Genre";opts.prop4="Theater";}
break;case'overview':pgn="mWeb: Overview";pt="About us: Overview";opts.prop1="About us";break;case'useragreement':pgn="mWeb: User Agreement";pt="About us: User Agreement";opts.prop1="About us";break;case"privacypolicy":pgn="mWeb: Privacy Policy";pt="About us: Privacy policy";opts.prop1="About us";break;case"contactus":pgn="mWeb: Contact us";pt="About us: Contact us";opts.prop1="About us";break;case"sellerpolicies":pgn="mWeb: Seller Policies";pt="About us: Seller Policies";opts.prop1="About us";break;}
if(pgn&&pt){opts.pageName=pgn;opts.prop11=pt;sandbox.setOmnitureVariables(opts,!holdTrigger);}}
function showMwebUI(){$("#main").removeClass("hidden");$("#global_overlay").remove();}
function startModuleForPane(pane,opts){opts=opts||{};opts.ui={formfactor:uiFormfactor};if(pane!=="overview"&&pane!=="useragreement"&&pane!=="privacypolicy"&&pane!=="contactus"){switch(pane){case"geo":startModule("GeoSelector","GeoSelector",opts);break;case"home":startModule("Search","SearchModule",opts);startModule("Popular","PopularModule",opts);break;case"event":startModule("EventControl","EventControlModule",opts);startModule("EventTitle","EventTitleModule",opts);startModule("Event","EventModule",opts);break;case"genre":startModule("GenreBrowse","GenreBrowseModule",opts);break;case"section":startModule("EventControl","EventControlModule",opts);startModule("EventTitle","EventTitleModule",opts);startModule("Event","EventModule",opts);startModule("Section","SectionModule",opts);break;case"ticket":startModule("Event","EventModule",opts);startModule("EventControl","EventControlModule",opts);startModule("EventTitle","EventTitleModule",opts);startModule("Section","SectionModule",opts);startModule("TicketDetail","TicketDetailModule",opts);break;case"xyz":break;default:var moduleName=pane.SH_capitalize();startModule(moduleName,moduleName+"Module",opts);break;}}}
function startModule(name,target,opts){if(sandbox.core.lsModules().indexOf(name)===-1){var options={container:target,msg:sandbox.getGVar("MSG.module."+name)};sandbox.core.register(name,StubHub.Modules[name],options);}
if(sandbox.core.lsModules().indexOf(name)!==-1&&sandbox.core.lsInstances().indexOf(name)===-1){sandbox.core.start(name,{instanceId:name,options:opts});}}
function bindToggles(){$(".ui-context").delegate(".ui-toggle","click",toggle);$(".ui-context").delegate(".ui-accordion-toggle","click",toggle);}
function toggle(e,forceCollapse){var $this=$(this);var isAccordionToggle=$this.hasClass("ui-accordion-toggle");var target=$this.attr("data-ui-target");var $icon=$this.find(".ui-toggle-icon");var $target=$("#"+target);var curState=$icon.hasClass("ui-toggle-collapsed")?"collapsed":"expanded";if(curState==="expanded"||forceCollapse){collapse($target);$icon.removeClass("ui-toggle-expanded").addClass("ui-toggle-collapsed");var dims=windowDimensions(),$activePane=$(".ui-pane-active"),activePane=($activePane.attr("id")||"homePane").replace("Pane","");if(!forceCollapse&&dims.formfactor>=3){var miniMenu=(activePane=="event"||activePane=="section"||activePane=="ticket");if(activePane=='genre'&&$('#genrePane').attr('data-leaf')=='1'){miniMenu=true;}
if(miniMenu){$("#main").addClass("ui-main-menu-mini");$("#mainMenu").addClass("ui-menu-mini");$('#mainContent').addClass("border-box");}}}else{if(isAccordionToggle){var $accordionParent=$this.parents(".ui-accordion");$accordionParent.find(".ui-accordion-toggle").each(function(){toggle.call(this,e,true);});}
expand($target);$icon.removeClass("ui-toggle-collapsed").addClass("ui-toggle-expanded");}}
function expand($el){$el.show();}
function collapse($el){$el.hide();}}
UIController.prototype=new StubHubCore.Controller();this.init=function(){var cd=sandbox.getGVar("exec.cookieDomain");sandbox.setInCookie('sc.d','t',false,undefined,cd);sandbox.initOmniture();this.m=new UIModel();this.v=new UIView(this.m);this.c=new UIController(this.m,this.v);this.c.init(sandbox);};this.destroy=function(){};};$(document).ready(function(){StubHubCore.register("UI",StubHub.Modules.UI);StubHubCore.start("UI");if(typeof mboxUpdate==='function'&&mweb_mbox_name){if(mweb_mbox_name.appdownload){if(StubHubCore.exec.isUS){var flag=StubHubCore.util.getFromCookie('m.pp');if(!flag){mboxUpdate(mweb_mbox_name.appdownload);}}}
if(mweb_mbox_name.doubleclickad_display){mboxUpdate(mweb_mbox_name.doubleclickad_display);window.setTimeout(function(){if(StubHubCore.exec.showAd){$.getScript(StubHubCore.exec.protocol+"//www.googletagservices.com/tag/js/gpt.js",function(){});}else{$("div.adPlaceHolder").hide();}},1000);}else{$("div.adPlaceHolder").hide();}}
window.setTimeout(function(){StubHubCore.ls.scanExpiredEvents();},10000);window.setTimeout(function(){if(!StubHubCore.exec.disableForesee){$.getScript("/promotions/scratch/mobile/foresee-trigger.js",function(){},true);}},9999);if(StubHubCore.exec.isUK){if(location.search.match(/source=aw/i)){window.setTimeout(function(){$.getScript(StubHubCore.exec.protocol+"//cache1.stubhubstatic.com/promotions/scratch/lt/4307.js",function(){},true);},2000);}}
if(StubHubCore.exec.isIPad){$('#myaccountlink').attr('href','https://myaccount.stubhub'+StubHubCore.exec.site+'/myaccount');}});})(StubHub);(function(SH){SH.Modules.Tab=SH.Modules.Tab||function(sandbox){var C=sandbox.core;var opts,$tabs,$contents,pfx,logPfx,parent;function initFromSB(){opts=sandbox.options||{};$tabs=$(opts.tabs);$contents=$(opts.contents);parent=opts.parentName||'DefaultTab';pfx=opts.prefix||'DefaultTab';logPfx='*'+parent+"---Tab*  ";}
function TabView(){this.constructor.apply(this,arguments);this.tab=null;this.render=function(keys){var pr=false;if(keys){if(keys[0]==='tab'){pr=true;this.selectTab();}}
if(pr){C.publish('view-rendered',parent);}};this.selectTab=function(){var i=this.model.tab;$tabs.find('.ge_tab').removeClass('selected');$tabs.find('.tabidx'+i).addClass('selected');$contents.find('.ge_tab_container').hide();$contents.find('.tabidx'+i).show();};$tabs.find('.ge_tab').forEach(function(ele,i){$(ele).addClass('tabidx'+i);});$contents.find('.ge_tab_container').forEach(function(ele,i){$(ele).addClass('tabidx'+i);});}
TabView.prototype=new C.View();function TabCtrl(){this.constructor.apply(this,arguments);this.destroy=function(){unbindGlobalEvents();unbindViewEvents();};this.init=function(){bindGlobalEvents.call(this);bindViewEvents.call(this);};function bindGlobalEvents(){C.subscribe(pfx+'-tab-select',function(i){this.model.set('tab',i);},this);C.subscribe(pfx+'-tab-refresh',function(){var t=this.model.tab||0;this.model.tab=null;this.model.set('tab',t);},this);}
function bindViewEvents(){var self=this;$tabs.find('.ge_tab').bind('click.fast',function(e){e.stopPropagation();e.preventDefault();var $this=$(this);var clz=$this.attr('class');var idx=clz.match(/tabidx\d*/);if(idx&&idx[0]){var i=parseInt(idx[0].substr(6),10);self.model.set('tab',i);C.publish(pfx+'-tab-selected',i);}});}
function unbindViewEvents(){}
function unbindGlobalEvents(){}}
TabCtrl.prototype=new C.Controller();this.init=function(){initFromSB();this.m=new C.Model();this.v=new TabView(this.m);this.c=new TabCtrl(this.m,this.v);this.c.init();if(opts.defaultTab>=0){this.m.set('tab',opts.defaultTab);}};this.destroy=function(){};};}(StubHub));(function(SH){SH.Modules.EventList=SH.Modules.EventList||function EventList(sandbox){var opt,prefix,parent,container,$container,logPrefix,connectSuccess,$templateEvent,timeoutRef;var C=sandbox.core;function EventListView(){this.constructor.apply(this,arguments);$templateEvent=$('#'+prefix+"-listitem").remove();var $target=$(container),$targetList=$target.find("#"+prefix+"-list"),$processing=$target.find("#"+prefix+"-processing").remove().removeClass("hidden"),$unabletoconnect=$target.find("#"+prefix+"-unabletoconnect").remove().removeClass("hidden"),$noresults=$target.find("#"+prefix+"-noresults").remove();this.render=function(keys){var publishRender=false;if(keys){switch(keys[0]){case"events":connectSuccess=true;buildEventList(this.model.events);publishRender=true;break;case"delta_events":connectSuccess=true;buildEventList(this.model.delta_events,true);this.model.set('events',this.model.events.concat(this.model.delta_events),true);this.model.set('delta_events',null,true);publishRender=true;break;case"unabletoconnect":publishRender=true;showUnableToConnectMsg();break;}}
if(publishRender){C.publish("view-rendered",parent+"---EventList");}};this.processing=function(){$target.empty();$noresults.addClass('hidden');$unabletoconnect.remove();$target.append($processing);};function showUnableToConnectMsg(){$processing.remove();$target.append($unabletoconnect);}
function buildEventList(events,noempty){$processing.remove();$unabletoconnect.remove();if(!events){$targetList.empty();return;}
$target.addClass('hidden');$targetList.remove();if(!noempty){$targetList.empty();}
if(!events){$targetList.empty();return;}
if(events.length>0){$("#"+prefix+"-noresults").remove();for(var i=0,m=events.length;i<m;i++){$targetList.append(generateEventItem(events[i]));}}else{$target.append($noresults.removeClass('hidden'));}
$target.append($targetList);$target.removeClass('hidden');}
function generateEventItem(e){var eventId=e.event_id||e.id,$newRow=$templateEvent.clone().removeClass("template").attr("id",prefix+"-"+eventId),noPrice=(e.ancestorGenreIds.search(/ 81 /)>0);var d={star:{data:{"target-id":eventId,"target-channel":e.channelId}},eventId:{href:"/"+e.genreUrlPath+"/"+e.urlpath+"/",data:{"target-id":eventId}},eventName:{text:e.description.replace(/ tickets/i,"")},venue:{text:sandbox.displayVenue(e)}};if(parseFloat(e.minPrice,10)===0){$newRow.find('#tgt-'+prefix+"-minPriceWrapper").remove();}else{$newRow.find('#tgt-'+prefix+"-notickets").remove();}
if(!noPrice){d.minPrice={text:sandbox.displayPrice(e.minPrice,e.currency_code)};d.Currency={text:e.currency_code};}else{$newRow.find('#tgt-'+prefix+"-minPriceWrapper").remove();}
if(e.hide_event_date!="0"){d.date={text:sandbox.getGVar('MSG.shared.exec.dateTBD')};}else{if(e.hide_event_time!="0"){d.time={text:sandbox.getGVar('MSG.shared.exec.timeTBD')};}else{d.time={text:sandbox.displayTimeShort(e.event_date_time_local)+" "+(!sandbox.getGVar('exec.isUK')&&e.timezone?e.timezone:"")};}
var timeAhead=sandbox.getDateAheadOfEvent(e),date_display=sandbox.displayDateMediumExpanded(e.event_date_time_local),date_array=date_display.split(',');if(timeAhead===0){var hoursAhead=sandbox.getTimeAheadOfEvent(e);d.date={text:(hoursAhead>1)?C.util.getConditionMsg("time.starts_in",hoursAhead==1?[1]:'',hoursAhead):sandbox.getGVar('MSG.shared.time.starts_soon')};}
else if(timeAhead===1){var msg=sandbox.getGVar('MSG.shared.date');d.date={text:msg[timeAhead]};}
else{if(date_array.length>1){var date_html="";for(var i=0,im=date_array.length;i<im;i++){var _t=(i==im-1)?date_array[i].trim():date_array[i].trim()+',';date_html+=('<span class="eventlist_date_s">'+_t+'</span>');}
d.date={html:date_html};}else{d.date={text:date_display};}}}
sandbox.prefillDom({$elem:$newRow,tgtPrefix:"tgt-"+prefix+"-",newPrefix:prefix+"-"+eventId+"-",data:d});var channelName=sandbox.getChannelNameById(e.channelId);if(channelName){var isStarred=sandbox.isStarredEvent(channelName,eventId);if(isStarred){$newRow.find('#'+prefix+"-"+eventId+"-star").find('.fav').removeClass('sprite-star_unselected').addClass('sprite-star_selected');}}
return $newRow;}}
EventListView.prototype=new C.View();function EventListController(){this.constructor.apply(this,arguments);this.destroy=function(){unbindGlobalEvents();};this.init=function(){bindGlobalEvents.call(this);if(this.view){bindViewEvents.call(this);}};function bindViewEvents(){var self=this;$container.delegate('.'+prefix+'-link','click',function(e){C.publish("ui-link-clicked:before",{prefix:prefix,type:1,eventId:$(this).attr('id')});e.preventDefault();e.stopPropagation();var $this=$(this);var targetName="event";var targetId=$this.attr('data-target-id');var href=$this.attr('href');var relevantDataForTarget=sandbox.toArray(self.model.events).SH_getElem("id",targetId);relevantDataForTarget.stubhubDocumentType='event';sandbox.cacheEventToLS(relevantDataForTarget);var url=relevantDataForTarget.urlpath;var eid=relevantDataForTarget.id;var timestamp=new Date();var data={url:url,eid:eid,timestamp:timestamp};sandbox.addRecentlyViewed(data);var isScrubbed=(relevantDataForTarget.is_scrubbing_enabled=="1");var ps={channelId:relevantDataForTarget.channelId,event:{id:relevantDataForTarget.id,desc:relevantDataForTarget.description,isScrubbed:isScrubbed,viewFromSectionEnable:(relevantDataForTarget.view_from_section_ind=="true"||relevantDataForTarget.view_from_section_ind==1),bundled_type:relevantDataForTarget.bundled_type||1,artistPrimaryStyle:relevantDataForTarget.artistPrimaryStyle,venue_config_name:relevantDataForTarget.venue_config_name||'',ancestorDescriptions:relevantDataForTarget.ancestorGenreDescriptions||relevantDataForTarget.ancestorDescriptions,ancestorGenreIds:relevantDataForTarget.ancestorGenreIds,ancestorGeoIds:relevantDataForTarget.ancestorGeoIds,venue_config_map_type:relevantDataForTarget.venue_config_map_type,totalPostings:relevantDataForTarget.totalPostings,totalTickets:relevantDataForTarget.totalTickets,book_of_business_id:relevantDataForTarget.book_of_business_id,minPrice:relevantDataForTarget.minPrice,is_ga_event:relevantDataForTarget.venue_config_ga_ind}};if(typeof isScrubbed!="undefined"&&!isScrubbed){targetName="section";ps.section={id:0};}
C.publish("ui-link-clicked",{target:targetName,targetId:targetId,href:href,paneSettings:ps,data:relevantDataForTarget,prefix:prefix});});$container.delegate('.star','click',function(e){e.preventDefault();e.stopPropagation();var $this=$(this),eventId=$this.attr('data-target-id'),channelId=$this.attr('data-target-channel');var relevantDataForTarget=sandbox.toArray(self.model.events).SH_getElem("id",eventId);relevantDataForTarget.stubhubDocumentType='event';sandbox.cacheEventToLS(relevantDataForTarget);var channelName=sandbox.getChannelNameById(channelId);if(channelName){sandbox.toggleStarredEvent(channelName,eventId);}});}
function bindGlobalEvents(){var self=this;C.subscribe(prefix+'-eventdata',function(data){if(timeoutRef){clearTimeout(timeoutRef);timeoutRef=null;}
this.model.set('events',data);},this);C.subscribe(prefix+'-eventdata-more',function(data){if(timeoutRef){clearTimeout(timeoutRef);timeoutRef=null;}
this.model.set('delta_events',data);},this);C.subscribe(prefix+'-eventdata-loading',function(){this.view.processing();connectSuccess=false;timeoutRef=setTimeout(function(){if(!connectSuccess){self.view.render(['unabletoconnect']);}},30*1000);},this);C.subscribe("gvar.starred.event",handleStarredUpdate);}
function unbindGlobalEvents(){C.unsubscribe("gvar.starred.event",handleStarredUpdate);C.unsubscribe(prefix+'-eventdata');C.unsubscribe(prefix+'-eventdata-more');C.unsubscribe(prefix+'-eventdata-loading');}
function handleStarredUpdate(data){var eventId=data.id,staron=data.star;var $item=$("#"+prefix+"-"+eventId+"-star");if($item.length>0){var $fav=$item.find('.fav');var e=C.ls.getEventFromLSById(eventId);if(staron){$fav.removeClass('sprite-star_unselected').addClass('sprite-star_selected');sandbox.trackInOmniture(null,null,"star touch","star touch: "+e.description+": "+sandbox.getOmniPageName(),null,"event70",null,null,e.description);}else{$fav.removeClass('sprite-star_selected').addClass('sprite-star_unselected');sandbox.trackInOmniture(null,null,"unstar touch","unstar touch: "+e.description+": "+sandbox.getOmniPageName(),null,"event70",null,null,e.description);}}}}
EventListController.prototype=new C.Controller();this.init=function(){opt=sandbox.options;prefix=opt.prefix||"evl";parent=opt.parentName||"EventList";container=sandbox.getContainer();$container=$(container);logPrefix="*"+parent+"---EventList*  ";connectSuccess=false;this.m=new C.Model();this.v=new EventListView(this.m);this.c=new EventListController(this.m,this.v);this.c.init();};this.destroy=function(){};};})(StubHub);(function(SH){var __template=function(prefix){return['<div id="',prefix,'-genrelist"><div class="genre_item genre_item_nofav border-box hidden" id="',prefix,'-genreitem">','<div class="fav_wrap ',prefix,'_starred" id="genrelist-',prefix,'-star">','<div class="fav sprite sprite-star_unselected">','<div class="stararea ',prefix,'_stararea">','</div></div></div>','<div href="" class="genrelist_a genre_select ',prefix,'-link" id="genrelist-',prefix,'-link">','<div id="genrelist-',prefix,'-desc" class="genre_text"></div>','</div></div></div>'].join('');};SH.Modules.GenreList=SH.Modules.GenreList||function GenreList(sandbox){var opt,prefix,parent,container,$container,logPrefix,useDynamicHTML,connectSuccess,$templateGenre,enableFav;var timeoutHandler;var C=sandbox.core;function GenreListView(){this.constructor.apply(this,arguments);var $target=$(container);if(useDynamicHTML){$target.html(__template(prefix));}
$templateGenre=$('#'+prefix+"-genreitem").remove();if(!useDynamicHTML){var $processing=$target.find("#"+prefix+"-genre-processing").remove().removeClass("hidden"),$unabletoconnect=$target.find("#"+prefix+"-genre-unabletoconnect").remove().removeClass("hidden"),$noresults=$target.find("#"+prefix+"-genre-noresults").remove().removeClass("hidden");}
this.render=function(keys){if(keys){switch(keys[0]){case"genres":connectSuccess=true;buildGenreList.call(this,this.model.genres);break;case"delta_genres":connectSuccess=true;buildGenreList.call(this,this.model.delta_genres,true);this.model.set('genres',this.model.genres.concat(this.model.delta_genres),true);this.model.set('delta_genres',null,true);break;case"unabletoconnect":showUnableToConnectMsg();break;}}
sandbox.publish("view-rendered",parent);};this.processing=function(){$noresults.addClass('hidden');$unabletoconnect.remove();$target.append($processing);};function showUnableToConnectMsg(){$processing.remove();$target.append($unabletoconnect);if($("#espn-loading").length!=0){$("#espn-loading").addClass('hidden');}}
function buildGenreList(genres,noempty){var $targetList=$target.find('#'+prefix+'-genrelist');if(!useDynamicHTML){$processing.remove();$unabletoconnect.remove();}
if(!genres){$targetList.empty();return;}
$target.addClass('hidden');$targetList.remove();if(!noempty){$targetList.empty();}
if(genres.length>0){if(!noempty){for(var i=0,m=genres.length;i<m;i++){var _item=generateGenreItem(genres[i]);$targetList.append(_item);}
var placeholderHtml='<div class="genre_item border-box genre_item_placeholder"><div class="genre_item_placeholder_text">&nbsp;</div></div>';var clearHtml='<div class="genre_item_clear"></div>';var phs=placeholderHtml+placeholderHtml+clearHtml;$targetList.append(phs);}else{var $holder=$targetList.find('.genre_item_placeholder');for(var j=0,jm=genres.length;j<jm;j++){generateGenreItem(genres[j]).insertBefore($holder);}}}else{if(!useDynamicHTML){$target.append($noresults.removeClass('hidden'));}}
$target.append($targetList);$target.removeClass('hidden');}
function generateGenreItem(genre){var genreId=genre.id,genreDesc=sandbox.getGenreDescription(genre),urlpath=genre.urlpath,$newRow=$templateGenre.clone().removeClass('hidden').attr("id",prefix+"-genre-"+genreId);var temp={"star":{data:{"target-id":genreId,"target-channel":genre.channelId}},"link":{"href":'/'+urlpath+'/',data:{"target-id":genreId,"target-leaf":genre.leaf}},"desc":{text:genreDesc.replace(/ tickets/i,"")}};sandbox.prefillDom({$elem:$newRow,tgtPrefix:"genrelist-"+prefix+"-",newPrefix:prefix+"-"+genreId+"-",data:temp});var channelName=sandbox.getChannelNameById(genre.channelId);if(channelName){var isStarred=sandbox.isStarredGenre(channelName,genreId);if(isStarred){$newRow.find('.fav').removeClass('sprite-star_unselected').addClass('sprite-star_selected');}}
if(enableFav){$newRow.removeClass('genre_item_nofav');}else{$newRow.find('.fav_wrap').remove();}
return $newRow;}}
GenreListView.prototype=new C.View();function GenreListController(){this.constructor.apply(this,arguments);this.init=function(){bindGlobalEvents.call(this);if(this.view){bindViewEvents.call(this);}
$container.removeClass('hidden');};this.destroy=function(){if(this.view){unbindViewEvents.call(this);}
unbindGlobalEvents.call(this);this.model=this.view=undefined;};function bindViewEvents(){var self=this;if(container){var $container=$(container);$container.delegate('.'+prefix+'-link','click',function(e){C.publish("ui-link-clicked:before",{prefix:prefix,type:2});e.preventDefault();e.stopPropagation();var $this=$(this),targetName="genre",targetId=$this.attr('data-target-id'),leaf=$this.attr('data-target-leaf'),href=$this.attr('href'),relevantDataForTarget=sandbox.toArray(self.model.genres).SH_getElem("id",targetId);sandbox.cacheGenreToLS(relevantDataForTarget);var _d={target:targetName,targetId:targetId,href:href,data:relevantDataForTarget,paneSettings:{channelId:relevantDataForTarget.channelId,genre:{id:targetId,desc:sandbox.getGenreDescription(relevantDataForTarget),ancestorDescriptions:self.model.genres.ancestorDescriptions,artistPrimaryStyle:self.model.genres.artistPrimaryStyle,leaf:(leaf=="true")}}};if(relevantDataForTarget.pageType=='bigsports'){_d.paneSettings.genre.bigsports=true;}
if($container.attr("id")=="srch-genrelist-wrapper"){sandbox.publish("search-genre-click",_d);}
C.publish("ui-link-clicked",_d);});$container.delegate('.'+prefix+'_stararea','click',function(e){e.preventDefault();e.stopPropagation();var $this=$(this).parent().parent(),genreId=$this.attr('data-target-id'),channelId=$this.attr('data-target-channel');var relevantDataForTarget=sandbox.toArray(self.model.genres).SH_getElem("id",genreId);sandbox.cacheGenreToLS(relevantDataForTarget);var channelName=sandbox.getChannelNameById(channelId);if(channelName){var isStarred=sandbox.isStarredGenre(channelName,genreId);if(!isStarred){var _item=sandbox.getGenreDescription(relevantDataForTarget);sandbox.trackInOmniture(null,null,"star touch",null,null,"event70",null,null,_item);sandbox.trackInOmniture(null,null,"star touch","star touch: "+_item+": "+sandbox.getOmniPageName(),null,"event70",null,null,_item);}
sandbox.toggleStarredGenre(channelName,genreId);}});}}
function unbindViewEvents(){if(container){var $container=$(container);$container.undelegate('.'+prefix+'-link','click');$container.undelegate('.'+prefix+'_starred','click');}}
function bindGlobalEvents(){C.subscribe(prefix+'-genredata',function(data){this.model.set('genres',data);if(timeoutHandler){clearTimeout(timeoutHandler);timeoutHandler=null;}},this);C.subscribe(prefix+'-genredata-more',function(data){this.model.set('delta_genres',data);if(timeoutHandler){clearTimeout(timeoutHandler);timeoutHandler=null;}},this);C.subscribe(prefix+'-genredata-loading',function(data){this.view.processing();connectSuccess=false;var that=this;timeoutHandler=setTimeout(function(){if(!connectSuccess){that.view.render(['unabletoconnect']);}},4*1000);},this);C.subscribe("gvar.starred.genre",handleStarredUpdate);}
function unbindGlobalEvents(){C.unsubscribe(prefix+'-genredata');C.unsubscribe(prefix+'-genredata-more');C.unsubscribe(prefix+'-genredata-loading');C.unsubscribe("gvar.starred.genre",handleStarredUpdate);}
function handleStarredUpdate(data){var genreId=data.id,staron=data.star;var $item=$("#"+prefix+"-"+genreId+"-star");if($item.length>0){var $fav=$item.find('.fav');if(staron){$fav.removeClass('sprite-star_unselected').addClass('sprite-star_selected');}else{$fav.removeClass('sprite-star_selected').addClass('sprite-star_unselected');}}}}
GenreListController.prototype=new C.Controller();this.init=function(){opt=sandbox.options;prefix=opt.prefix||"grl";parent=opt.parentName||"GenreList";enableFav=opt.enableStar;container=sandbox.getContainer();$container=$(container);logPrefix="*"+parent+"---GenreList---"+prefix+"*  ";connectSuccess=false;useDynamicHTML=(opt.html=='dynamic');if(container&&typeof this.__template=='undefined'){this.__template=$(container).html();}
this.m=new C.Model();this.v=new GenreListView(this.m);this.c=new GenreListController(this.m,this.v);this.c.init();if(opt.data){this.m.set('genres',opt.data);}};this.destroy=function(){var $container=$(container);$container.addClass('hidden');this.c.destroy(sandbox);if(!useDynamicHTML){$container.empty().html(this.__template);}
this.__template=this.c=this.v=this.m=null;container=null;};};})(StubHub);(function(SH){SH.Modules.ESPNGenre=SH.Modules.ESPNGenre||function ESPNGenre(sandbox){var key="9nrqbfsah2m6sprwtntth3kv";var allowedGenres=['81','121','115','144'];var allowedEspnURLs=['/baseball/mlb','/football/nfl','/basketball/nba','/hockey/nhl'];var espnURL='http://api.espn.com/v1/sports';var allteam_html=function(id,name){return'<div id="browse-espn-league-'+id+'" class="hidden espn-league"><div id="browse-espn-league-head-'+id+'" class="genre_section_title"><div class="genre_toggle sprite ui-toggle-icon sprite-minus_sign"></div><div class="genre_section_title_text bold">'+name+'</div></div><div id="browse-espn-league-'+id+'-areas" class="genre_sub_sections"></div></div>';};var league_html=function(id,name){return'<div id="browse-espn-league-area-'+id+'" class="genre_sub_section"><div class="genre_sub_section_title bold">'+name+'</div><div id="browse-espn-team-in-'+id+'"></div></div>';};var container;function getEspnUrl(genreId){var idx=allowedGenres.indexOf(genreId+"");if(idx===-1){return;}
return espnURL+allowedEspnURLs[idx]+'/standings';}
function ESPNGenreModel(){this.constructor.apply(this,arguments);}
ESPNGenreModel.prototype=new StubHubCore.Model();function ESPNGenreView(){this.constructor.apply(this,arguments);var $processing=$(container).find('#espn-loading').remove().removeClass('hidden');var $allteamTitle=$(container).find('#browse-espn-genrelist-title').remove().removeClass('hidden');this.render=function(keys){if(keys){switch(keys[0]){case"espn_data":generateView.call(this,this.model.espn_data);break;}}};this.processing=function(){var $c=$(container);$c.find('.espn-league').addClass('hidden');if($c.find('#espn-loading').length===0){$c.prepend($processing.clone());}};function generateView(data){var league=data.sports[0].leagues[0],group_in_league=league.groups,$container=$(container).empty(),_array=[];var espnErrorOccurred=false;if(group_in_league.length>0){for(var i=0,im=group_in_league.length;i<im;i++){var g=group_in_league[i],g_name=g.name,g_abbr=g.abbreviation,g_group=g.groups;if(g_abbr.indexOf(' ')!=-1){g_abbr=g_abbr.split(' ').join('_');}
var $league_wrap=$(allteam_html(g_abbr,g_name));if(g_group){var $area_wrap=$league_wrap.find('#browse-espn-league-'+g_abbr+'-areas');for(var j=0,jm=g_group.length;j<jm;j++){var area=g_group[j],a_name=area.name,a_abbr=area.abbreviation,a_teams=area.competitors;if(a_teams.length==0){espnErrorOccurred=true;break;}
$area_wrap.append(league_html(a_abbr,a_name));var genrelist_opts={prefix:a_abbr,parentName:'ESPN Genre',container:'browse-espn-team-in-'+a_abbr,html:'dynamic',data:getGenreList.call(this,a_teams)};_array.push(genrelist_opts);}
if(espnErrorOccurred){break;}}else if(g.competitors){var genrelist_opts={prefix:g_abbr,parentName:'ESPN Genre',container:'browse-espn-league-'+g_abbr+'-areas',html:'dynamic',data:getGenreList.call(this,g.competitors)};_array.push(genrelist_opts);}
$container.append($league_wrap.removeClass('hidden'));}}else{espnErrorOccurred=true;}
if(espnErrorOccurred){var labbr=league.abbreviation.replace(/\./g,"_");var $gl=$('<div id="browse-espn-league-'+labbr+'" class="hidden"></div>');var $glwrapper=$('<div id="browse-espn-league-'+labbr+'-wrapper" class="espn-league"></div>');$glwrapper.append($allteamTitle.clone()).append($gl);$container.append($glwrapper);var _tempgs=[],_tempgenres=this.model.tempgenres;for(var k=0,km=_tempgenres.length;k<km;k++){var _gen=_tempgenres[k];if(_gen.sportsTeam&&_gen.sportsTeam==_gen.id){_tempgs.push(_gen);}}
var genrelist_opts={prefix:labbr,parentName:'ESPN Genre',container:'browse-espn-league-'+labbr,html:'dynamic',data:_tempgs};_array.push(genrelist_opts);}
this.model.set('_teams_in_areas',_array);}
function getGenreList(competitors){var genres=this.model.genres,ret=[];for(var i=0,m=competitors.length;i<m;i++){var c=competitors[i],c_abbr=c.team.abbreviation,g=genres[c_abbr];if(g){ret.push(g);}else{if(c_abbr==="BKN"){ret.push(genres["NJ"]);}}}
return ret;}}
ESPNGenreView.prototype=new StubHubCore.View();function ESPNGenreController(){this.constructor.apply(this,arguments);this.init=function(){if(typeof bindGlobalEvents=='function'){bindGlobalEvents.call(this);}
if(typeof bindViewEvents=='function'){bindViewEvents.call(this);}
this.model.change(function(keys){if(keys){if(keys[0]=='genreId'){console.log('before call getESPNData')
getESPNData.call(this,this.model.genreId);}else if(keys[0]=='_teams_in_areas'){this.runningGenres=this.model._teams_in_areas;startAllSubGenres.call(this);}}},this);};function getESPNData(genreId){var self=this,url=getEspnUrl(genreId);if(url){sandbox.getJSON(url,'_accept=json&apikey='+key,function(data){if(data.status=="success"){self.model.set('espn_data',data);}});window.setTimeout(function(){if(self.model&&self.model.espn_data===undefined){$("#espn-loading").addClass("hidden");}},4*1000);}}
function bindViewEvents(){var self=this;if(container){var $container=$(container);$container.delegate('.genre_section_title',"click",function(e){var $this=$(this),$toggle=$this.find('.genre_toggle'),$list=$(this.nextSibling);if($toggle.hasClass('sprite-plus_sign')){$toggle.removeClass('sprite-plus_sign').addClass('sprite-minus_sign');$list.removeClass('hidden');}else if($toggle.hasClass('sprite-minus_sign')){$toggle.removeClass('sprite-minus_sign').addClass('sprite-plus_sign');$list.addClass('hidden');}
sandbox.publish('view-rendered','ESPNGenre');});}}
function bindGlobalEvents(){sandbox.core.subscribe('espn-genres',function(data){var genres=data.genres,_genres={};for(var i=0,im=genres.length;i<im;i++){var g=genres[i];_genres[g.espnAbbr]=g;}
this.model.set('tempgenres',data.genres,false);this.model.set('genres',_genres);if(this.model.genreId!=data.genreId){console.log('change genreId, need to stop all sub genres')
stopAllSubGenres.call(this);this.model.set('genreId',data.genreId);}else{var $c=$(container);$c.find('#espn-loading').remove();$c.find('.espn-league').removeClass('hidden');}},this);sandbox.core.subscribe('espn-genres-loading',function(data){this.view.processing();},this);}
function unbindGlobalEvents(){sandbox.core.unsubscribe('espn-genres');}
function startAllSubGenres(){if(this.runningGenres&&this.runningGenres.length>0){for(var i=0,m=this.runningGenres.length;i<m;i++){var config=this.runningGenres[i];sandbox.core.register('ESPN_'+config.prefix,SH.Modules.GenreList,config);sandbox.core.start('ESPN_'+config.prefix);}}
sandbox.publish("view-rendered",'ESPN Genre x');}
function stopAllSubGenres(){if(this.runningGenres&&this.runningGenres.length>0){for(var i=0,m=this.runningGenres.length;i<m;i++){var config=this.runningGenres[i];sandbox.core.stop('ESPN_'+config.prefix);sandbox.core.unregister('ESPN_'+config.prefix);}
this.runningGenres=[];}}}
ESPNGenreController.prototype=new StubHubCore.Controller();this.init=function(){container=sandbox.getContainer();this.m=new ESPNGenreModel();this.v=new ESPNGenreView(this.m);this.c=new ESPNGenreController(this.m,this.v);this.c.init(sandbox);}
this.destroy=function(){}};})(StubHub);(function(SH){SH.Modules.EventFilter=SH.Modules.EventFilter||function(sandbox){var C=sandbox.core,getCMsg=C.util.getConditionMsg,subscribe=C.subscribe,publish=C.publish;function refresh(){sandbox.core.publish('view-rendered','EventFilterModule');}
function getLabelFromSelectByValue(selector,val){var $s=$(selector);if(!val){val=$s.val();}
var label=$s.find('option[value="'+val+'"]').text();return label;}
function isNumeric(input){var RE=/^-{0,1}\d*\.{0,1}\d+$/;return(RE.test(input)&&input.length>0);}
function EventFilterView(){this.constructor.apply(this,arguments);var code=sandbox.getGVar("I18N.MONEY.currency.code");$("#tgt-FLT-CurrencyCode").text(code);var priceDefaltTitle=$('#price_filter').find('.filter_default_title').text();var sortoptions=[];for(var i=0;i<6;i++){sortoptions.push($('#sort__'+i).remove());}
this.render=function(keys){if(keys&&keys[0]){var k=keys[0];var v=this.model[k];switch(k){case'ev':updateSortView.call(this);break;case'page':var $sort=$('#sort').empty();$sort.append(sortoptions[0]).append(sortoptions[1]);if(v=='event'){}else{$sort.append(sortoptions[2]).append(sortoptions[3]);}
updateSortView.call(this);return;case'genreId':$('#quantity').val('');return;case'quantity':$('#'+k).val(v);$('#f_quantity_title').text(getCMsg('filter_quantity',[v=="1"?"1":"2"],[v]));break;case'sort':case'delivery':$('#'+k).val(v);$('#f_'+k+'_title').text(getLabelFromSelectByValue('#'+k,v));break;case'price':var min=v&&v.min,i=min?1:0,max=v&&v.max,j=max?1:0;$('#f_price_title').text(getCMsg('filter_price',[i,j],[min,max]));$('#fromPriceTxt').val(min);$('#toPriceTxt').val(max);break;}
if(v){$('#'+k+'_filter').addClass('applied');}else{$('#'+k+'_filter').removeClass('applied');}
if($('.efilter_item.applied').length>0){$('#reset_filter').removeClass('hidden');}else{$('#reset_filter').addClass('hidden');}
refreshWidth();}};this.setPriceTitle=function(val){val=val||priceDefaltTitle;$('#price_filter').find('.filter_default_title').text(val);};function updateSortView(){var m=this.model;if(m.page=='event'&&m.ev=='map'){$('#sort_filter').addClass('hidden');}else{$('#sort_filter').removeClass('hidden');}
refreshWidth();}
function refreshWidth(){window.setTimeout(function(){if($('#EventControlModule').hasClass('hide-me')){return;}
var w=50;var $f=$('#filter-wrapper');$f.find('.efilter_item').forEach(function(ele){w+=$(ele).width();});$f.css('minWidth',w+'px');},150);}}
EventFilterView.prototype=new C.View();function EventFilterController(){this.constructor.apply(this,arguments);var hold=false;this.init=function(){if(this.view){bindViewEvents.call(this);}
bindGlobalEvents.call(this);this.model.change(function(keys){if(keys&&keys[0]){var k=keys[0],m=this.model,v=m[keys[0]],gId=m.genreId;var fs=getExistingFilter(gId);if(k=='genreId'){if(fs){hold=true;m.set('quantity',fs.quantity);m.set('price',fs.price);m.set('delivery',fs.delivery);if(m.page=="event"){m.set('sort',fs.sort);}else if(m.page=='section'){m.set('sort',fs.ssort);}
hold=false;}else{reset.call(this,true);}}else if(k=='page'){if(fs){if(v=="event"){m.set('sort',fs.sort||"0");}else if(v=='section'){m.set('sort',fs.ssort||"0");}}}else if(k=='ev'){}else{sync.call(this,m,k);}}},this);var state=sandbox.getCurrentState();handleDataFromURLState.call(this,{state:state});};function reset(silent){var m=this.model;hold=true;m.set('price',null,!!silent);m.set('quantity','',!!silent);m.set('sort',0,!!silent);m.set('delivery','',!!silent);hold=false;sandbox.setGVar('filter.'+m.genreId,undefined,true);if(!silent){broadcast.call(this,'all');}
$('#fromPriceTxt, #toPriceTxt').val('');$('#EventFilterHeader').find('.efilter_item').removeClass('applied');$('#EventFilterContainer').hide();}
function sync(m,k){console.log('doing sync',m,k);var lastchange=k;if(m&&m.genreId){var pfx='filter.'+m.genreId;if(k=='sort'){if(m.page=='section'){lastchange='s'+k;sandbox.setGVar(pfx+'.s'+k,m[k]);}else if(m.page=='event'){if(m[k]=='0'||m[k]=='1'){if(!sandbox.getGVar(pfx+'.s'+k)){sandbox.setGVar(pfx+'.s'+k,m[k]);}}
sandbox.setGVar(pfx+'.'+k,m[k]);}}else{sandbox.setGVar(pfx+'.'+k,m[k]);}
broadcast.call(this,lastchange);}}
function broadcast(lastchange){if(!hold){publish('event-filter-change',{lastchange:lastchange,filter:getExistingFilter(this.model.genreId)});}}
function bindViewEvents(){var self=this;var $h=$('#EventFilterHeader');var $c=$('#EventFilterContainer');$('#quantity_filter').bind('click.fast',function(e){$(this).find('select')[0].focus();});$h.find('#delivery, #sort, #quantity').bind('change',function(e){e.preventDefault();e.stopPropagation();var $this=$(this),v=$this.val(),id=$this.attr('id');self.model.set(id,v);}).bind('click',function(){$('#EventFilterContainer').hide();});$h.find('#reset_filter').bind('click.fast',function(){reset.call(self);});var isIOS6=sandbox.getGVar('exec.isIOS6'),isIPad=sandbox.getGVar('exec.isIPad');if(isIOS6&&isIPad){$('#fromPriceTxt').attr('type','text');$('#toPriceTxt').attr('type','text');}
var $is=$('#fromPriceTxt, #toPriceTxt');$is.bind('keypress',function(e){var kc=e.keyCode||e.charCode;if((48<=kc&&kc<=57)){}else{if(e.keyCode==13){$c.find('#submitForm').trigger('click');this.blur();}else{e.preventDefault();}}});$('#price_filter').bind('click.fast',function(){var $cont=$('#EventFilterContainer');$cont.find('.eventfilter_container').hide();$cont.find('#price_filter_container').show();$cont.show();document.getElementById('toPriceTxt').focus();refresh();});$c.find('.a-cancel').bind('click.fast',function(e){e.preventDefault();e.stopPropagation();$c.hide();refresh();});$c.find('#submitForm').bind('click',function(){var $minP=$('#fromPriceTxt'),$maxP=$('#toPriceTxt'),minP=$minP.val(),maxP=$maxP.val(),p={};if(minP&&isNumeric(minP)){p.min=parseInt(minP,10);}else{$minP.val('');}
if(maxP&&isNumeric(maxP)){p.max=parseInt(maxP,10);}else{$maxP.val('');}
if(p.min&&p.max){if(p.min>p.max){var m=p.min;p.min=p.max;p.max=m;}
self.model.set('price',p);}else if(p.min||p.max){self.model.set('price',p);}else{self.model.set('price',null);}
$c.hide();refresh();});}
function bindGlobalEvents(){subscribe('url.update.state',handleDataFromURLState,this);subscribe('eventcontrol.switcher.type',handleEventView,this);subscribe('eventfilter.price.label.values',function(v){var min=v&&v.min,i=min?1:0,max=v&&v.max,j=max?1:0;var title=getCMsg('filter_price',[i,j],[Math.floor(min),Math.ceil(max)]);this.view.setPriceTitle(title);},this);subscribe('event-initializer-change',function(v){if(v&&v.lastchange&&v.lastchange=='price'){var price=v.filter&&v.filter.price;this.model.set('price',price);}
if(v&&v.lastchange&&v.lastchange=='quantity'){var quantity=v.filter&&v.filter.quantity;this.model.set('quantity',quantity);}},this);}
function handleEventView(sw){this.model.set('ev',sw);}
function handleDataFromURLState(data){if(data&&data.state){var state=data.state,t=state.type,ps=state.paneSettings;if(t=='event'||t=='section'||t=='ticket'){this.model.set('page',t);var agids=ps.event.ancestorGenreIds;if(!agids){agids=sandbox.getEventFromLSById(ps.event.id);agids=agids&&agids.ancestorGenreIds;}
var gId=agids&&agids.split(' ').pop();if(this.model.genreId!=gId){this.model.set('genreId',gId);}}else{this.view.setPriceTitle();}}}
function getExistingFilter(gId){return sandbox.getGVar('filter.'+gId);}}
EventFilterController.prototype=new C.Controller();this.init=function(){this.m=new C.Model();this.v=new EventFilterView(this.m);this.c=new EventFilterController(this.m,this.v);this.c.init();};this.destroy=function(){};};}(StubHub));(function(SH){SH.Modules.FilterItem=SH.Modules.FilterItem||function FilterItem(sandbox){var opt,container,prefix,parent,selectOps,logPrefix;var allowedTypes=['geo','date','loc','mlb','sortbyprice'];function FilterItemView(){this.constructor.apply(this,arguments);if(this.model.type=='geo'){$(container).addClass('geo_request');}else{$(container).removeClass('geo_request');}
this.render=function(keys){var publishRender=false;if(keys&&keys[0]=='value'){$('#'+prefix+'-selector-label').text(getLabelFromSelectByValue());}else if(keys&&keys[0]=='location'){$('#'+prefix+'-selector-label').text(sandbox.displayLocation(this.model.location));}else{if(typeof container!='undefined'){var type=this.model.type,heading=this.model.heading,$wapper=null,iconClass=getIconClass(type);if(type=='geo'){$(container).addClass('geo_request');var geoTemp=FilterItem.__template(prefix,iconClass,heading,true),$wrapper=$(geoTemp);}else{$(container).removeClass('geo_request');var temp=FilterItem.__template(prefix,iconClass,heading);$wrapper=$(temp);var $select=$wrapper.find('select'),mopts=this.model.options;var i18n=sandbox.getGVar('MSG.shared.filter');if(!mopts){if(allowedTypes.indexOf(type)!=-1){mopts=[];var dr=i18n[type];var dr_vl=dr&&dr.list&&dr.list.split(',');for(var k=0,km=dr_vl.length;k<km;k++){var _v=dr_vl[k];var _l=dr[_v];mopts.push(_v);mopts.push(_l);}
this.model.options=mopts;}}else{for(var j=0,m=mopts.length;j<m;j++){var trl=mopts[j+1];if(i18n[type]&&i18n[type][trl]){mopts[j+1]=i18n[type][trl];}
j++;}}
for(var i=0,m=mopts.length;i<m;i++){var v=mopts[i],l=mopts[i+1];$select.append('<option value="'+v+'">'+l+'</option>');i++;}
var val=this.model.value;$select.val(val);$wrapper.find('#'+prefix+'-selector-label').text(getLabelFromSelectByValue(val,$wrapper));}
if(heading){$wrapper.find('#'+prefix+"-filter-label").text(heading);}
$(container).empty().append($wrapper).removeClass('hidden');}}};function getLabelFromSelectByValue(val,parent){var $s=parent?parent.find('#'+prefix+'-selector'):$('#'+prefix+'-selector');if(!val){val=$s.val();}
var label=$s.find('option[value="'+val+'"]').text();return label;}
function getIconClass(type){if(!type)return null;switch(type){case'date':return'sprite-filter_date';case'geo':case'mlb':case'loc':return'sprite-filter_location';}
return null;}}
FilterItemView.prototype=new StubHubCore.View();function FilterItemController(){this.constructor.apply(this,arguments);this.init=function(sandbox){this.sandbox=sandbox;if(typeof bindGlobalEvents=='function'){bindGlobalEvents.call(this,sandbox);}
if(this.model.type=='geo'){var geoLocation=sandbox.getGVar('geo.location')||{geoId:0,geoName:'All locations',position:undefined};this.model.set('location',geoLocation);}
this.model.change(function(keys){if(keys&&keys[0]=='location'){if(this.model.type=='geo')
sandbox.core.publish(prefix+'-filter-value',this.model.location);}},this);if(this.view){if(typeof bindViewEvents=='function'){bindViewEvents.call(this,sandbox);}}};this.destroy=function(sandbox){if(typeof unbindViewEvents=='function'){unbindViewEvents.call(this,sandbox);}
if(typeof unbindGlobalEvents=='function'){unbindGlobalEvents.call(this,sandbox);}
$(container).removeClass('geo_request');};function bindViewEvents(sandbox){var self=this;if(container){console.log(logPrefix+" bind view events")
var $container=$(container);$container.find('#'+prefix+'-selector').bind('change',function(e){e.preventDefault();e.stopPropagation();var v=$(this).val();if(v!=self.model.value){self.model.set('value',v);sandbox.core.publish(prefix+'-filter-value',self.model.value);}});if($container.hasClass('geo_request')){$container.bind('click',function(e){e.preventDefault();})}}}
function unbindViewEvents(sandbox){$('#'+prefix+'-selector').unbind('change');$(container).unbind('click');}
function bindGlobalEvents(sandbox){sandbox.core.subscribe('gvar.geo.location',handleGeoUpdate,this);}
function unbindGlobalEvents(sandbox){sandbox.core.unsubscribe('gvar.geo.location',handleGeoUpdate);}
function handleGeoUpdate(location){if(this.model.type=='geo'){if(this.model.location.geoId!=location.geoId){this.model.set('location',location);}}}}
FilterItemController.prototype=new StubHubCore.Controller();this.init=function(){opt=sandbox.options;prefix=opt.prefix||"evl";parent=opt.parentName||"FilterItem";selectOps=opt.selectOptions;container=sandbox.getContainer();logPrefix="*"+parent+"---FilterItem*  ";var obj={options:selectOps,type:opt.type,value:opt.selectValue,heading:opt.heading};this.m=new StubHubCore.Model(obj);this.v=new FilterItemView(this.m);this.m.change();this.c=new FilterItemController(this.m,this.v);this.c.init(sandbox);}
this.destroy=function(){this.c.destroy(sandbox);this.m=this.v=this.c=null;$(container).addClass('hidden');container=null;}};SH.Modules.FilterItem.__template=function(prefix,iconstyle,heading,noselect){return['<div id="',prefix,'-selector-wrapper" class="filter_item_container">',(noselect?'':'<div class="select_wrapper filter_item_select_hidden border-box"><select id="'+prefix+'-selector" class="filter_item_selector"></select></div>'),(iconstyle?('<div class="filter_item_icon border-box"><span class="sprite '+iconstyle+'"></span></div>'):''),(heading?('<div class="filter_item_heading border-box" id="'+prefix+'-filter-label"></div>'):""),'<div id="',prefix,'-selector-label" class="filter_item_label bold"></div></div>'].join('');};})(StubHub);(function(SH){SH.Modules.GenreEventList=SH.Modules.GenreEventList||function(sandbox){var eStart,eDays,eRows,eNumFound;var eStartTwo,eRowsTwo,eNumFoundTwo;function GenreEventListModel(){this.constructor.apply(this,arguments);this.reset=function(){this.startPos=eStart;this.startPosTwo=eStartTwo;this.nrOfRows=eRows;this.nrOfRowsTwo=eRowsTwo;this.sortField="event_date_local";this.sortDirection="asc";this.dateRange=eDays+"d";this.nrEventsFound=null;this.nrEventsFoundTwo=null;}}
GenreEventListModel.prototype=new StubHubCore.Model();function GenreEventListView(){this.constructor.apply(this,arguments);var $tgt_nrDays=$("#gleaf-dateSelector");var $wrapper=$('#gleaf-list-wrapper');var $wrapperTwo=$('#gleaf-two-list-wrapper');var $getMoreCtrl=$('#gleaf-list-getmore');var $getMoreCtrlTwo=$('#gleaf-two-list-getmore');this.render=function(keys){if(keys){if(keys[0]=='nrEventsFound'){if(this.model.nrEventsFound>0){$wrapper.removeClass("hidden");if(this.model.nrEventsFound<6){$wrapperTwo.removeClass("hidden");}else{$wrapperTwo.addClass("hidden");}}else{$wrapper.addClass("hidden");}}else if(keys[0]=='hasMoreEvent'){if(this.model.hasMoreEvent){$getMoreCtrl.removeClass('hidden');}else{$getMoreCtrl.addClass('hidden');}}
if(keys[0]=='nrEventsFoundTwo'){if(this.model.nrEventsFound<6&&this.model.nrEventsFoundTwo>0){$wrapperTwo.removeClass("hidden");}}
else if(keys[0]=='hasMoreEventTwo'){if(this.model.hasMoreEventTwo){$getMoreCtrlTwo.removeClass('hidden');}else{$getMoreCtrlTwo.addClass('hidden');}}}};}
GenreEventListView.prototype=new StubHubCore.View();function GenreEventListController(){this.constructor.apply(this,arguments);var eventListLoaded=false,eNumFound;var events_opts={prefix:'gleaf',parentName:'GenreLeafModule',container:'gleaf-list-wrapper'};var eventListTwoLoaded=false,eNumFoundTwo;var events_two_opts={prefix:'gleaf-two',parentName:'GenreLeafModule',container:'gleaf-two-list-wrapper'};var loc_options={prefix:'gleaf-loc',parentName:'GenreEventList',container:'gleaf-loc-filter',selectValue:'home',type:'loc'};this.init=function(sandbox){this.sandbox=sandbox;if(sandbox.core.lsModules().indexOf('GenreLeafEventList')==-1){sandbox.core.register('GenreLeafEventList',SH.Modules.EventList,events_opts);sandbox.core.start('GenreLeafEventList');}
if(sandbox.core.lsModules().indexOf('GenreLeafTwoEventList')==-1){sandbox.core.register('GenreLeafTwoEventList',SH.Modules.EventList,events_two_opts);sandbox.core.start('GenreLeafTwoEventList');}
if(sandbox.core.lsModules().indexOf('GenreLeafLocFilter')==-1){sandbox.core.register('GenreLeafLocFilter',SH.Modules.FilterItem,loc_options);}
if(typeof bindGlobalEvents=='function'){bindGlobalEvents.call(this,this.sandbox);}
var container=sandbox.getContainer();if(this.view){if(container){this.view.container=container;}
if(typeof bindViewEvents=='function'){bindViewEvents.call(this,this.sandbox);}}
this.model.change(function(keys){var that=this;var getSecondList=function(){that.getTwoEventList(that.model);};if(keys){if(keys[0]=='geoId'){eStart=0;eStartTwo=0;this.model.reset();$('#gleaf-list-wrapper').addClass('hidden');$('#gleaf-two-list-wrapper').addClass('hidden');this.getEventList(this.model,getSecondList);}else if(keys[0]=='genre_id'){eStart=0;eStartTwo=0;this.model.set('hasMoreEvent',false);this.model.set('hasMoreEventTwo',false);this.model.reset();getEventListByPageType.call(this);updateLocationFilter.call(this);}else if(keys[0]=='startDate'){eStart=0;eStartTwo=0;getEventListByPageType.call(this);}else if(keys[0]=='nrEventsFound'){if(this.model.geoId!='0'&&this.model.nrEventsFound==0){$('#gleaf-list-wrapper').addClass('hidden');}}else if(keys[0]=='nrEventsFoundTwo'){if(this.model.nrEventsFoundTwo==0){$('#gleaf-two-list-wrapper').addClass('hidden');}}}},this);if(typeof sandbox.getCurrentState=='function'){var state=sandbox.getCurrentState();if(state&&state.type&&state.url){getDataFromURLState.call(this,{state:state});}}};this.destroy=function(sandbox){if(typeof unbindViewEvents=='function'){unbindViewEvents.call(this,this.sandbox);}
if(typeof unbindGlobalEvents=='function'){unbindGlobalEvents.call(this,this.sandbox);}
sandbox.core.stop('GenreLeafEventList');sandbox.core.stop('GenreLeafTwoEventList');sandbox.core.stop('GenreLeafLocFilter');}
this.getRelatedGenres=function(sportsTeamId,callback){var self=this,avd=sandbox.getGVar('exec.lcsquery.genre.allowedViewingDomain'),querystring="q=stubhubDocumentType:genre AND active:1 AND sportsTeam:"+sportsTeamId+avd+"&start=0&fl="+sandbox.getGVar('exec.lcsquery.genre.minfl')+"gameType espnAbbr&wt=json&json.wrf=?",lcsServiceUrl=this.sandbox.getGVar('site.lcsService');var toCache={};sandbox.getJSON(lcsServiceUrl,querystring,function(data){var docs=data.response.docs;for(var i=0,m=docs.length;i<m;i++){var g=docs[i];toCache[g.gameType]=g.id;toCache[g.id]=g.gameType;g.channelId="28";sandbox.cacheGenreToLS(g);}
if(docs.length>0){sandbox.cacheBigSportsMappingToLS(sportsTeamId,toCache);}
if(typeof callback=='function')callback.call(self,self.model);});};this.getOutsideEventList=function(q){if(!q.genre_id)return;var self=this,startTwo=q.startPosTwo||"0",geoIdTwo=q.geoId||"0",avdTwo=sandbox.getGVar('exec.lcsquery.event.allowedViewingDomain'),querystringTwo="q=stubhubDocumentType:event AND active:1 AND cancelled:0"+avdTwo+
(q.pageType!='college'?(q.channelId=="1"?" AND (ancestorGenreIds:"+q.genre_id+" OR artistPrimaryStyle:"+q.genre_id+" OR artistSecondaryStyle:"+q.genre_id+" OR accompanyingAct:"+q.genre_id+")":" AND ancestorGenreIds:"+q.genre_id):" AND (college:"+q.genre_id+" OR neutralTeam:"+q.genre_id+")")+" AND -ancestorGeoIds:"+geoIdTwo+"&start="+startTwo+"&rows="+(q.nrOfRowsTwo||eRowsTwo)+"&fl="+this.sandbox.getGVar('exec.lcsquery.event.minfl')+' minPrice currency_code'+"&wt=json&json.wrf=?"+"&sort="+(q.sortField||"event_date_local")+" "+(q.sortDirection||"asc"),lcsServiceUrl=this.sandbox.getGVar('site.lcsService');if(geoIdTwo=='0'){$('#genre_result_outside_area').addClass('hidden');}
self.model.set('hasMoreEventTwo',false);if(self.model.nrEventsFound>5){$('#genre_result_outside_area').addClass('hidden');return;}else if(self.model.nrEventsFound<5){sandbox.core.publish('gleaf-two-eventdata-loading');sandbox.getJSON(lcsServiceUrl,querystringTwo,function(data){var respTwo=data.response,respHeaderTwo=data.responseHeader,numFTwo=respTwo.numFound,startTwo=respTwo.start,countTwo=respTwo.docs.length;if(respHeaderTwo.params.q){if(respHeaderTwo.params.q.indexOf(q.genre_id)==-1)return;}
eStartTwo=startTwo+countTwo;eNumFoundTwo=numFTwo;self.model.set('nrEventsFoundTwo',numFTwo);if(numFTwo>0){$('#genre_result_outside_area').removeClass('hidden');if(startTwo==0&&countTwo!=0){if(eStartTwo<numFTwo){self.model.set('hasMoreEventTwo',true);}else{self.model.set('hasMoreEventTwo',false);}
sandbox.core.publish('gleaf-two-eventdata',respTwo.docs);}else if(startTwo!=0&&countTwo!=0){sandbox.core.publish('gleaf-two-eventdata-more',respTwo.docs);}}
if(numFTwo==0&&self.model.nrEventsFound==0){sandbox.core.publish('gleaf-eventdata',null);}});}};this.getSimilarArtistEventsList=function(q){var self=this;if(!q.genre_id)return;var gId=q.genre_id;var geo=q.geoId||'0';if(q.geoId=='0'){$('#similar_genre_result').addClass('hidden');}else if(q.geoId!='0'){var recommendationApiUrl=sandbox.getGVar('site.recommendationApiURL');var queryString="?_type=json&limit=5&geoId="+geo+"&genreId="+gId+"&category=CONCERTS&minAvailableTickets=10&maxEventsPerGenre=1";sandbox.StubHubService(recommendationApiUrl+queryString,{success:function(data){var respTwo=data.eventRecommendation.events;var numFTwo=respTwo.length;var eNumFoundTwo=numFTwo;var evIds=[];for(i=0;i<respTwo.length;i++){var evId=respTwo[i].eventId;evIds.push(evId);}
self.model.set('nrEventsFoundTwo',numFTwo);syncEvents(evIds,function(docs){var events=[];for(i=0;i<evIds.length;i++){for(j=0;j<docs.length;j++){if(evIds[i]===docs[j].id){events.push(docs[j]);continue;}}}
if(numFTwo>0&&self.model.nrEventsFound<6){$('#similar_genre_result').removeClass('hidden');sandbox.core.publish('gleaf-two-eventdata',events);}else if(numFTwo>0&&self.model.nrEventsFound>6){$('#similar_genre_result').addClass('hidden');$wrapperTwo.addClass("hidden");}});},error:function(data){},name:'Recommendation API',omniPageName:'mWeb: Genre Leaf'});}}
this.getTwoEventList=function(q){var self=this;$("#genre_result_outside_area").addClass('hidden');if(q&&q.geoId!="0"){self.getOutsideEventList.call(self,self.model);}
if(sandbox.getGVar("exec.genreLeafEventsExp")===undefined&&q&&q.channelId=="1"){mboxUpdate(mweb_mbox_name.genreLeafEvents);}
else{if(self.model.nrEventsFound==0&&q.geoId!="0"){sandbox.publish('gvar.geo.location',{geoId:0});}}}
this.getEventList=function(q,callback){if(!q.genre_id)return;var self=this,start=q.startPos||"0",geoId=q.geoId||"0",avd=sandbox.getGVar('exec.lcsquery.event.allowedViewingDomain'),querystring="q=stubhubDocumentType:event AND active:1 AND cancelled:0 AND totalTickets:[1 TO *]"+avd+
(q.pageType!='college'?(q.channelId=="1"?" AND (ancestorGenreIds:"+q.genre_id+" OR artistPrimaryStyle:"+q.genre_id+" OR artistSecondaryStyle:"+q.genre_id+" OR accompanyingAct:"+q.genre_id+")":" AND ancestorGenreIds:"+q.genre_id):" AND (college:"+q.genre_id+" OR neutralTeam:"+q.genre_id+")")+" AND ancestorGeoIds:"+geoId+"&start="+start+"&rows="+(q.nrOfRows||eRows)+"&fl="+this.sandbox.getGVar('exec.lcsquery.event.minfl')+' minPrice currency_code'+"&wt=json&json.wrf=?"+"&sort="+(q.sortField||"event_date_local")+" "+(q.sortDirection||"asc"),lcsServiceUrl=this.sandbox.getGVar('site.lcsService');self.model.set('hasMoreEvent',false);sandbox.core.publish('gleaf-eventdata-loading');sandbox.getJSON(lcsServiceUrl,querystring,function(data){var resp=data.response,respHeader=data.responseHeader,numF=resp.numFound,start=resp.start,count=resp.docs.length;if(respHeader.params.q){if(respHeader.params.q.indexOf(q.genre_id)==-1)return;}
eStart=start+count;eNumFound=numF;if(eStart<numF){self.model.set('hasMoreEvent',true);}else{self.model.set('hasMoreEvent',false);}
self.model.set('nrEventsFound',numF);if(q.geoId=='0'&&numF==0){sandbox.core.publish('gleaf-eventdata',null);}
if(start==0&&count!=0){sandbox.core.publish('gleaf-eventdata',resp.docs);}else if(start!=0&&count!=0){sandbox.core.publish('gleaf-eventdata-more',resp.docs);}else{}
if(callback){callback();}});};function syncEvents(eids,callback){var self=this;var ids=eids.join(' ');var url=sandbox.getGVar('site.lcsService'),avd=sandbox.getGVar('exec.lcsquery.event.allowedViewingDomain'),fl='&fl='+sandbox.getGVar('exec.lcsquery.event.minfl')+' minPrice currency_code';var qs="q=stubhubDocumentType:event%20AND%20active:1%20AND%20id:("+ids+")"+avd+fl+"&start=0&wt=json&json.wrf=?";sandbox.getJSON(url,qs,function(data){var resp=data.response,docs=resp.docs;if(typeof callback=='function'){callback.call(self,docs);}});}
this.getSportsList=function(q){var m=sandbox.getBigSportsMapping(q.sportsTeam),gameType=q.gameType||m[q.genre_id];var genre_parents=[],visitingTeams=[],neutralTeams=[];switch(gameType){case'regular':genre_parents.push(m.regular);genre_parents.push(m.playoff);genre_parents.push(m.springtraining);neutralTeams.push(m.regular);loc_options.selectValue='home';break;case'playoff':genre_parents.push(m.playoff);neutralTeams.push(m.playoff);loc_options.selectValue='home';break;case'springtraining':genre_parents.push(m.springtraining);loc_options.selectValue='springtraining';break;case'schedule':genre_parents.push(m.regular);genre_parents.push(m.playoff);visitingTeams.push(m.regular);visitingTeams.push(m.playoff);neutralTeams.push(m.regular);loc_options.selectValue='all';break;case'road':visitingTeams.push(m.regular);visitingTeams.push(m.playoff);loc_options.selectValue='road';break;}
var start=q.startPos||"0",self=this,lcsServiceUrl=this.sandbox.getGVar('site.lcsService'),avd=sandbox.getGVar('exec.lcsquery.event.allowedViewingDomain'),parentQuery,querystring;if(genre_parents.length==0){parentQuery='visitingTeam:('+visitingTeams.join(' ')+')';}else if(visitingTeams.length==0){if(this.model.isNFL&&neutralTeams.length>0){parentQuery='(genre_parent:('+genre_parents.join(' ')+') OR neutralTeam:('+neutralTeams.join(' ')+'))';}else{parentQuery='genre_parent:('+genre_parents.join(' ')+')';}}else{if(this.model.isNFL&&neutralTeams.length>0){parentQuery='(genre_parent:('+genre_parents.join(' ')+') OR visitingTeam:('+visitingTeams.join(' ')+') OR neutralTeam:('+neutralTeams.join(' ')+'))';}else{parentQuery='(genre_parent:('+genre_parents.join(' ')+') OR visitingTeam:('+visitingTeams.join(' ')+'))';}}
querystring="q=stubhubDocumentType:event AND active:1 AND cancelled:0 AND totalTickets:[1 TO *]"+avd+" AND "+parentQuery+"&start="+start+"&rows="+(q.nrOfRows||eRows)+"&fl="+this.sandbox.getGVar('exec.lcsquery.event.minfl')+' minPrice currency_code'+"&wt=json&json.wrf=?"+"&sort="+(q.sortField||"event_date_local")+" "+(q.sortDirection||"asc");if(start==0){sandbox.core.publish('gleaf-eventdata',null);}
sandbox.core.publish('gleaf-eventdata-loading');sandbox.getJSON(lcsServiceUrl,querystring,function(data){var resp=data.response,numF=resp.numFound,start=resp.start,count=resp.docs.length;eStart=start+count;eNumFound=numF;if(eStart<numF){self.model.set('hasMoreEvent',true);}else{self.model.set('hasMoreEvent',false);}
self.model.set('nrEventsFound',numF);if(start==0){sandbox.core.publish('gleaf-eventdata',resp.docs);}else{sandbox.core.publish('gleaf-eventdata-more',resp.docs);}});};function updateLocationFilter(){var _opts={options:{}},customFilter=false;if(sandbox.core.lsInstances().indexOf('GenreLeafLocFilter')!=-1){sandbox.core.stop('GenreLeafLocFilter');}
if(this.model.pageType!='bigsports'){customFilter=true;}else{if(this.model.sportsTeam){switch(this.model.gameType){case'regular':loc_options.selectValue='home';break;case'playoff':loc_options.selectValue='home';break;case'springtraining':loc_options.selectValue='springtraining';break;case'schedule':loc_options.selectValue='all';break;case'road':loc_options.selectValue='road';break;}
if(this.model.isMLB){loc_options.type='mlb';}else{loc_options.type='loc';}
sandbox.core.start('GenreLeafLocFilter',loc_options);}else{customFilter=true;}}
if(customFilter){_opts.options.type='geo';sandbox.core.start('GenreLeafLocFilter',_opts);}}
function getEventListByPageType(){var that=this;var getSecondList=function(){that.getTwoEventList(that.model);};if(this.model.pageType=='bigsports'){if(this.model.sportsTeam){var stid=this.model.sportsTeam;var m=sandbox.getBigSportsMapping(stid);if(!m){this.getRelatedGenres(stid,this.getSportsList);}else{this.getSportsList(this.model);}}else{this.getEventList(this.model,getSecondList);}}else if(this.model.pageType=='college'){this.getEventList(this.model,getSecondList);}else{this.getEventList(this.model,getSecondList);}}
function bindViewEvents(sandbox){var _container=this.view?this.view.container:null,self=this;if(_container){var $container=$(_container);$('#gleaf-list-getmore').delegate('a',"click",function(e){self.model.set('startPos',eStart);getEventListByPageType.call(self);});$('#gleaf-two-list-getmore').delegate('a',"click",function(e){self.model.set('startPosTwo',eStartTwo);self.getTwoEventList.call(self,self.model);});}}
function unbindViewEvents(sandbox){$('#gleaf-list-getmore').undelegate('a',"click",self.getMoreEvents);$('#gleaf-two-list-getmore').undelegate('a',"click",self.getMoreEvents);$('#gleaf-geoSelector-wrapper').undelegate('select',"click");}
function monitorGeoChange(location){if(this.model.geoId!=location.geoId){this.model.set('geoName',location.geoName,true);this.model.set('geoId',location.geoId);}}
function trackEventClick(data){var id=data.eventId,sameGenreEvent=id.match("gleaf-");if(sameGenreEvent){sandbox.setOmnitureVariables({pageName:"mWeb: Genre Leaf",prop1:"Genre Intermediary"},false);var similarOtherGeoEvent=id.match("gleaf-two"),pn=sandbox.getOmniPageName(),txt="Same genre event",prop62="Events",prop61=pn+": "+prop62+": ",prop63=pn;if(similarOtherGeoEvent){if($("#similar_genre_result").hasClass("hidden")){txt="Other geo";}else{txt="Similar events";}}
prop61+=txt;sandbox.trackInOmniture(null,prop63,prop62,prop61);}}
function bindGlobalEvents(sandbox){sandbox.core.subscribe('gvar.geo.location',monitorGeoChange,this);sandbox.core.subscribe('url.update.state',getDataFromURLState,this);sandbox.core.subscribe('ui-link-clicked:before',trackEventClick);sandbox.core.subscribe(loc_options.prefix+'-filter-value',function(val){if(this.model.pageType=='bigsports'&&this.model.sportsTeam){var pt=(val=='all')?'schedule':(val=='home')?'regular':val;var m=sandbox.getBigSportsMapping(this.model.sportsTeam);var genreId=m[pt];var _genre=sandbox.getGenreFromLSById(genreId);var _d={target:'genre',targetId:genreId,href:_genre.urlpath,data:_genre,paneSettings:{channelId:_genre.channelId,genre:{id:genreId,desc:sandbox.getGenreDescription(_genre),leaf:(_genre.leaf=="true"),ancestorDescriptions:_genre.ancestorDescriptions,artistPrimaryStyle:_genre.artistPrimaryStyle,bigsports:true}}};sandbox.setOmnitureVariables({pageName:"mWeb: Genre Leaf",prop1:"Genre Intermediary"});sandbox.trackInOmniture("Genre Leaf",null,"location update",null);sandbox.core.publish("ui-link-clicked",_d);}else{if(val.geoId!=this.model.geoId){this.model.set('geoId',val.geoId);}}},this);}
function unbindGlobalEvents(sandbox){sandbox.core.unsubscribe('gvar.geo.location',monitorGeoChange);sandbox.core.unsubscribe('url.update.state',getDataFromURLState);sandbox.core.unsubscribe(loc_options.prefix+'-filter-value');sandbox.core.unsubscribe('ui-link-clicked:before',trackEventClick);}
function getDataFromURLState(data){var state=data.state,type=state&&state.type;if(type=='genre'){var self=this;var ps=state.paneSettings;if(self.model&&self.model.genre_id&&ps&&ps.genre&&ps.genre.id&&self.model.genre_id==ps.genre.id){return;}
if((""+ps.genre.leaf)=='false'){return;}
url=state.url;if(ps.channelId){self.model.set('channelId',ps.channelId,true);}
var path_metadata=sandbox.getDataByStateURL(url);if(path_metadata){var _isMLB=false,_isNFL=false;if(path_metadata.ancestorGenreIds&&path_metadata.ancestorGenreIds.search(/ 81 /)>0){_isMLB=true;}
if(path_metadata.ancestorGenreIds&&path_metadata.ancestorGenreIds.search(/ 121 /)>0){_isNFL=true;}
self.model.set('isMLB',_isMLB,true);self.model.set('isNFL',_isNFL,true);self.model.set('pageType',path_metadata.pageType,true);self.model.set('gameType',path_metadata.gameType,true);self.model.set('sportsTeam',path_metadata.sportsTeam);}else{self.model.set('pageType',(ps.genre.bigsports+''=='true')?'bigsports':null,true);self.model.set('gameType','regular',true);}
if(ps.genre.bigsports&&self.model.sportsTeam){self.model.set('geoId','0',true);self.model.set('geoName','All location',true);}else{var geoLocation=sandbox.getGVar('geo.location')||{geoId:0,geoName:sandbox.getGVar('MSG')||'All Location'};self.model.set('geoName',sandbox.displayLocation(geoLocation),true);self.model.set('geoId',geoLocation.geoId,true);}
self.model.set('genre_id',ps.genre.id);if(typeof mboxUpdate==='function'&&mweb_mbox_name&&mweb_mbox_name.genreleaf){var p1='Bigsports='+(self.model.pageType=='bigsports'),p2='Channel='+sandbox.getChannelNameById(self.model.channelId);mboxUpdate(mweb_mbox_name.genreleaf,p1,p2);}}}}
GenreEventListController.prototype=new StubHubCore.Controller();this.init=function(){eStart=0;eStartTwo=0;eDays=7;eRows=25;eRowsTwo=25;this.m=new GenreEventListModel();this.m.reset();this.v=new GenreEventListView(this.m);this.c=new GenreEventListController(this.m,this.v);this.c.init(sandbox);}
this.destroy=function(){if(this.c&&typeof this.c.destroy=='function'){this.c.destroy(sandbox);}
this.m=null;this.v=null;this.c=null;}}})(StubHub);(function(SH){SH.Modules.GenreBrowse=SH.Modules.GenreBrowse||function GenreBrowse(sandbox){var C=sandbox.core,getGVar=sandbox.getGVar,isFunc=sandbox.isFunc;var eStart=0;var M=SH.Modules;var teamGenreParentIds=['115753','80916','81016','108518'];var espnGenres=['81','121','115','144'];var concertStyleGenres=['178738','195487','195489','441194','441193','195744'];var localteam_opts={prefix:'team',parent:'GenreBrowse LocalTeams',container:'team-genrelist-wrapper'};var genrelist_opts={prefix:'tree',parentName:'GenreBrowse SubGenres',container:'tree-genrelist-wrapper'};var espn_opts={container:'browse-espn-subgenre-wrapper'};var tab_opts={prefix:'genrebrowse',parent:'GenreBrowse',tabs:'#browse-genre-tabs',contents:'#browse-genre-containers',defaultTab:0};var eve_opts={prefix:'genrebrowse',parentName:'GenreBrowse',container:'browse-genre-eventlist'};var filter_opts={container:'#browse-sort',defaultOpt:0}
function GenreBrowseModel(){this.constructor.apply(this,arguments);}
GenreBrowseModel.prototype=new StubHubCore.Model();function GenreBrowseView(){this.constructor.apply(this,arguments);var $title=$('#browse_genre_name');var $localteam=$('#browse-localteam-wrapper');var $allteamtitle=$('#tree-genrelist-title');var $tabs=$('#browse-genre-tabs');var $wrapper=$('#browse-subgenre-wrapper');var $wrapper2=$('#browse-genreleaf-wrapper');var $more=$('#browse-genre-moreevents');var $filter=$('#browse-genre-event-control-panel');this.render=function(keys){var publishRender=false;if(keys){switch(keys[0]){case"useESPN":if(!this.model.useESPN){$('#browse-espn-subgenre-wrapper').addClass('hidden');$('#browse-allgenre-wrapper').removeClass('hidden');$('#subgt_opt1').removeClass('hidden');$('#subgt_opt2').addClass('hidden');}else{$('#browse-allgenre-wrapper').addClass('hidden');$('#browse-espn-subgenre-wrapper').removeClass('hidden');$('#subgt_opt2').removeClass('hidden');$('#subgt_opt1').addClass('hidden');}
break;case"genre":$wrapper.addClass('hidden');$title.text(sandbox.getGenreDescription(this.model.genre).replace(/ tickets/i,""));if(teamGenreParentIds.indexOf(this.model.genre.id+"")!=-1){$allteamtitle.removeClass('hidden');}else{$allteamtitle.addClass('hidden');}
if(this.model.genre.leaf+""=="true"){$filter.addClass('hidden');$wrapper.addClass('hidden');$wrapper2.removeClass('hidden');if(concertStyleGenres.indexOf(this.model.genre.id+"")!=-1){$('#browse-genre-heading').addClass('genre_title_nofav');}else{$('#browse-genre-heading').removeClass('genre_title_nofav');}
var _genreId=this.model.genre.id,_channelId=this.model.genre.channelId,_channelName=sandbox.getChannelNameById(_channelId);if(_channelName){var _isStarred=sandbox.isStarredGenre(_channelName,_genreId);if(_isStarred){$('#star_genre_leaf_link').find('.fav').removeClass('sprite-star_unselected').addClass('sprite-star_selected');}else{$('#star_genre_leaf_link').find('.fav').removeClass('sprite-star_selected').addClass('sprite-star_unselected');}}
$tabs.addClass('hidden');$('#browse-genre-containers').addClass('hidden');}else{$wrapper2.addClass('hidden');$wrapper.removeClass('hidden');$('#browse-genre-heading').addClass('genre_title_nofav');$tabs.removeClass('hidden');$('#browse-genre-containers').removeClass('hidden');if($('#browse-genre-pop-tab').hasClass('selected')){$filter.removeClass('hidden')}else{$filter.addClass('hidden')}}
break;case"subgenres":break;case'localteams':if(this.model.localteams&&this.model.localteams.length>0){$localteam.removeClass('hidden');}else{$localteam.addClass('hidden');}
break;case'hasMore':$more.parent().append($more);if(this.model.hasMore){$more.removeClass('hidden');}else{$more.addClass('hidden');}
break;}}
$('#browse-loc-selector-label').text(getGVar('geo.location.geoName'));if(publishRender){sandbox.publish("view-rendered","GenreBrowse");}};}
GenreBrowseView.prototype=new StubHubCore.View();function GenreBrowseController(){this.constructor.apply(this,arguments);C.register('GenreTreeList',M.GenreList,genrelist_opts);C.register('GenreLocalTeam',M.GenreList,localteam_opts);C.register('GenreLeafModule',M.GenreEventList);C.register('ESPNGenre',M.ESPNGenre,espn_opts);C.register('GenreSubPopEvents',M.EventList,eve_opts);tab_opts.defaultTab=getGVar('exec.landingtab')||tab_opts.defaultTab;C.register('GenreBrowseTab',M.Tab,tab_opts);var _callback;this.init=function(){bindGlobalEvents.call(this);var container=sandbox.getContainer();if(this.view){if(container){this.view.container=container;}
bindViewEvents.call(this);}
C.start('GenreTreeList');C.start('GenreLocalTeam');C.start('ESPNGenre');C.start('GenreSubPopEvents');C.start('GenreBrowseTab');var self=this;this.model.change(function(keys){if(keys){var m=this.model;if(keys[0]=='localteams'){if(m.localteams&&m.localteams.length>0){C.publish('team-genredata',m.localteams);}}else if(keys[0]=='subgenres'){if(!this.model.useESPN){C.publish('tree-genredata',this.model.subgenres);}else{C.publish('espn-genres',{genres:this.model.subgenres,genreId:this.model.genre.id});C.publish('tree-genredata',null);}
if(isFunc(_callback)){_callback.call(this);}}}},self);if(isFunc(sandbox.getCurrentState)){var state=sandbox.getCurrentState();if(state&&state.type&&state.url){handleDataFromURLState.call(this,{state:state});}}};this.destroy=function(){unbindGlobalEvents.call(this);C.stop('GenreTreeList');C.stop('GenreLocalTeam');};function bindViewEvents(){$("#browse-sort").on("change",function(event){var sortType=$(this).val();if(sortType==0){$("#browse-filter").text($("#browse-sort-0").text());}else{$("#browse-filter").text($("#browse-sort-1").text());};eStart=0;getPopularEvents.call(self,self.model.genre.id,null,sortType);});var _container=this.view?this.view.container:null,self=this;if(_container){var $container=$(_container);$container.find('.genre_title_fav').bind('click.fast',function(e){e.preventDefault();e.stopPropagation();var $this=$(this);if($this.hasClass('disabled')){return;}
var genreId=self.model.genre.id,channelId=self.model.genre.channelId;var channelName=sandbox.getChannelNameById(channelId);if(channelName){var isStarred=sandbox.isStarredGenre(channelName,genreId);sandbox.toggleStarredGenre(channelName,genreId);var _item=sandbox.getGenreDescription(self.model.genre);if(!isStarred){sandbox.trackInOmniture(null,null,"star touch","star touch: "+_item+": "+sandbox.getOmniPageName(),null,"event70",null,null,_item);}else{sandbox.trackInOmniture(null,null,"unstar touch","unstar touch: "+_item+": "+sandbox.getOmniPageName(),null,"event70",null,null,_item);}}});$container.find('#browse-genre-moreevents').bind('click.fast',function(e){e.preventDefault();e.stopPropagation();getPopularEvents.call(self,self.model.genre.id);});}}
function bindGlobalEvents(){C.subscribe('url.update.state',handleDataFromURLState,this);C.subscribe('ui-link-clicked',handleGenreClick,this);C.subscribe('ui-link-clicked:before',beforeUILinkClicked,this);C.subscribe("gvar.starred.genre",handleStarredUpdate,this);C.subscribe(tab_opts.prefix+'-tab-selected',function(i){track(i,true);},this);C.subscribe("geo-current-location",function(geo){$('#browse-loc-selector-label').text(geo.geoName);eStart=0;getPopularEvents.call(this,this.model.genre.id);},this);C.subscribe("gvar.geo.location.popular",function(geo){getPopularEvents.call(this,this.model.genre.id,geo.geoId);},this);}
function unbindGlobalEvents(){C.unsubscribe('url.update.state',handleDataFromURLState);C.unsubscribe('ui-link-clicked',handleGenreClick);C.unsubscribe('ui-link-clicked:before');C.unsubscribe("gvar.starred.genre",handleStarredUpdate);C.unsubscribe(tab_opts.prefix+'-tab-selected');}
function handleStarredUpdate(data){var genreId=data.id,staron=data.star;if(genreId==this.model.genre.id){var $fav=$("#star_genre_leaf_link").find('.fav');if(staron){$fav.removeClass('sprite-star_unselected').addClass('sprite-star_selected');}else{$fav.removeClass('sprite-star_selected').addClass('sprite-star_unselected');}}}
function beforeUILinkClicked(d){var p=d.prefix;if(p==eve_opts.prefix){track(0);sandbox.setOmnitureVariables({eVar1:"mWeb_Genre_PopularEvents"},false);}}
function track(g,tab,more){var t=!g?'Event':'Category';if(tab){t=t+' tab';}
if(more){t='Show more events:'+more;}
var args=[null,null,"Genre Popular Event touch","Genre Popular Event: "+t];if(tab){args.push("tab touch");}
sandbox.trackInOmniture.apply(null,args);}
function handleGenreClick(data){if(data.target!='genre'){return;}
this.model.set('genre',data.data);}
function handleGenreLeafPage(run){if(run){if(C.lsInstances().indexOf('GenreLeafModule')==-1){C.start('GenreLeafModule');}
sandbox.setOmnitureVariables({pageName:"mWeb: Genre",prop11:"Genre: Leaf",prop1:"Genre leaf"},false);}}
function handleDataFromURLState(data){var state=data.state,type=state&&state.type,pagetype='intermediateGenre';sandbox.setOmnitureVariables({pageName:"mWeb: Genre",prop11:"Genre: Intermediary",prop1:"Genre"},false);if(type!='genre'){handleGenreLeafPage(false);return;}
if(state.paneSettings&&state.paneSettings.genre&&(""+state.paneSettings.genre.leaf)=="true"){handleGenreLeafPage(true);pagetype='genreLeaf';}else{handleGenreLeafPage(false);}
var self=this,ps=state.paneSettings,g=ps.genre,gid=g.id;var path_meta=sandbox.getGenreFromLSById(gid);if(!path_meta){var _genre={id:gid,channelId:ps.channelId,description:g.desc,leaf:g.leaf};self.model.set('genre',_genre);getGenre.call(self,gid,function(docs){this.model.set('genre',docs[0],true);});}else{self.model.set('genre',path_meta);}
eStart=0;var genreTitle=$('#browse_genre_name').text(),winUrl=window.location.href,prop11="",isSport=winUrl.search("sports-tickets")!==-1,isTheater=winUrl.search("heater-tickets")!==-1;var genredesc=sandbox.getGenreDetailForOmni(ps.channelId,path_meta).desc||g.desc;if(isSport||isTheater){if(isSport){prop11="Sports Hub";}
if(isTheater){prop11="Theater Hub";}
sandbox.setOmnitureVariables({prop11:prop11},false);}
sandbox.setOmnitureVariables({eVar7:genreTitle,prop70:gid,prop4:genredesc},true);self.model.set('useESPN',espnGenres.indexOf(gid+"")!=-1);var geoId=getGVar("geo.location.geoId");var skipGetSubGenre=false;getPopularEvents.call(self,self.model.genre.id,geoId);if(geoId!==undefined&&geoId!='0'&&espnGenres.indexOf(gid+"")!==-1){var localteams=getGVar("localdata.team."+gid+"."+geoId);if(localteams&&localteams.constructor==Array&&localteams.length>0){self.model.set('localteams',localteams);}else{self.model.set('localteams',[]);getLocalTeams.call(self,geoId,gid);}}else{self.model.set('localteams',null);}
if(self.model.genre.leaf+""=="true"){skipGetSubGenre=true;}
if(!skipGetSubGenre){this.model.subgenres=null;getSubGenres.call(self,this.model.genre);}
var genre=this.model.genre;if(StubHubCore.exec.showAdOnGenrePage){loadAd.call(this,genre,pagetype);}else{window.setTimeout(function(){if(StubHubCore.exec.showAdOnGenrePage){loadAd.call(this,genre,pagetype);}},2000);}}
function loadAd(g,pagetype){if(!g){return;}
var ads=StubHubCore.StubHubAd,geoId=getGVar("geo.location.geoId")||0,winUrl=window.location.href,genreParentId,genreGrandParentId,g1=(g.ancestorGenreIds&&g.ancestorGenreIds.split(" ")),len=(g1&&g1.length)||0;if(len!=0){if(len-2!=0){genreParentId=g1[len-2];}
if(len-3!=0){genreGrandParentId=g1[len-3];}}
var agid=g.ancestorGenreIds,ageoid=g.ancestorGeoIds,p1='pageType='+pagetype,p2='ancestorGenreIds='+(agid&&agid.split(" ").join("_")+"_0"),p3='ancestorGeoIds='+((ageoid&&ageoid.split(" ").join("_")+"_0")),p4='userGeo='+""+StubHubCore.gvar.get('geo.location.geoName');mboxUpdate(mweb_mbox_name.doubleclickad_display,p1,p2,p3,p4);var config={pageType:pagetype,categoryId:g.channelId,genreId:g.id,genreParentId:genreParentId,genreGrandParentId:genreGrandParentId,pageUrl:winUrl,userGeoDetected:""+geoId,venueId:"",userStatus:"guestuser",artistPrimaryStyle:g.artistPrimaryStyle||""};ads.setTargetingConfig(config);ads.loadAd('genre');}
function getGenre(genreId,callback){var self=this,url=getGVar('site.lcsService'),fl='&fl='+getGVar('exec.lcsquery.genre.minfl'),avd=getGVar('exec.lcsquery.genre.allowedViewingDomain'),qs='q=stubhubDocumentType:genre%20AND%20id:'+genreId+avd+'&start=0'+fl+"&qt=standard&wt=json&json.wrf=?";sandbox.getJSON(url,qs,function(data){var resp=data.response,numF=resp.numFound;if(numF>0){sandbox.cacheGenreToLS(resp.docs[0]);if(isFunc(callback)){callback.call(self,resp.docs);}}});}
function getPopularEvents(genreId,geoId,sortType){var sort='event_date asc';if(sortType==1||$('#browse-filter').text()=='Popular'){sort='tickets_1d desc';}
geoId=(geoId==0)?0:(geoId||getGVar("geo.location.geoId")||0);var start=eStart||0;var url=getGVar('site.lcsService');var qs="q=ancestorGenreIds:"+genreId+" AND ancestorGeoIds:"+geoId+" AND stubhubDocumentType:event AND active:1 AND totalTickets:[1 TO *]"+" AND allowedViewingDomain:"+getGVar('exec.subDomain')+" AND book_of_business_id:"+getGVar('exec.book_of_business_id')+"&start="+start+"&rows=10"+"&fl="+getGVar('exec.lcsquery.event.minfl')+"&sort="+sort+"&wt=json&json.wrf=?";C.publish(eve_opts.prefix+'-eventdata-loading');this.model.set('hasMore',null,true);var self=this;sandbox.getJSON(url,qs,function(d){var resp=d.response,numFound=resp.numFound,count=resp.docs.length;eStart=eStart+count;if(start===0){C.publish(eve_opts.prefix+'-eventdata',resp.docs);}else{C.publish(eve_opts.prefix+'-eventdata-more',resp.docs);}
self.model.set('hasMore',eStart<numFound);var more=parseInt(start/10,10);if(more){track(0,false,more);}});}
function getSubGenres(genre,callback){var sort=$('#browse-filter').text()
var genreId=genre.id;var idx=espnGenres.indexOf(genreId+"");if(idx!=-1){genreId=teamGenreParentIds[idx];}
var self=this,url=getGVar('site.lcsService'),avd=getGVar('exec.lcsquery.genre.allowedViewingDomain'),fl='&fl='+getGVar('exec.lcsquery.genre.minfl')+(idx!=-1?' espnAbbr':''),qs='q=stubhubDocumentType:genre%20AND%20parent_id:'+genreId+avd+'%20AND%20active:1%20AND%20hidden:0&start=0'+fl+"&sort=desc_sort asc&qt=standard&wt=json&json.wrf=?";C.publish('tree-genredata',null);C.publish('tree-genredata-loading');if(this.model.useESPN){C.publish('espn-genres-loading');}
sandbox.getJSON(url,qs,function(data){var resp=data.response,respHeader=data.responseHeader,numF=resp.numFound;if(respHeader.params.q){var ids=respHeader.params.q.match(/parent_id:\d+/g);if(ids&&ids.length){var _gid=ids[0].split(':')[1];if(_gid!=genre.id){if(espnGenres.indexOf(genre.id+"")!=teamGenreParentIds.indexOf(_gid+"")){return;}}}}
if(numF>0){self.model.set('subgenres',resp.docs);if(isFunc(callback)){callback.call(self,resp.docs);}}});}
function getLocalTeams(geoId,genreId,callback){var idx=espnGenres.indexOf(genreId+"");if(geoId=='0'||idx==-1){return;}
var self=this,gid=espnGenres[idx],url=getGVar('site.lcsService'),fl='&fl=ancestorGenreIds ancestorGeoIds artistPrimaryStyle ancestorDescriptions ancestorGenreDescriptions channelId genreUrlPath genre_parent genre_parent_name genre_grand_parent_id pageType sportsTeam gameType espnAbbr',qs='fq=stubhubDocumentType:event%20AND%20active:1'+fl+'&start=0&wt=json&group=true&group.field=eventGenreParentDescription_facet_str&group.main=true&q=(ancestorGenreIds:'+gid+')%20AND%20(ancestorGeoIds:'+geoId+')&json.wrf=?&sort=genre_parent_name%20asc';sandbox.getJSON(url,qs,function(data){var resp=data.response,docs=resp.docs,needWait=false;var newdata=[],d2=[];if(docs.length>0){for(var i=0,l=docs.length;i<l;i++){var doci=docs[i];if(doci.sportsTeam==doci.genre_parent){newdata.push(transformLocalTeamData(doci));}else{needWait=true;}
d2.push(doci.sportsTeam+"");}}
if(!needWait){setLocalTeamsToLS(geoId,genreId,newdata);self.model.set('localteams',newdata);}else{self.model.localteams=d2;var refill=function(){var lt=this.model.localteams;if(lt&&lt.length>0){var sg=this.model.subgenres,ltf=[];if(sg&&sg.length>0){for(var k=0,km=sg.length;k<km;k++){var sgk=sg[k];var sgkt=sgk.sportsTeam+"";if(lt.indexOf(sgkt)!=-1){ltf.push($.extend({},sgk));}}
this.model.set('localteams',ltf);setLocalTeamsToLS(geoId,genreId,ltf);}}
_callback=null;};if(self.model.subgenres){refill.call(self);}else{_callback=refill;}}
if(isFunc(callback)){callback.call(self,newdata);}});}
function transformLocalTeamData(doc){var newdoc={stubhubDocumentType:"genre",espnAbbr:doc.espnAbbr,channelId:doc.channelId,id:doc.genre_parent,description:doc.genre_parent_name,urlpath:doc.genreUrlPath,pageType:doc.pageType,gameType:doc.gameType,sportsTeam:doc.sportsTeam,ancestorGeoIds:doc.ancestorGeoIds,ancestorGenreIds:doc.ancestorGenreIds.replace(" "+doc.genre_parent,""),leaf:true};return newdoc;}
function setLocalTeamsToLS(geoId,genreId,teams){sandbox.setGVar("localdata.team."+genreId+"."+geoId,teams);}}
GenreBrowseController.prototype=new StubHubCore.Controller();this.init=function(){this.m=new GenreBrowseModel();this.v=new GenreBrowseView(this.m);this.c=new GenreBrowseController(this.m,this.v);this.c.init(sandbox);};this.destroy=function(){if(this.c&&isFunc(this.c.destroy)){this.c.destroy(sandbox);}};};})(StubHub);(function(SH){SH.Modules.PopTTL=SH.Modules.PopTTL||function(sandbox){var opts,pfx,parent,container,$container,logPfx;var trending_opts,later_opts,tabs_opts,recent_opts;var EL=SH.Modules.EventList,TAB=SH.Modules.Tab;var C=sandbox.core,publish=C.publish,subscribe=C.subscribe,unsubscribe=C.unsubscribe,gvar=sandbox.getGVar,isF=sandbox.isFunc;function initOpts(p,n){trending_opts={prefix:p+'-pop-trending',parentName:n,container:p+'-pop-trending'};recent_opts={prefix:p+'-pop-recent',parentName:n,container:p+'-pop-recent'};tabs_opts={prefix:p,parentName:n,tabs:'#'+p+'-pop-header',contents:'#'+p+'-poplist-wrapper'};}
function initFromSB(){opts=sandbox.options;pfx=opts.prefix||'home';parent=opts.parentName||"HomePop";container=sandbox.getContainer();$container=$(container);console.log(logPfx,opts);logPfx="*"+parent+"---PopularEvents*  ";initOpts(pfx,parent);}
function PopView(){this.constructor.apply(this,arguments);this.render=function(keys){var pr=false;console.log(logPfx+"in View render()     keys:",keys[0]);if(keys){if(keys[0]=='tab'){this.selectTab();pr=true;}else if(keys[0]=='empty'){if(this.model.empty===true){this.showContainer();}}}
if(pr){publish("view-rendered",parent);}};this.selectTab=function(t){t=t||this.model.tab;var $c=$container;$c.find('.ge_tab').removeClass('selected');$c.find('#'+pfx+'-pop-'+t+'-tab').addClass('selected');$c.find('.pop_event_list').hide();$c.find('#'+pfx+'-pop-'+t).show();};this.showContainer=function(f){if(f!==false&&(!opts.hideEmpty||!this.model.empty)){$container.removeClass('hidden');}else{$container.addClass('hidden');}};}
PopView.prototype=new C.View();function PopCtl(){this.constructor.apply(this,arguments);this.init=function(){C.register(pfx+'PopTrendingList',EL,trending_opts);C.register(pfx+'PopRecentList',EL,recent_opts);C.register(pfx+'Tab',TAB,tabs_opts);if(isF(bindGlobalEvents)){bindGlobalEvents.call(this);}
if(this.view&&isF(bindViewEvents)){bindViewEvents.call(this);}
C.start(pfx+'PopTrendingList');C.start(pfx+'PopRecentList');C.start(pfx+'Tab');this.model.change(function(keys){console.log(logPfx+'Model change',keys);if(keys){switch(keys[0]){case'geoId':case'genreId':getEventList.call(this);break;}}},this);var geoLocation=gvar('geo.location')||{geoId:0};this.model.set('limit',opts.limit||20,true);this.model.set('genreId',opts.genreId||0,true);this.model.set('geoId',geoLocation.geoId);publish(recent_opts.prefix+'-refresh');};this.destroy=function(){if(this.view&&isF(unbindViewEvents)){unbindViewEvents.call(this);}
if(isF(unbindGlobalEvents)){unbindGlobalEvents.call(this);}
C.stop(pfx+'PopTrendingList');C.stop(pfx+'PopRecentList');};function getEventList(geoId,genreId,limit){var self=this,m=self.model,u=gvar('site.lcsService');geoId=geoId||m.geoId;genreId=genreId||m.genreId;limit=limit||m.limit;m.empty=false;self.view.showContainer();publish(trending_opts.prefix+'-eventdata',[]);publish(recent_opts.prefix+'-eventdata',[]);publish(trending_opts.prefix+'-eventdata-loading');publish(pfx+'-tab-refresh');var today_str=sandbox.today(),date=new Date();date.setDate(date.getDate()+1);var k1='genre_parent';var qs="q=stubhubDocumentType:event AND active:1 AND event_date:[NOW TO *] AND totalTickets:[1 TO *] AND ancestorGeoIds:"+geoId+" AND allowedViewingDomain:"+gvar('exec.subDomain')+" AND book_of_business_id:"+gvar('exec.book_of_business_id')+
(genreId?(" AND ancestorGenreIds:"+genreId):"")+"&wt=json&omitHeader=true&start=0&group=true&group.main=true"+"&group.field="+k1+"&rows=30"+"&fl="+gvar('exec.lcsquery.event.minfl')+"&sort=tickets_1d desc&json.wrf=?";sandbox.getJSON(u,qs,function(d){var data=[];data=d.response.docs;data.sort(function(a,b){return new Date(a.event_date_time_local)-new Date(b.event_date_time_local);});updateRecentlyViewed();publish(trending_opts.prefix+'-eventdata',data);});}
function updateRecentlyViewed(callback){var recentlyViewed=sandbox.getRecentlyViewedFromLS()||[];var ids=[];for(var i=recentlyViewed.length-1;i>=0;i--){var eId=recentlyViewed[i].eid;if(eId){ids.unshift(eId);}}
syncEvents(ids,function(docs){var newRV=[];for(var j=recentlyViewed.length-1;j>=0;j--){var currentId=recentlyViewed[j].eid;var validEvent=docs.SH_getElem('id',currentId);if(validEvent){newRV.unshift(recentlyViewed[j]);}}
StubHubCore.gvar.set('user.recentlyviewed',newRV,true);});if(typeof callback=='function'){callback();}}
function getRvEventList(callback){var recentlyViewed=sandbox.getRecentlyViewedFromLS()||[];var val4=[],max=Math.min(recentlyViewed.length,10);for(var i=0;i<max;i++){if(val4.length<10){var eId=recentlyViewed[i].eid;var ev=sandbox.getEventFromLSById(eId);val4.push(ev);}}
if(typeof callback=='function'){callback(val4);}}
function syncEvents(eids,callback){var self=this;if(eids.length==0){return;}
var ids=eids.join(' ');var url=gvar('site.lcsService'),avd=gvar('exec.lcsquery.event.allowedViewingDomain'),fl='&fl='+gvar('exec.lcsquery.event.minfl')+' minPrice currency_code';var qs="q=stubhubDocumentType:event%20AND%20active:1%20AND%20id:("+ids+")"+avd+fl+"&start=0&wt=json&json.wrf=?";sandbox.getJSON(url,qs,function(data){var resp=data.response,docs=resp.docs;if(typeof callback=='function'){callback.call(self,docs);}});}
function unbindViewEvents(){$container.find('#'+pfx+'-pop-header').find('.ge_tab').unbind('click.fast');}
function bindViewEvents(){}
function trackEventClick(data){var self=this;var _pfx=data.prefix;if(_pfx==trending_opts.prefix||_pfx==recent_opts.prefix){var tab=_pfx.split('-');var ts=tab[tab.length-1];if(ts=='recent'){ts='last viewed';}
var pn=sandbox.getOmniPageName();var prop61="popular event: "+ts+" : "+pn;var prop62="popular event touch";var prop63=pn;sandbox.trackInOmniture(null,prop63,prop62,prop61);sandbox.setOmnitureVariables({eVar1:"mWeb_Homepage_PopularEvents"},false);}}
function changeGeo(l){if(this.model.geoId!=l.geoId){this.model.set('geoId',l.geoId);}}
function unbindGlobalEvents(){unsubscribe('geo-current-location',changeGeo);unsubscribe('ui-link-clicked:before',trackEventClick);unsubscribe(pfx+'-pop-genreId');unsubscribe(pfx+'-pop-hide');unsubscribe(pfx+'-pop-show');}
function bindGlobalEvents(){subscribe('geo-current-location',changeGeo,this);subscribe('ui-link-clicked:before',trackEventClick,this);subscribe(pfx+'-pop-genreId',function(g){if(this.model.genreId!=g){this.model.set('genreId',g);}},this);subscribe(pfx+'-pop-hide',function(){this.view.showContainer(false);},this);subscribe(pfx+'-pop-show',function(){this.view.showContainer();},this);subscribe(pfx+'-tab-selected',function(i){var ts;if(i==1){ts='last viewed';}else{ts='trending';}
var pn=sandbox.getOmniPageName();var prop61="popular event tab: "+ts+" : "+pn;var prop62="popular event touch";var prop63=pn;sandbox.trackInOmniture(null,prop63,prop62,prop61);});subscribe(recent_opts.prefix+'-refresh',function(){getRvEventList(function(val4){publish(recent_opts.prefix+'-eventdata',val4);});});subscribe('gvar.user.recentlyviewed',function(){publish(recent_opts.prefix+'-refresh');});}}
PopCtl.prototype=new C.Controller();this.init=function(){initFromSB();this.m=new C.Model();this.v=new PopView(this.m);this.c=new PopCtl(this.m,this.v);this.c.init();};this.destroy=function(){this.c.destroy();this.m=this.v=this.c=null;container=$container=null;EL=C=null;};};})(StubHub);(function(SH){SH.Modules.Popular=SH.Modules.Popular||function(sandbox){var C=sandbox.core,publish=C.publish,subscribe=C.subscribe,gvar=sandbox.getGVar,isF=sandbox.isFunc;var opts,container,$container;var popTeam;var pop_opts={prefix:'Popular',parentName:'Popular',container:'Popular_event'};function initFromSB(){opts=sandbox.options;container=sandbox.getContainer();$container=$(container);}
function PopularView(){this.constructor.apply(this,arguments);popTeam=$("#POP_team");var popularTeamWrapper=$("#POP-teamList-wrapper"),teamList=$("#POP-teamList").remove(),sportType={29:'baseball',30:'basketball',31:'football',32:'hockey',114:'soccer',1:'concert',174:'theater'};this.render=function(keys){var pr=false;if(keys){if(keys[0]=='team'){displayTeam(this.model.team);pr=true;}}
if(pr){publish("view-rendered","Popular");}};function displayTeam(team){var $targetList=popularTeamWrapper,cssClass="",teamId=0,genreId="",sportTypeGenreId=0,sportTypeGenreIdArray=[],sportTypeName='',temp={},teamName="",teamLen=team&&team.length,isTheaterOrConcert=false,theaterColorIter=1,concertColorIter=1;$targetList.empty();popTeam.addClass("hidden");if(team&&teamLen>2){for(var i=0;i<teamLen;i++){genreId=team[i].id;sportTypeGenreId=team[i].ancestorGenreIds;sportTypeGenreIdArray=sportTypeGenreId.split(" ");isTheaterOrConcert=(sportTypeGenreIdArray[1]=="1"||sportTypeGenreIdArray[1]=="174")?true:false;teamId=isTheaterOrConcert?sportTypeGenreIdArray[1]:team[i].sportsTeam?team[i].sportsTeam:"";sportTypeName=isTheaterOrConcert?sportType[sportTypeGenreIdArray[1]]:(sportType[sportTypeGenreIdArray[2]]?sportType[sportTypeGenreIdArray[2]]:"");teamName=team[i].name_secondary||team[i].description;cssClass="sprite-"+sportTypeName+"_icon";var $newRow=teamList.clone().attr("id","POP-"+genreId).attr('data-team',teamId);if(!teamName){var patt=new RegExp(sportTypeName,"gi");teamName=team[i].genre_parent_name.replace(/tickets/gi,"").replace(patt,"");}
temp["POP-"+genreId]={icon:{cssClass:cssClass},teamName:{text:teamName}};sandbox.prefillDom({$elem:$newRow,tgtPrefix:"tgt-POP-",newPrefix:"POP-"+genreId+"-",data:temp["POP-"+genreId]});if(isTheaterOrConcert&&teamId==1){$newRow.addClass("t"+teamId+"_concert"+concertColorIter);concertColorIter=(concertColorIter==3)?1:concertColorIter+1;}else if(isTheaterOrConcert&&teamId==174){$newRow.addClass("t"+teamId+"_theater"+theaterColorIter);theaterColorIter=(theaterColorIter==3)?1:theaterColorIter+1;}else{$newRow.addClass("t"+teamId);}
$newRow.attr("href","/"+team[i].urlpath);$targetList.append($newRow);}
$targetList.css('width',(teamLen*190)+"px");popTeam.removeClass("hidden");}}}
PopularView.prototype=new C.View();function PopularController(){this.constructor.apply(this,arguments);if(C.lsModules().indexOf('HomePop')===-1){C.register('HomePop',SH.Modules.PopTTL,pop_opts);}
this.init=function(){if(isF(bindGlobalEvents)){bindGlobalEvents.call(this,this.sandbox);}
if(this.view&&isF(bindViewEvents)){bindViewEvents.call(this,this.sandbox);}
this.model.change(function(keys){if(keys){switch(keys[0]){case'geoId':this.getPopularTeamList(this.model.geoId);break;}}},this);if(C.lsInstances().indexOf('HomePop')===-1){C.start('HomePop',{options:{}});}
if(isF(sandbox.getCurrentState)){var st=sandbox.getCurrentState();handleDataFromURLState.call(this,st);}
var geoLocation=gvar('geo.location')||{geoId:0};this.model.set('geoId',geoLocation.geoId);};this.getPopularTeamList=function(geoId){var m=this.model;if(m.genreId!==undefined&&(m.genreId==0||m.genreId==1||m.genreId==28||m.genreId==174)){geoId=geoId||0;var url=gvar('site.lcsService');var qs_popularForDay="fq={!join from=genre_parent to=id}ancestorGeoIds:"+geoId+"%20AND%20ancestorGenreIds:"+m.genreId+"%20AND%20active:1%20AND%20-ancestorGenreIds:44510%20AND%20allowedViewingDomain:"+gvar('exec.subDomain')+"&q=+stubhubDocumentType:genre&omitHeader=true&wt=json&start=0&rows=30&indent=on&sort=tickets_1d%20desc&fl=name_secondary,urlpath,genre_grand_parent_id,description,ancestorGenreIds,id,sportsTeam&json.wrf=?";function getPopularTeams(){sandbox.getJSON(url,qs_popularForDay,function(data){if(data&&data.length>2){popTeam.addClass("hidden");}else{m.set('team',data.response.docs);}});}
getPopularTeams();}};function bindViewEvents(){var self=this;$container.delegate('.team_link','click',function(e){e.preventDefault();e.stopPropagation();var $this=$(this),prop62="Popular Team Touch",text=$this.find("div.team_name").text(),_url=$this.attr('href');sandbox.trackInOmniture(null,null,prop62,prop62+": "+text+": "+sandbox.getOmniPageName());sandbox.setOmnitureVariables({eVar1:"mWeb_Homepage_PopularTeam"},false);var genreId=$this.attr('id').split('-')[1],data=sandbox.toArray(self.model.team).SH_getElem('id',genreId);var g={ancestorGenreIds:data.ancestorGenreIds,ancestorGeoIds:data.ancestorGeoIds,channelId:28,description:data.description,id:genreId,sportsTeam:data.sportsTeam,urlpath:_url.substr(1),leaf:true,pageType:'bigsports'};sandbox.cacheGenreToLS(g);var _d={target:'genre',targetId:genreId,href:_url,data:g,paneSettings:{channelId:28,genre:{id:genreId,desc:sandbox.getGenreDescription(data),leaf:true,bigsports:true}}};publish("ui-link-clicked",_d);});}
function bindGlobalEvents(){subscribe('geo-current-location',function(location){if(this.model.geoId!=location.geoId){popTeam.addClass("hidden");this.model.set('geoId',location.geoId);}},this);subscribe('url.update.state',handleDataFromURLState,this);}
function handleDataFromURLState(state){var t=state&&state.type,ps=state&&state.paneSettings;if(t==='home'){var genreId=0;if(ps&&ps.channelId){genreId=ps.channelId;}
publish(pop_opts.prefix+'-pop-genreId',genreId);this.model.set('genreId',genreId,true);if(genreId!="0"&&genreId!="28"){this.model.set('team',[]);}}}}
PopularController.prototype=new C.Controller();this.init=function(){initFromSB();this.m=new C.Model();this.v=new PopularView(this.m);this.c=new PopularController(this.m,this.v);this.c.init(sandbox);};this.destroy=function(){};};})(StubHub);(function(SH){SH.Modules.Event=SH.Modules.Event||function(sandbox){var hasListings=false,filterApplied,eventId,formfactor,container,opt,previous_sort,$target,$targetMsg,$targetList,$processing,$scrubbedSection,$unabletoconnect,$noresults,url,id_param=[],hasImage,imgUrl,isGroupByZone=false;var noscroll=false,scrollToSection=null,lastScrollOffset=0,rememberLastScroll=true;var singleTicketHtmlTemplate;var C=sandbox.core,getGVar=sandbox.getGVar;var imgSrcArray=[],lazyLoadOnScroll=true&&getGVar('exec.supportImgLazyLoad'),nextThreshold=0;var sortParams={"0":"minticketprice asc","1":"maxticketprice des","4":"sectionname asc","5":"sectionname des"};function loadImageByScroll(){if(!lazyLoadOnScroll){return;}
var st=this&&this.scrollTop||0;if(imgSrcArray[0]&&st>=nextThreshold-800){var toFetch=10+Math.ceil((st-nextThreshold)/80);var imgsToShow=getNextImgs(toFetch);getNextThreshold(toFetch*80);for(var m=imgsToShow.length-1;m>=0;m--){_lazyLoadImage(document.getElementById(imgsToShow[m]));}}}
function getNextThreshold(num){num=num||0;nextThreshold+=num;return nextThreshold;}
function resetNextThreshold(){nextThreshold=0;}
function getNextImgs(num){num=num||0;return imgSrcArray.splice(0,num);}
function getImageUrl(event){var size="/500x271";if(formfactor&&formfactor>2){size="/195x106";}
var imgUrl=sandbox.getImageUrl();var sectionImageUrl="//"+imgUrl+"/sectionviews/venues/"+event.geography_parent+"/config/"+event.venue_config_id+size;return sectionImageUrl;}
function doDisplayChanges(formfactor){if(typeof formfactor!=="undefined"){if(formfactor<2){if(!hasImage){$(".viewFromSection").hide();}}}}
function highlightRow(row,selected){if(selected){if(row.hasClass("selected")){return;}
row.addClass("selected");}else{row.removeClass("selected");}}
function _lazyLoadImage(el){var $el=$(el);var dataImgUrl=$el.attr("data-image-url");var dataSrc=$el.attr("src");if(dataImgUrl!=dataSrc){$el.attr("src",dataImgUrl).show();}}
function displayImage(flag){var images=$('img.lazy'),viewBy,sectionId,imageBox;if(!hasImage){return;}
if(flag){for(var i=0,cnt=images.length;i<cnt;i++){var image_i=images[i],$image_i=$(image_i),dataImgUrl=$image_i.attr("data-image-url");if($image_i.attr("src")!=dataImgUrl){if(!lazyLoadOnScroll){$image_i.attr("src",dataImgUrl).show();}}
else{imageBox=$image_i.parent();viewBy=imageBox.parent();imageBox.addClass("tbl-cell");if(viewBy.hasClass("viewBy")){sectionId=viewBy.attr("data-section-id");$("#EVT-"+sectionId+"-EventId").prepend(imageBox);}
$image_i.show();}}
if(lazyLoadOnScroll){loadImageByScroll();}
$("div.imageSection").removeClass('hidden');}else{$("div.imageSection").addClass('hidden');}}
function EventView(){this.constructor.apply(this,arguments);$scrubbedSection=$("#EVT-scrubbedSection").remove();$target=$(container);$targetMsg=$target.find('#EVT-msg');$unabletoconnect=$("#EVT-unabletoconnect").removeClass("hidden").remove();$processing=$("#EVT-processing").removeClass("hidden").remove();$noresults=$("#EVT-noresults").removeClass("hidden").remove();$targetList=$("#EVT-list").removeClass("hidden").remove();this.render=function(keys){var publishRender=false;if(keys){switch(keys[0]){case"sectiondata":displaySection.call(this,this.model.sectiondata);publishRender=true;break;case"zonedata":displayZones.call(this,this.model.zonedata);publishRender=true;break;case"formfactor":doDisplayChanges(this.model.formfactor);break;case"image":displayImage(this.model.image);break;case"error":displayErrorMessage(this.model.error);break;case"unabletoconnect":publishRender=true;showUnableToConnectMsg();break;}}
if(publishRender){C.publish("view-rendered","Event");}};this.processing=function(){hasListings=true;$targetList.empty();$targetMsg.empty();$unabletoconnect.remove();$targetMsg.append($processing.clone());};function showUnableToConnectMsg(){$("#EVT-processing").remove();$targetMsg.append($unabletoconnect);}
function displayErrorMessage(data){var errors=data&&data.errors,message,state,eventId="",events="prodview,event24",filterObject=getGVar("filter-current-value"),omniture,ps;if(errors&&typeof errors!="undefined"){var errMsg=errors[0].message;message=getGVar("MSG.shared.exec.noTickets");$processing.remove();$targetList.empty();hasListings=false;if(filterApplied){message=getGVar("MSG.shared.exec.noTicketsForFilter");hasListings=true;if($("#eventColumn").hasClass("ui-column-active")){state=sandbox.getCurrentState();omniture=filterObject&&filterObject.omnitureArray;ps=state&&state.paneSettings;if(omniture){if(ps&&ps.event){eventId=ps.event.id;}
sandbox.trackInOmniture(null,null,omniture.join("/"),omniture.join(":")+" filter touch: "+sandbox.getOmniPageName(),omniture.join("/")+' touch',events,eventId,null,null);}}}
if(errMsg.indexOf("S05")!=-1){message=getGVar("MSG.shared.exec.noTicketsForScrubbed");}
$noresults.html(message);$("#EVT-processing").remove();$targetMsg.append($noresults);}else{if(filterApplied){message=getGVar("MSG.shared.exec.noTicketsForFilter");hasListings=true;if($("#eventColumn").hasClass("ui-column-active")){state=sandbox.getCurrentState();omniture=filterObject&&filterObject.omnitureArray;ps=state&&state.paneSettings;if(omniture){if(ps&&ps.event){eventId=ps.event.id;}
sandbox.trackInOmniture(null,null,omniture.join("/"),omniture.join(":")+" filter touch: "+sandbox.getOmniPageName(),omniture.join("/")+' touch',events,eventId,null,null);}}
$noresults.html(message);$("#EVT-processing").remove();$targetMsg.append($noresults);}else{hasListings=false;if(!data.section||data.section.length===0){message=getGVar("MSG.shared.exec.noTickets");$noresults.html(message);$("#EVT-processing").remove();$targetMsg.append($noresults);}else{showUnableToConnectMsg();}}}}
function displaySection(sectiondata){var sections=sectiondata.section,totalgroups=1;$targetMsg.empty();$targetList.empty();if(sections&&sections.length!==0){imgSrcArray=[];resetNextThreshold();hasListings=true;$processing.remove();totalgroups=sections.length;eventId=sectiondata.eventId;if(hasImage){var vfsUrl=sectiondata.mediumViewFromSectionUrl;if(formfactor&&formfactor>2){vfsUrl=sectiondata.smallViewFromSectionUrl;}
imgUrl=vfsUrl?("//"+vfsUrl):getImageUrl(this.model.event);}
var $row;var minPrice=sections[0].minTicketPrice,maxPrice=0;for(var i=0;i<totalgroups;i++){var _section=sections[i];minPrice=Math.min(minPrice,_section.minTicketPrice);maxPrice=Math.max(maxPrice,_section.maxTicketPrice);$row=displayScrubbedSectionInfo.call(this,_section,eventId);if(i%2!==0){$row.addClass("even");}
if(id_param.indexOf(_section.sectionId+"")!=-1){highlightRow($row,true);}
$targetList.append($row);}
$target.append($targetList);if(this.model.switcher!='map'&&formfactor&&formfactor>2){displayImage(true);}
if($("#eventColumn").hasClass("ui-column-active")){var state=sandbox.getCurrentState(),filterObject=getGVar("filter-current-value"),events="prodview",omniture=filterObject&&filterObject.omnitureArray,ps=state&&state.paneSettings;if(omniture){if(ps&&ps.event){eventId=ps.event.id;}
sandbox.trackInOmniture(null,null,omniture.join("/"),omniture.join(":")+" filter touch: "+sandbox.getOmniPageName(),omniture.join("/")+' touch',events,eventId,null,null);}}
sandbox.publish('eventfilter.price.label.values',{min:minPrice,max:maxPrice});}else if(sections&&sections.length===0){displayErrorMessage(sectiondata);}else{displayErrorMessage(sectiondata.errors);}}
function displayScrubbedSectionInfo(section,eventId){var sectionId=section.sectionId,$newRow=$scrubbedSection.clone().removeClass("hidden").attr("id","EVT-"+sectionId);var href=sandbox.appendParamToUrl(url,'section_id',sectionId),cssClass="";if(typeof formfactor!=="undefined"&&formfactor<=2&&!hasImage){cssClass="hideSection";}
var temp={},price=section.minTicketPrice;if(1==previous_sort){price=section.maxTicketPrice;}
if(section.totalTickets==1){$newRow.find('.ticketsavailable').empty().html(singleTicketHtmlTemplate);}
temp["EVT-"+sectionId]={ViewBy:{data:{"section-id":sectionId}},SectionName:{text:section.sectionName},TicketsAvaialble:{text:section.totalTickets},CurrPrice:{text:sandbox.displayPrice(price,getGVar("I18N.MONEY.currency.code"))},Currency:{text:getGVar("I18N.MONEY.currency.code")},ViewFromSection:{data:{"section-id":sectionId},cssClass:cssClass},SeeTicket:{href:href,data:{"target-id":eventId,"section-id":sectionId}},EventId:{href:href,data:{"target-id":eventId,"section-id":sectionId}}};if(hasImage){var _imgUrl_=imgUrl.replace(/cache[0-9]*.stubhubstatic.com/,sandbox.getImageUrl(sectionId));temp["EVT-"+sectionId].SectionImageUrl={data:{"image-url":_imgUrl_+"/"+sectionId+".jpg"}};imgSrcArray.push("EVT-"+sectionId+"-SectionImageUrl");}else{$newRow.addClass('novfs');}
sandbox.prefillDom({$elem:$newRow,tgtPrefix:"tgt-EVT-",newPrefix:"EVT-"+sectionId+"-",data:temp["EVT-"+sectionId]});return $newRow;}
function displayZones(zonedata){if(typeof zonedata=="undefined"){return;}
var zones=zonedata.zone_stats,totalgroups=1;$targetMsg.empty();$targetList.empty();if(zones&&zones.length!==0){imgSrcArray=[];resetNextThreshold();hasListings=true;$processing.remove();totalgroups=zones.length;eventId=zonedata.eventId;var $row;var minPrice=zones[0].minTicketPrice,maxPrice=0;for(var i=0;i<totalgroups;i++){var _zone=zones[i];minPrice=Math.min(minPrice,_zone.minTicketPrice);maxPrice=Math.max(maxPrice,_zone.maxTicketPrice);$row=displayZoneInfo.call(this,_zone,eventId);if(i%2!==0){$row.addClass("even");}
if(id_param.indexOf(_zone.zoneId+"")!=-1){highlightRow($row,true);}
$targetList.append($row);}
$target.append($targetList);if(this.model.switcher!='map'&&formfactor&&formfactor>2){displayImage(true);}
if($("#eventColumn").hasClass("ui-column-active")){var state=sandbox.getCurrentState(),filterObject=getGVar("filter-current-value"),events="prodview",omniture=filterObject&&filterObject.omnitureArray,ps=state&&state.paneSettings;if(omniture){if(ps&&ps.event){eventId=ps.event.id;}
sandbox.trackInOmniture(null,null,omniture.join("/"),omniture.join(":")+" filter touch: "+sandbox.getOmniPageName(),omniture.join("/")+' touch',events,eventId,null,null);}}
sandbox.publish('eventfilter.price.label.values',{min:minPrice,max:maxPrice});}else if(zones&&zones.length===0){displayErrorMessage(zonedata);}else{displayErrorMessage(zonedata.errors);}}
function displayZoneInfo(zone,eventId){var zoneId=zone.zoneId,$newRow=$scrubbedSection.clone().removeClass("hidden").attr("id","EVT-"+zoneId);var href=sandbox.appendParamToUrl(url,'zone_id',zoneId),cssClass="";cssClass="hideSection";var temp={},price=zone.minTicketPrice;if(1==previous_sort){price=zone.maxTicketPrice;}
if(zone.totalTickets==1){$newRow.find('.ticketsavailable').empty().html(singleTicketHtmlTemplate);}
temp["EVT-"+zoneId]={ViewBy:{data:{"section-id":zoneId}},SectionName:{text:zone.zoneName},TicketsAvaialble:{text:zone.totalTickets},CurrPrice:{text:sandbox.displayPrice(price,getGVar("I18N.MONEY.currency.code"))},Currency:{text:getGVar("I18N.MONEY.currency.code")},ViewFromSection:{data:{"section-id":zoneId},cssClass:cssClass},SeeTicket:{href:href,data:{"target-id":eventId,"section-id":zoneId}},EventId:{href:href,data:{"target-id":eventId,"section-id":zoneId}}};$newRow.addClass('novfs');sandbox.prefillDom({$elem:$newRow,tgtPrefix:"tgt-EVT-",newPrefix:"EVT-"+zoneId+"-",data:temp["EVT-"+zoneId]});return $newRow;}}
EventView.prototype=new C.View();function EventController(){this.constructor.apply(this,arguments);this.destroy=function(){unbindGlobalEvents();};this.init=function(){if(C.lsModules().indexOf('EventMap')===-1){var mapopts={container:"EventMapModule"};mapopts.ui={formfactor:formfactor};C.register('EventMap',StubHub.Modules.EventMap,mapopts);}
if(C.lsInstances().indexOf('EventMap')===-1){var token=getGVar('exec.env')=='prod'?'PerOewmb9jUZUixS_7bEsvflZHka':'eTSFEiwfiCZSeJCqfkHiZhioVPEa';C.start('EventMap',{token:token,onSectionFocus:null,onSectionBlur:null,onMapReady:function(){}});}
bindGlobalEvents.call(this);var container=sandbox.getContainer();if(this.view){if(container){this.view.container=container;}
bindViewEvents.call(this);}
this.model.change(function(keys){if(keys){var k=keys[0],data=this.model[k];if(k=='event'){this.getEventListings(data);}else if(k=='selected_sections'){publish.call(this);}else if(k=='filter'){if(data&&(data.quantity||data.price||data.delivery)){filterApplied=true;}else{filterApplied=false;}}}},this);if(typeof sandbox.getCurrentState=='function'){var state=sandbox.getCurrentState();if(state&&state.type&&state.url){getDataFromURLState.call(this,{state:state});}}};this.getEventListings=function(event){if(!event){return;}
this.view.processing();var self=this,queryString,_sortBy,ssiAPIUrl=getGVar('site.ssiAPIUrl'),zonesAPIUrl=getGVar('site.inventoryAPIUrl'),filter;queryString="?eventId="+event.id;if(self.model.filter){filter=self.model.filter;}else{filter=sandbox.getFilterValue(event.id);self.model.set('filter',filter);filter=filter||{};previous_sort=filter.sort;}
_sortBy=sortParams[filter.sort+""];if(filter.price){queryString+=filter.price.min?('&pricemin='+filter.price.min):'';queryString+=filter.price.max?('&pricemax='+filter.price.max):'';}
if(filter.delivery){queryString+=filter.delivery?('&deliverytypelist='+filter.delivery):'';}
if(filter.quantity){queryString+=filter.quantity?('&quantity='+filter.quantity):'';}
if(_sortBy){queryString+='&sort='+_sortBy;}
queryString+='&_type=json&_='+(new Date().getTime());C.publish('event.seatmap.loading',true);var evt=opt.paneSettings.event;isGroupByZone=false;if(typeof(formfactor)!='undefined'&&formfactor<=2&&evt.isScrubbed&&evt.venue_config_map_type==5){groupByZoneOrSection("zones");}else{groupByZoneOrSection("section");}
function groupByZoneOrSection(type){var queryStringZones=queryString;queryStringZones=queryStringZones.replace("sort=minticketprice","sort=currentprice");queryStringZones=queryStringZones.replace("sort=maxticketprice","sort=currentprice");var queryStringZones=queryStringZones+"&pricingSummary=false&zoneStats=true&sectionStats=true&start=0&rows=1";sandbox.StubHubService(zonesAPIUrl+queryStringZones,{success:function(data){var zone_stats=data.zone_stats;var section_stats=data.section_stats;var sortType=filter.sort;var event=self.model.event;var sectionData={};var currencyCode;if(zone_stats.length>=1){zone_stats.sort(function(a,b){if(sortType==1){return b.maxTicketPrice-a.maxTicketPrice;}else{return a.minTicketPrice-b.minTicketPrice;}});data.zone_stats=zone_stats;}
if(section_stats.length>=1){section_stats.sort(function(a,b){if(sortType==1){return b.maxTicketPrice-a.maxTicketPrice;}else{return a.minTicketPrice-b.minTicketPrice;}});data.section_stats=section_stats;}
if(type=="zones"){self.model.set('zonedata',data);self.model.set('selectbyzone',true);isGroupByZone=true;}
if(data.totalListings>0){currencyCode=data.listing[0].currentPrice.currency;}
currencyCode=(typeof currencyCode!="undefined")?currencyCode:getGVar("I18N.MONEY.currency.code");sectionData.currencyCode=currencyCode;sectionData.section=data.section_stats;sectionData.isVenueScrubbed=true;sectionData.isViewFromSectionEnabled=(typeof event.view_from_section_ind!="undefined"&&event.view_from_section_ind==1)?true:false;sectionData.smallViewFromSectionUrl=getImageUrl(event);if(type!="zones"){self.model.set('sectiondata',sectionData);}
C.publish('event.seatmap.sectiondata',sectionData);C.publish('event.seatmap.loading',false);},error:function(data){self.model.set('error',data);},name:'Zones API',omniPageName:'mWeb: Event Details'});}
function groupBySection(){sandbox.StubHubService(ssiAPIUrl+queryString,{success:function(data){self.model.set('sectiondata',data);C.publish('event.seatmap.sectiondata',data);C.publish('event.seatmap.loading',false);},error:function(data){self.model.set('error',data);},name:'Section Summary API',omniPageName:'mWeb: Event Details'});}};function bindViewEvents(){var _container=this.view?this.view.container:null,self=this;if(_container){var $container=$(_container);$container.delegate('.EVT-link','click',function(e){e.preventDefault();e.stopPropagation();noscroll=true;var $this=$(this),$tgt=$(e.target),sectionId=$this.attr('data-section-id');if($tgt.hasClass("viewFromSection")){return;}
displayImage(false);if($tgt.hasClass("seeticket")||!$("#EVT-"+sectionId+"-ImageBox").hasClass("hidden")){$("#EVT-"+sectionId).find("div.viewFromSection").trigger("click");}
var relevantDataForTarget;if(typeof(self.model.zonedata)!="undefined"){relevantDataForTarget=sandbox.toArray(self.model.zonedata.zone_stats).SH_getElem("zoneId",sectionId);}else{relevantDataForTarget=sandbox.toArray(self.model.sectiondata.section).SH_getElem("sectionId",sectionId);}
if(formfactor<=2){self.model.set('selected_sections',[relevantDataForTarget]);}else{var sss=self.model.selected_sections||[];var i=0,ss,exist;for(var im=sss.length;i<im;i++){ss=sss[i];if(ss.sectionId==sectionId){exist=true;break;}}
var row=$("#EVT-"+sectionId);if(exist){sss.splice(i,1);highlightRow(row,false);}else{sss.unshift(relevantDataForTarget);highlightRow(row,true);}
self.model.selected_sections=null;sandbox.setGVar('exec.section_view','grouped',true);self.model.set('selected_sections',sss);}});$container.delegate('.viewFromSection','click',function(e){e.preventDefault();e.stopPropagation();var id=$(this).attr("data-section-id"),$imageSection=$("#EVT-"+id+"-ImageBox"),$viewBySection=$("#EVT-"+id+"-ViewBy");if($imageSection&&$imageSection.length>0){if($viewBySection.children("div").length===0){$viewBySection.append($imageSection);if($imageSection.hasClass("hidden")){var img=$imageSection.find("img");var originalUrl=img.attr("data-image-url");img.attr("src",originalUrl);$imageSection.removeClass("hidden").removeClass("tbl-cell").show();$imageSection.children(".seeticket").removeClass("hidden");var state=sandbox.getCurrentState(),eventId="",events="prodview",ps=state&&state.paneSettings;if(ps&&ps.event){eventId=ps.event.id;}
sandbox.trackInOmniture(null,null,"view from section touch","view from section: "+id+" : "+sandbox.getOmniPageName(),'view from section touch',events,eventId,null,null);}
$(this).text(getGVar("MSG.common.closeimage"));}else{if($imageSection.hasClass("hidden")){$imageSection.removeClass("hidden").show();$(this).text(getGVar("MSG.common.closeimage"));}else{$imageSection.addClass("hidden").hide();$(this).text(getGVar("MSG.common.viewFromSection"));}}
sandbox.publish("view-rendered","Event");}});$('#EventModule').bind('scroll',loadImageByScroll);}}
function publish(){var s=sandbox.getCurrentState(),ps=s.paneSettings,_url=s.url;if(this.model.selected_sections&&this.model.selected_sections.length>0){var currencyCode=typeof this.model.sectiondata!="undefined"?this.model.sectiondata.currencyCode:getGVar("I18N.MONEY.currency.code");var sections=this.model.selected_sections,sids=[],zids=[],sdata={},sid,zid,_newurl,selectbyzone=this.model.selectbyzone;sections.forEach(function(section){sids.push(section.sectionId);if(selectbyzone){zoneid=section.zoneId;if(zids.indexOf(zoneid)==-1){zids.push(zoneid);}}
section.currencyCode=currencyCode;sdata[section.sectionId+""]=section;});sid=sids.join(',');if(_url&&_url.indexOf('?')>-1){_url=_url.slice(0,url.indexOf("?"));}
if(selectbyzone){zid=zids.join(',');_newurl=sandbox.appendParamToUrl(_url,'zone_id',zid);if(typeof(isGroupByZone)!="undefined"&&isGroupByZone){ps.section={id:sid,ids:sids,data:sdata};ps.selectbyzone=selectbyzone;ps.section.zones={id:zid,ids:zids};C.publish('ui-link-clicked',{target:'section',targetId:zid,href:_newurl,paneSettings:ps,replace:s.type=='section'});}}else{_newurl=sandbox.appendParamToUrl(_url,'section_id',sid);}
if(sid){if(!ps.section||ps.section.id!=sid){ps.section={id:sid,ids:sids,data:sdata};ps.selectbyzone=selectbyzone;if(selectbyzone){ps.section.zones={id:zid,ids:zids};}
C.publish('ui-link-clicked',{target:'section',targetId:sid,href:_newurl,paneSettings:ps,replace:s.type=='section'});}}
if(!noscroll){scrollToSection=sids[0];}else{noscroll=false;}}else if(!this.model.selected_sections){noscroll=false;scrollToSection=null;}else{noscroll=false;scrollToSection=null;if(s.type=='section'){C.publish('close-section-click','SectionModule');}}}
function scrollSectionList(type){var state=sandbox.getCurrentState(),ps=state.paneSettings,ui=state&&state.ui,event=ps.event;this.model.switcher=type;if(type=='list'){if(event&&!event.isScrubbed){C.publish('unscrubbed-list-display','section');}else{if(!formfactor){formfactor=ui.formfactor||opt.ui.formfactor;}
if($("#eventColumn").hasClass("ui-column-active")&&typeof formfactor!="undefined"&&formfactor>2){displayImage(true);}
$('#EventModule').removeClass('hidden');}
$('#EventMapModule').addClass('hidden');if(scrollToSection){var _offset=$('#EVT-'+scrollToSection).offset().top-$('#EVT-list').offset().top;lastScrollOffset=_offset&&_offset>0?_offset:0;$('#eventColumn')[0].scrollTop=lastScrollOffset;scrollToSection=null;}else if(lastScrollOffset){$('#eventColumn')[0].scrollTop=lastScrollOffset;}}else if(type=='map'){if(rememberLastScroll){lastScrollOffset=$('#eventColumn')[0].scrollTop;C.publish('view-rendered');}
$('#EventModule').addClass('hidden');$('#EventMapModule').removeClass('hidden');if(event&&!event.isScrubbed){C.publish('unscrubbed-map-click','event');}
C.publish('event.seatmap.refresh');}else{$('#EventModule').removeClass('hidden');$('#EventMapModule').removeClass('hidden');}}
function bindGlobalEvents(){C.subscribe('ui-formfactor-changed',function(data){if(data){formfactor=data;this.model.set("formfactor",data,false,true);if(data<=2){this.model.set("image",false,false,true);}}},this);C.subscribe('url.update.state',getDataFromURLState,this);C.subscribe('eventcontrol.switcher.type',scrollSectionList,this);C.subscribe('event.seatmap.selected_sections',function(data){this.model.set('selectbyzone',data.selectbyzone);this.model.set('selected_sections',data.sections);},this);C.subscribe('event-filter-change',onFilterChange,this);}
function onFilterChange(data){this.model.filter=null;this.model.set('filter',data.filter);var filterString='';if(data){var lc=data.lastchange;if(lc!='ssort'){var v=data.filter&&data.filter[lc];if(lc=='sort'&&(v=='4'||v=='5')){var sd=this.model.sectiondata;sd.section.sort(sandbox.getSortFunc('sectionName',v=='4',Number));this.model.sectiondata=null;this.model.set('sectiondata',sd);}else if(lc=='sort'&&previous_sort==v){}else{this.getEventListings(this.model.event);}}}
var eventName=this.model.event.description;var eventId=this.model.event.id;if(data&&data.lastchange&&data.lastchange.indexOf('sort')!=-1){sandbox.trackInOmniture(null,null,"sorted by change touch","sorted by change: "+data.filter.sort+": "+sandbox.getOmniPageName(),'sorted by link touch',"prodview",eventId,null,null);}else if(data&&data.lastchange){sandbox.trackInOmniture(null,sandbox.getOmniPageName(),'mWeb: Ticket Filter',sandbox.getOmniPageName()+': Ticket Filter: '+data.lastchange);}
previous_sort=data.filter.sort;}
function unbindGlobalEvents(){C.unsubscribe('ui-formfactor-changed');C.unsubscribe('url.update.state',getDataFromURLState);C.unsubscribe('event.seatmap.selected_sections');C.unsubscribe('eventcontrol.switcher.type',scrollSectionList);}
function getDataFromURLState(data){var state=data.state,type=state&&state.type,ui=state&&state.ui,ps=state&&state.paneSettings,_event=ps?ps.event:null;if(_event&&(!_event.isScrubbed||_event.isScrubbed=="false")){this.model.set('event',null,true);return;}
if(!formfactor){formfactor=ui.formfactor||opt.ui.formfactor;}
if(typeof formfactor!=="undefined"){doDisplayChanges(formfactor);}
if(type=='event'||type=='section'){var self=this;hasImage=_event.viewFromSectionEnable;if(type=='section'){if(ps&&ps.ssection&&ps.section.id){id_param=ps.section.id.split(',');}
if(formfactor>2){if(self.model.switcher!='list'){$('#EventModule').addClass('hidden');}else{$('#EventModule').removeClass('hidden');}}}else{if(formfactor>2){$('#EventModule').removeClass('hidden');if(data.direction=='back'){self.model.set('selected_sections',[]);}}}
if(self.model&&self.model.event&&ps&&ps.event&&self.model.event.id&&ps.event.id&&self.model.event.id==ps.event.id){if(formfactor>=3){self.model.set("image",null,true);self.model.set("image",hasImage);}
return;}
lastScrollOffset=0;url=state.url;var path_metadata=sandbox.getDataByStateURL(url);if(path_metadata){if(path_metadata.stubhubDocumentType!='event'){console.error('*Event*  in Controller getDataFromURLState() method, url points to a non event data',path_metadata);}else{self.model.set('filter',null);self.model.set('event',path_metadata,false,true);}}
if(typeof mboxUpdate==='function'&&typeof mweb_mbox_name!=="undefined"&&mweb_mbox_name.event){var p1='Bigsports='+(self.model.event.pageType=='bigsports'),p2='Channel='+sandbox.getChannelNameById(self.model.event.channelId),p3='ListingType='+_event.isScrubbed?"Scrubbed":"Unscrubbed";mboxUpdate(mweb_mbox_name.event,p1,p2,p3);}}}}
EventController.prototype=new C.Controller();this.init=function(){opt=sandbox.options;formfactor=opt.ui.formfactor;container=sandbox.getContainer();this.m=new C.Model();this.v=new EventView(this.m);this.c=new EventController(this.m,this.v);this.c.init(sandbox);singleTicketHtmlTemplate=opt.msg.ticketavailable.replace('{0}','<span id="tgt-EVT-TicketsAvaialble"></span>');};this.destroy=function(){};};})(StubHub);(function(SH){SH.Modules.EventTitle=SH.Modules.EventTitle||function EventTitle(sandbox){var $target,$container=$('#EventTitleModule'),$buyerMessageContainer,eventIdMsgObj={};var bkgTransition=false;var eventTitle,ellipsisTitle,ellipsisLine=2;function getImageUrl(event,section_id){var sid=section_id.split(',')[0];var imgUrl=sandbox.getImageUrl(sid);var sectionImageUrl="//"+imgUrl+"/sectionviews/venues/"+event.geography_parent+"/config/"+event.venue_config_id+'/500x271/'+sid+'.jpg';return sectionImageUrl;}
function displayBuyerMessage(message){if($(".full-overlay").length==0){var $grid=$('#GridMiddle');$grid.append('<div class="full-overlay"></div>');$buyerMessageContainer.find(".msg").empty().html(message);$buyerMessageContainer.removeClass("hidden");$grid.append($buyerMessageContainer);var prop62="Event disclosures",prop61=sandbox.getOmniPageName()+": "+prop62+": Viewed event disclosure";sandbox.trackInOmniture(null,null,prop62,prop61);}}
function toggleMoreEventsInGenreLink(){if(this.model.pageType==='event'||this.model.pageType==='section'){$("#more_in_genre").removeClass("hidden");}else{$("#more_in_genre").addClass("hidden");}}
function removeBuyerMessage(eventId){if(eventId){delete eventIdMsgObj[eventId];}
$("#event_buyer_message").remove();$(".full-overlay").remove();}
function showEllipsis(){if(!eventTitle){return;}
var $descs=$container.find('#event_title_descspan');$descs.html(eventTitle.replace(/\s/g,'<span class="tspace"> </span>'));var des_offset=$descs.offset(),des_height=des_offset.height,wrap_height=$container.find('#event_title_desc').height(),delta=parseInt(des_height,10)-parseInt(wrap_height,10);if(Math.round(delta/24)===0){$('#event_title_ellipsis').hide();ellipsisTitle=eventTitle;}else{$('#event_title_ellipsis').show();var $sss=$descs.find('.tspace'),$s,so,i=0,l=$sss.length;for(var c=0;i<l&&c<ellipsisLine;i++){$s=$($sss.get(i));so=$s.offset();if(so.width===0&&i>0){c++;}}
if(i<=l){var t=eventTitle.split(' ').slice(0,i).join(' ');ellipsisTitle=t.substr(0,t.length-4)+'... ';}else{ellipsisTitle=eventTitle;}
$descs.html(ellipsisTitle);}}
function EventTitleView(){this.constructor.apply(this,arguments);$target=$('#event_title').remove();$container=$('#EventTitleModule');$buyerMessageContainer=$("#event_buyer_message").remove();this.render=function(keys){var publishRender=false;if(keys){if(keys[0]=='event'){displayEventTitle.call(this,this.model.event);publishRender=true;}else if(keys[0]=='bkgImgs'){if(this.model.event&&this.model.event.view_from_section_ind==1){}}else if(keys[0]=='pageType'){toggleMoreEventsInGenreLink.call(this);}}
if(publishRender){sandbox.publish("view-rendered","EventTitle");}};function displayEventTitle(event){$container.empty();var message;if(event){var eventMetadataAPIUrl=sandbox.getGVar('site.eventMetadataAPIUrl'),buyerMsg,id=event.id,queryString=id+"/metadata/inventoryMetaData?_type=json";if(eventIdMsgObj[id]){displayBuyerMessage(eventIdMsgObj[id]);}else{sandbox.StubHubService(eventMetadataAPIUrl+queryString,{success:function(data){var evt=data&&data.InventoryEventMetaData.eventDetail;message=evt&&evt.alertMessage;if(message){displayBuyerMessage(message);$("#event-title_buyermessage").html(message);eventIdMsgObj[event.id]=message;}},error:function(data){},name:'Event Metadata API',omniPageName:'mWeb: Event Details'});}}
var $newrow=$target.clone(),id=event.event_id||event.id,desc=event.description.replace(' Tickets','').trim(),datetime=event.event_date_time_local,time=(datetime.match(/T[^Zz]*/)||["T00:00:00"])[0].substr(1),more_events=event.genre_parent_name.replace(/ tickets/i,""),more_link='/'+event.genreUrlPath;sandbox.setOmnitureVariables({products:id},false);var d={star:{data:{"target-id":id,"target-channel":event.channelId}},day:{text:sandbox.displayWeekday(datetime)},date:{text:sandbox.displayDay(datetime)},month:{text:sandbox.displayMonth(datetime)},descspan:{text:desc},venue:{text:sandbox.displayVenue(event)},more_events:{text:more_events},more_link:{href:more_link}};if(event.hide_event_date!="0"){d.time={text:sandbox.getGVar('MSG.shared.exec.dateTBD')};$newrow.find('#event_title_flag').addClass('hidden');}else{if(event.hide_event_time!="0"){d.time={text:sandbox.getGVar('MSG.shared.exec.timeTBD')};}else{d.time={text:sandbox.displayTimeShort(time)+" "+(!sandbox.getGVar('exec.isUK')&&event.timezone?event.timezone:"")};}}
sandbox.prefillDom({$elem:$newrow,tgtPrefix:"tgt-event_title-",newPrefix:"event_title_",data:d});eventTitle=desc;ellipsisTitle=null;var channelName=sandbox.getChannelNameById(event.channelId);if(channelName){var isStarred=sandbox.isStarredEvent(channelName,id);if(isStarred){$newrow.find('#event_title_star').removeClass('sprite-star_unselected').addClass('sprite-star_selected');}}
$container.append($newrow);$container.removeClass('hidden');toggleMoreEventsInGenreLink.call(this);setTimeout(showEllipsis,100);}
function displayBackgroundImages(){var $etm=$('#EventTitleModule');$etm.css('background-size',"cover").css('-webkit-background-size',"cover").css('-moz-background-size',"cover");if(this.model.bkgImgs&&this.model.bkgImgs.length>0){var url=this.model.bkgImgs[0];hideBkgImage(function(){showBkgImage(url);});}else{$etm.css('backgroundImage',"");$('#event_title').css('background-color','');}}
function showBkgImage(url,cb){$('#EventTitleModule').css('backgroundImage',"url("+url+")");var $et=$('#event_title');if(bkgTransition){$et.addClass('bkg easein');}else{$et.addClass('bkg');}
if(typeof cb=='function'){window.setTimeout(cb,300);}}
function hideBkgImage(cb){var $etm=$('#EventTitleModule');if(!$etm.css('backgroundImage')){if(typeof cb=='function'){cb.call(this);}}else{var $et=$('#event_title');if(bkgTransition){$et.removeClass('bkg');}else{$et.removeClass('bkg easein');}
if(typeof cb=='function'){window.setTimeout(cb,300);}}}}
EventTitleView.prototype=new StubHubCore.View();function EventTitleController(){this.constructor.apply(this,arguments);this.init=function(){bindGlobalEvents.call(this);var container=sandbox.getContainer();if(this.view){if(container){this.view.container=container;}
bindViewEvents.call(this);}
var state=sandbox.getCurrentState();if(state&&state.type&&state.url){getDataFromURLState.call(this,{state:state});}};this.destroy=function(){if(typeof unbindGlobalEvents=='function'){unbindGlobalEvents.call(this);}};function bindViewEvents(){var _container=this.view?this.view.container:null,self=this;if(_container){var $container=$(_container);$(document).delegate('#buyermsg_button','click',function(e){e.preventDefault();e.stopPropagation();var ev=self.model.event,id=ev&&ev.id;removeBuyerMessage(id);var prop62="Event disclosures",prop61=sandbox.getOmniPageName()+": "+prop62+": Acknowledged event disclosure";sandbox.trackInOmniture(null,null,prop62,prop61);});$container.delegate('#event_title_stararea','click',function(e){e.preventDefault();e.stopPropagation();var $this=$(this).parent(),eventId=$this.attr('data-target-id'),channelId=$this.attr('data-target-channel');var relevantDataForTarget=sandbox.toArray(self.model.event).SH_getElem("id",eventId);relevantDataForTarget.stubhubDocumentType='event';sandbox.cacheEventToLS(relevantDataForTarget);var channelName=sandbox.getChannelNameById(channelId);if(channelName){var isStarred=sandbox.isStarredEvent(channelName,eventId);if(!isStarred){var _item=relevantDataForTarget.description;sandbox.trackInOmniture(null,null,"star touch","star touch: "+_item+": "+sandbox.getOmniPageName(),null,"event70",null,null,_item);}
sandbox.toggleStarredEvent(channelName,eventId);}});$container.delegate('.ellipse_toggle','click',function(e){e.preventDefault();e.stopPropagation();var $et=$container.find('#event_title'),$descs=$container.find('#event_title_descspan');if($et.hasClass('ellipsis')){$et.removeClass('ellipsis');if(ellipsisTitle!=eventTitle){$descs.html(eventTitle);}}else{$et.addClass('ellipsis');if(ellipsisTitle!=eventTitle){$descs.html(ellipsisTitle);}}
sandbox.publish('view-rendered','EventTitle');});$container.delegate('.more_in_genre','click',function(e){e.preventDefault();e.stopPropagation();var $this=$(this),omniPageName="mWeb Event Details",prop62=omniPageName+": View other events";sandbox.trackInOmniture(null,omniPageName,prop62,prop62);var _event=self.model&&self.model.event,ancestorGenreIds=_event.ancestorGenreIds.split(' ');ancestorDescriptions=_event.ancestorGenreDescriptions;genreId=_event&&ancestorGenreIds[ancestorGenreIds.length-1];var g={ancestorGenreIds:_event.ancestorGenreIds,ancestorGeoIds:_event.ancestorGeoIds,channelId:_event.channelId,description:_event.genre_parent_name,id:genreId,urlpath:_url,leaf:true,pageType:(_event.pageType==="bigsports")};if(genreId){var _url="/"+_event.urlpath,_pageType=_event.pageType;var _d={target:'genre',targetId:genreId,href:_url,data:g,paneSettings:{channelId:_event.channelId,genre:{id:genreId,desc:_event.genre_parent_name,leaf:true,ancestorGeoIds:_event.ancestorGeoIds,ancestorDescriptions:ancestorDescriptions[ancestorDescriptions.length-1],artistPrimaryStyle:_event.artistPrimaryStyle,bigsports:(_event.pageType==="bigsports")}}}
sandbox.publish("ui-link-clicked",_d);}});}}
var timer;function updateEllipsis(formfactor){ellipsisLine=formfactor>2?1:2;if(timer){clearTimeout(timer);}
$('#event_title').addClass('ellipsis');timer=setTimeout(showEllipsis,100);}
function bindGlobalEvents(){sandbox.core.subscribe('EventTitle-setEvent',function(data){this.model.set('event',data);},this);sandbox.core.subscribe('ui-formfactor-changed',updateEllipsis,this);sandbox.core.subscribe('url.update.state',getDataFromURLState,this);sandbox.core.subscribe("gvar.starred.event",handleStarredUpdate,this);}
function unbindGlobalEvents(){sandbox.core.unsubscribe('EventTitle-setEvent');sandbox.core.unsubscribe('ui-formfactor-changed',updateEllipsis);sandbox.core.unsubscribe('url.update.state',getDataFromURLState);sandbox.core.unsubscribe("gvar.starred.event",handleStarredUpdate);}
function handleStarredUpdate(data){var eventId=data.id,staron=data.star;if(eventId==this.model.event.id){var $fav=$('#event_title_star');if(staron){$fav.removeClass('sprite-star_unselected').addClass('sprite-star_selected');}else{$fav.removeClass('sprite-star_selected').addClass('sprite-star_unselected');}}}
function getDataFromURLState(data){var state=data.state,type=state&&state.type,container=$(this.view.container),ui=state&&state.ui,allUnscrubbed=!(state&&state.paneSettings&&state.paneSettings.event&&state.paneSettings.event.isScrubbed);var formfactor=(ui&&ui.formfactor)||(sandbox.options&&sandbox.options.ui&&sandbox.options.ui.formfactor);this.model.set('pageType',type);bkgTransition=bkgTransition||formfactor>2;ellipsisLine=formfactor>2?1:2;if((type=='section'&&!allUnscrubbed)&&container!=null){container.addClass("hide-me");}else if(container!=null){container.removeClass("hide-me");}
var self=this;var url=state.url,ps=state.paneSettings,selfModel=self.model,selfModelEvent=selfModel.event;if(type=='event'||type=='section'||type=='ticket'){if(ps.section&&ps.section.id){if(selfModel&&selfModel.section!=ps.section.id){selfModel.section=ps.section.id;if(selfModelEvent){selfModelEvent.LAS=selfModel.section;selfModel.set('bkgImgs',[getImageUrl(selfModelEvent,selfModel.section)]);sandbox.cacheEventToLS(selfModelEvent);}}else{if(formfactor<=2&&type=='ticket'){selfModel.set('bkgImgs',[getImageUrl(selfModelEvent,selfModel.section)]);}}}
if(selfModel&&ps&&ps.event&&selfModel.event&&ps.event.id&&selfModelEvent.id==ps.event.id){if(eventIdMsgObj&&eventIdMsgObj[selfModelEvent.id])
displayBuyerMessage(eventIdMsgObj[selfModelEvent.id]);return;}
var path_metadata=sandbox.getDataByStateURL(url);if(path_metadata){self.model.set('event',path_metadata);if(path_metadata.LAS){selfModel.set('bkgImgs',[getImageUrl(path_metadata,path_metadata.LAS)]);}else{selfModel.set('bkgImgs',null);}}}else{removeBuyerMessage();}}}
EventTitleController.prototype=new StubHubCore.Controller();this.init=function(){this.m=new StubHubCore.Model();this.v=new EventTitleView(this.m);this.c=new EventTitleController(this.m,this.v);this.c.init();};this.destroy=function(){if(this.c&&typeof this.c.destroy=='function'){this.c.destroy();}};};})(StubHub);(function(SH){SH.Modules.TicketDetail=SH.Modules.TicketDetail||function TicketDetail(sandbox){var $noresults,$processing,opt,msg,formfactor;function getImageUrl(event,sectionId,big){var imgUrl=sandbox.getImageUrl(sectionId);var size=big?'500x271':'195x106';var sectionImageUrl="//"+imgUrl+"/sectionviews/venues/"+event.geography_parent+"/config/"+event.venue_config_id+"/"+size+"/"+sectionId+".jpg";return sectionImageUrl;}
function loadImage(imgUrl,vfs,showVFS,jump){if(showVFS=='link'){vfs.attr("data-image",imgUrl);}
if(showVFS=='link'||!showVFS){$('#TicketDetailWrapper').removeClass('hidden');$processing.addClass("hidden");sandbox.publish("view-rendered","TicketDetail");return;}
var imge=document.createElement('img');imge.onload=function(){vfs.append($(imge));sandbox.publish("view-rendered","TicketDetail");if(typeof jump=="undefined"){$('#TicketDetailWrapper').removeClass('hidden').attr('style','opacity:0;');$processing.addClass("hidden");jump=true;}
if(jump){window.setTimeout(function(){scrollTo($("#TicketDetailWrapper"));$('#TicketDetailWrapper').removeClass('hidden').attr('style','opacity:1;');},50);}};imge.onerror=function(){$('#TicketDetailWrapper').removeClass('hidden');$processing.addClass("hidden");imge=null;};imge.src=imgUrl;}
function scrollTo(obj){formfactor=formfactor||(opt&&opt.ui&&opt.ui.formfactor);var _top=obj.offset().top;var lastScrollOffset=_top||0;window.scrollTo(0,lastScrollOffset);}
function TicketDetailView(){this.constructor.apply(this,arguments);$noresults=$("#ticket-noresults");$processing=$("#ticket-processing");var $wrapper=$('#TicketDetailWrapper');var $ticketInfo=$wrapper.find('#ticket_info');var $comments=$('#ticket_comments');var $sellerinfo=$('#seller_info');var $comment_item=$comments.find('.ticket_selcom_item').remove();var $ticket_class_item=$comments.find('.ticket_class_item').remove();var $ticket_seller_comment=$('#ticket_seller_comment');var $ticket_class=$('#ticket_class');var $ticketForm=$('#ticket_form');this.render=function(keys){var publishRender=false;if(keys){switch(keys[0]){case"ticket":displayTicketDetail.call(this,this.model.ticket);publishRender=true;break;case"error":displayErrorMessage(this.model.error);break;}}
if(publishRender){sandbox.publish("view-rendered","TicketDetail");}};this.processing=function(){$noresults.addClass("hidden");$wrapper.addClass('hidden');$processing.removeClass("hidden");};function displayErrorMessage(){$noresults.removeClass("hidden");$processing.addClass("hidden");$wrapper.addClass('hidden');}
function displayTicketDetail(data){var state=sandbox.getCurrentState(),ui=state&&state.ui,formfactor=ui&&ui.formfactor
ps=state&&state.paneSettings,genre="",genreId="",genredesc="",_event=ps&&ps.event;if(ps){genre=sandbox.getGenreDetailForOmni(ps.channelId,ps.event);genreId=genre.id;genredesc=genre.desc;}
var opts={pageName:"mWeb: Ticket Details",prop11:"Event details: Ticket listings: Ticket details",prop1:"Ticket details",prop4:genredesc,events:"event15",prop70:genreId,products:";"+(_event&&_event.id)||""};if(_event&&!_event.isScrubbed){opts.prop11='Event details: Unscrubbed listings: Ticket details';}
var eventdata=sandbox.getEventFromLSById(_event&&_event.id);if(eventdata){var duration=sandbox.getTimeAheadOfEvent(eventdata);if(duration){opts.eVar14=duration;}}
var ticket=data.listing||data.ListingResponse.listing;if(!ticket){return;}
var bundledType=(_event&&_event.bundled_type)||1,id=ticket.listingId,section_alias=ticket.sectionName,sectionId=ticket.sectionId,row=ticket.row,seats=ticket.seatNumbers,actualPrice=ticket.displayPricePerTicket||ticket.currentPrice,amount=actualPrice.amount||ticket.currentPrice.amount,price=amount&&parseFloat(amount,10)||'0',fv=ticket.faceValue,fv_amount=fv&&fv.amount&&parseFloat(fv.amount,10),fv_currency=fv&&fv.currency,currency=ticket.currencyCode,comment=ticket.listingAttributesList,ticketClass=ticket.ticketClass,allowSplits=ticket.splitOption!="0"||false,qtyList=ticket.splitVector,quantity=ticket.quantity,deliveryMethods=ticket.deliveryMethods,qtySelected,businessGuid=ticket.businessGuid,blockCheckout=this.model.checkoutBlocked,isUK=sandbox.getGVar('exec.isUK'),evt_desc=escape(_event&&_event.desc.replace(/ Tickets/i,"")),evt_date=sandbox.displayDateForEmail(eventdata.event_date_time_local,eventdata.hide_event_date,eventdata.hide_event_time),evt_venue=escape(sandbox.displayVenue(eventdata)),qtyToDisplay;$sellerinfo.addClass("hidden");if(businessGuid!==undefined){$(".separator").removeClass("hidden");var sellerInfoApiUrl=sandbox.getGVar("site.sellerInfoApiUrl")+businessGuid+"?_type=json&_"+(new Date().getTime());sandbox.StubHubService(sellerInfoApiUrl,{success:function(data){if(data){var seller=data.businessSellerInfo,notes=seller.notes,notetext=(notes&&notes[0]&&notes[0].noteText),regNum=seller.tradeRegister,vat=seller.vatId,address=seller.address;$sellerinfo.find("#seller_address1").text(address.address1);if(address.address2){$sellerinfo.find("#seller_address2").text(address.address2);}
$sellerinfo.find("#seller_city").text(address.city);$sellerinfo.find("#seller_state").text(address.state);$sellerinfo.find("#seller_country").text(address.country);$sellerinfo.find("#seller_zipcode").text(address.postcode);$sellerinfo.find("#first_name").text(seller.firstName);$sellerinfo.find("#last_name").text(seller.lastName);$sellerinfo.find("#company_name").text(seller.companyName);if(regNum===undefined){$sellerinfo.find("#registration_num").hide();}else{$sellerinfo.find("#registration_num div.subitem").text(regNum);$sellerinfo.find("#registration_num").show();}
if(vat===undefined){$sellerinfo.find("#vat_num").hide();}else{$sellerinfo.find("#vat_num div.subitem").text(vat);$sellerinfo.find("#vat_num").show();}
if(notetext===undefined){$sellerinfo.find("#add_info").hide();}else{$sellerinfo.find("#add_info div.subitem").text(notetext);$sellerinfo.find("#add_info").show();}
$("#seller_evt_title").text(evt_desc);$("#seller_evt_date").text(evt_date);$("#seller_evt_venue").text(evt_venue);$("#listing_id").text(id);$("#device").text(StubHubCore.exec.deviceForEmail);var subject=$("#seller_email_subject").text(),to=$("#seller_email_to").text(),from=seller.email,body=$("#seller_email_body").text(),email='mailto:?subject='+subject+'&to='+to+'&from='+from+'&body='+body;$sellerinfo.find("#email_stubhub").attr('href',email);$sellerinfo.find("#ticket_seller_info").removeClass('hidden');$sellerinfo.removeClass("hidden");}},error:function(){},name:'SellerInfo API',omniPageName:'mWeb: Ticket Details'});}
if(typeof deliveryMethods!="undefined"&&deliveryMethods.length>0){for(var i=0,len=deliveryMethods.length;i<len;i++){var delivery=deliveryMethods[i];if(delivery&&(delivery.id==2||delivery.id=="2")){if(!blockCheckout){$("#ticket_delivery_message").removeClass("hidden");}
break;}else{$("#ticket_delivery_message").addClass("hidden");}
opts.eVar73=delivery?delivery.name:"";}}
sandbox.setOmnitureVariables(opts,true);sandbox.setOmnitureVariables({eVar73:null},false);if(allowSplits){var tkt=ps&&ps.ticket;if(tkt){var qtyFromUrl=tkt.quantity;if(qtyList.indexOf(qtyFromUrl)!==-1){qtySelected=qtyFromUrl;}}}
$noresults.addClass("hidden");$wrapper.addClass('hidden');if(blockCheckout){$('#ticket_order').addClass('hidden');}else{$('#ticket_order').removeClass('hidden');}
var sa=section_alias.toLowerCase();if(sa=='ga'||sa=='general admission'){$ticketInfo.find('#ticket_rowseat').addClass('hidden');}else{$ticketInfo.find('#ticket_rowseat').removeClass('hidden');}
$ticketInfo.find('#ticket_section').text(section_alias);$ticketInfo.find('#ticket_row').text(row);if(bundledType>1&&bundledType<=4){$("#bundled_message").html(sandbox.getGVar("MSG.module.TicketDetail.price.bundledMessage_"+bundledType));$('#ticket_qty_comments').removeClass('hidden');}else{$('#ticket_qty_comments').addClass('hidden');}
var $facevalue=$('#facevalue_message');if(isUK&&fv){$('#ticket_qty_comments').removeClass('hidden');$facevalue.html(sandbox.getGVar("MSG.module.TicketDetail.facevalue"));$facevalue.find('#facevalue').text(sandbox.displayPrice(fv_amount,fv_currency));$facevalue.find('#facevalue_currency').text(fv_currency);}
var seatArray=seats;if(seatArray&&seatArray.indexOf(",")!=-1){seatArray=seats.split(",");}
if(seats!="General Admission"&&(quantity>"5"||quantity>5)){var seat=seatArray[0]+", "+seatArray[1]+".... "+seatArray[quantity-2]+", "+seatArray[quantity-1];if(seats){$ticketInfo.find('#ticket_seat, #ticket_seat_ga_sro').text(" "+seat);}}else{if($.isArray(seatArray)){seats=seatArray.join(", ");}
if(seats){$ticketInfo.find('#ticket_seat, #ticket_seat_ga_sro').text(" "+seats);}}
$ticketInfo.find('#ticket_single_price').text(sandbox.displayPrice(price,currency));$ticketInfo.find('.ticket_currency').text(currency);window.setTimeout(function(){var reminder=StubHubCore.exec.showReminder;if(typeof reminder!="undefined"){var gcid=reminder.gcid;$("#send_reminder span").text(reminder.buttontext);var desc=genredesc.split(":").reverse()[0];if(!desc){desc=ps&&ps.genre&&ps.genre.desc;}
var url="http://www."+StubHubCore.gvar.get('exec.domain')+"%2F%3Fevent_id%3D"+_event.id+"%26gcid%3D"+gcid;$("#subject").text(escape(desc));$("#evt_title").text(evt_desc);$("#evt_date").text(evt_date);$("#evt_venue").text(evt_venue);$("#section_info").text(section_alias);$("#row_info").text(row);$("#seats_info").text(seats);$("#listing_link").text(url+"%26ticket_id%3D"+id);$("#evt_link").text(url);var subject=$("#email_subject").text(),body=$("#email_body").text(),emaillink='mailto:?subject='+subject+'&body='+body;$("#send_reminder").attr('href',emaillink).removeClass('hidden');}},1000);if(allowSplits){var $select=$('<select>').attr('id','ticket_qty_select'),$opt;qtyList=qtyList.split(",");var cnt=qtyList.length;var filterObject=sandbox.getGVar("filter");qtyToDisplay=qtyList[0];if(typeof filterObject!=="undefined"&&typeof genreId!="undefined"&&filterObject[genreId]&&filterObject[genreId].quantity!=""){qtyToDisplay=filterObject[genreId].quantity;}
if(cnt==1){if(qtyToDisplay==""||quantity.length==0){qtyToDisplay=0;}
$('#ticket_qty_value').empty().text(qtyToDisplay);}else{for(var j=0;j<cnt;j++){var qty=qtyList[j];$opt=$('<option>').attr('value',qty).text(qty);$select.append($opt);if(qtyToDisplay=='>10'&&qty>9&&j<cnt){qtyToDisplay=qtyList[j];}}
$opt=undefined;if(qtyToDisplay=='>10'||qtyToDisplay=='10'){qtyToDisplay=qtyList[0];}
$select.val(qtyToDisplay);if(typeof qtySelected!=="undefined"){$select.val(qtySelected);qtyToDisplay=qtySelected;}
$('#ticket_qty_value').empty().append($select);}
$('#ticket_seat_ga_sro, #seat_info, #ticket_seat_together, #ticket_seat_printed').addClass('hidden');if(qtyToDisplay=="1"||qtyToDisplay==1){$('#ticket_seat_printed').removeClass('hidden');}else{if(qtyToDisplay==qtyList[cnt-1]){$('#seat_info').removeClass('hidden');}
else{$('#ticket_seat_together').removeClass('hidden');}}
if(seats=="General Admission"){$('#seat_info, #ticket_seat_together, #ticket_seat_printed').addClass('hidden');$('#ticket_seat_ga_sro').removeClass('hidden');}}else{$('#ticket_seat_ga_sro, #ticket_seat_together, #ticket_seat_printed').addClass('hidden');qtyToDisplay=quantity;$('#ticket_qty_value').empty().text(qtyToDisplay);$('#seat_info').removeClass('hidden');if(seats=="General Admission"){$('#seat_info').addClass('hidden');$('#ticket_seat_ga_sro').removeClass('hidden');}}
var total_price=price*parseInt(qtyToDisplay,10);$ticketInfo.find('#ticket_total_price').text(sandbox.displayPrice(total_price,currency));$comments.addClass('hidden');$comments.find('.ticket_class_item').remove();if(ticketClass){$(".separator").removeClass("hidden");$comments.removeClass('hidden');$ticket_class.append($ticket_class_item.clone().text(ticketClass));}else{$ticket_class.addClass('hidden');}
$comments.find('.ticket_selcom_item').remove();if(comment){if(comment&&comment.listingAttribute){comment=comment.listingAttribute;}
var _comment=sandbox.toArray(comment),_cnt=_comment.length;if(_cnt>0){for(var k=0;k<_cnt;k++){$ticket_seller_comment.append($comment_item.clone().text(_comment[k].name));}
$comments.removeClass('hidden');}
else{if(!ticketClass){$comments.addClass('hidden');}
$ticket_seller_comment.addClass('hidden');}}else{if(!ticketClass){$comments.addClass('hidden');}
$ticket_seller_comment.addClass('hidden');}
if(msg&&msg.checkout){var $checkoutBtn=$('#ticket_checkout');if(delivery&&(delivery.id=='2'||delivery.id=='1')){var x=0;var t=msg.checkout[x];if(t){$checkoutBtn.text(t);}}else{$checkoutBtn.text(msg.checkout[0]);}}
var _exec=sandbox.getGVar('exec');$ticketForm.attr('action',sandbox.getGVar('site.checkoutUrl'));$ticketForm.find('#ticket_id').val(id);$ticketForm.find('#ticket_quantity').val(qtyToDisplay);var returl=window.location.href;if(_exec.isUS){returl+="&ms="+s_account;}
$ticketForm.find('#ticket_returl').val(returl);var $vfs=$wrapper.find('#ticket_vfs'),$ticket_vfs_text=$wrapper.find('#ticket_vfs_text');$vfsimage=$wrapper.find('#ticket_vfs_image');$vfs.empty();$vfsimage.empty().hide();$ticket_vfs_text.text(sandbox.getGVar("MSG.shared.common.viewFromSection")).hide();if(eventdata&&sectionId){var imgUrl=getImageUrl(eventdata,sectionId,true);if(_event&&_event.venue_config_map_type=="5"&&_event.viewFromSectionEnable&&typeof mboxUpdate==='function'&&mweb_mbox_name&&mweb_mbox_name.vfs_ticketDetail){mboxDefine('mweb_mbox_placeholder_vfs_ticketDetail',mweb_mbox_name.vfs_ticketDetail);var m=sandbox.getMboxEventData(eventdata);mboxUpdate(mweb_mbox_name.vfs_ticketDetail,"ancestorGenreIds="+m.ancestorGenreIds,"ancestorGeoIds="+m.ancestorGeoIds,"userGeo="+m.userGeo,"venue_config_map_type="+m.venue_config_map_type);window.setTimeout(function(){if(StubHubCore.exec.showVFSLink){$ticket_vfs_text.removeClass("hidden").show();loadImage.call(this,imgUrl,$vfsimage,"link");}else if(StubHubCore.exec.hideVFS){loadImage.call(this,imgUrl,$vfsimage,false);}else{loadImage.call(this,imgUrl,$vfs,true);}},1000);}else{loadImage.call(this,imgUrl,$vfs,true);}}else{$('#TicketDetailWrapper').removeClass('hidden');$processing.addClass("hidden");}}}
TicketDetailView.prototype=new StubHubCore.View();function TicketDetailController(){this.constructor.apply(this,arguments);this.destroy=function(){unbindGlobalEvents();};this.init=function(){bindGlobalEvents.call(this);var container=sandbox.getContainer();if(this.view){if(container){this.view.container=container;}
bindViewEvents.call(this);}
if(typeof sandbox.getCurrentState=='function'){var state=sandbox.getCurrentState();if(state&&state.type&&state.url){getTicketDataFromURLState.call(this,{state:state});}}};function bindViewEvents(){var self=this;$('#ticket_qty_value').bind('click.fast',function(){var selEl=$(this).find('select')[0];if(selEl){selEl.focus();}});$('#close_seller_info').bind('click.fast',function(){$("#ticket_seller_detail").addClass("hidden");$(".full-overlay").remove();});$('#seller_see_detail').bind('click.fast',function(){$("#ticket_seller_detail").removeClass("hidden");$("#TicketDetailWrapper").append('<div class="full-overlay"></div>');});$('#ticket_vfs_text').bind('click.fast',function(){var $vfslink=$(this),$vfsimage=$("#ticket_vfs_image"),vfs=sandbox.getGVar("MSG.shared.common.viewFromSection"),close=sandbox.getGVar("MSG.shared.common.closeImage"),prop63="mWeb:Ticket Details",prop62=prop63+": View from section",prop61=prop62+": Open";if($vfslink.text()==vfs){$vfslink.text(close);if($vfsimage.children().length==0){loadImage($("#ticket_vfs_image").attr("data-image"),$vfsimage,true,false);}
$vfsimage.show();}else{prop61=prop62+": Close"
$vfslink.text(vfs);$vfsimage.hide();}
sandbox.trackInOmniture(null,prop63,prop62,prop61);});$('#ticket_qty_value').delegate('select','change',function(){var $this=$(this),val=parseInt($this.val(),10),ticket=self.model.ticket.listing||self.model.ticket.ListingResponse.listing;$('#ticket_quantity').val(val);$('#seat_info, #ticket_seat_ga_sro').addClass('hidden');if((/General Admission/g).test($("#ticket_seat_ga_sro").text())){$('#seat_info, #ticket_seat_printed, #ticket_seat_together').addClass('hidden');$('#ticket_seat_ga_sro').removeClass('hidden');}else if($this[0].selectedIndex==($($this[0]).children("option").length-1)){$('#ticket_seat_ga_sro, #ticket_seat_printed, #ticket_seat_together').addClass('hidden');$('#seat_info').removeClass('hidden');}else if(val==1){$('#ticket_seat_together').addClass('hidden');$('#ticket_seat_printed').removeClass('hidden');}else{$('#ticket_seat_together').removeClass('hidden');$('#ticket_seat_printed').addClass('hidden');}
var actualPrice=ticket.displayPricePerTicket||ticket.currentPrice,amount=actualPrice.amount||ticket.currentPrice.amount;var price=parseFloat(amount);$('#ticket_total_price').text(sandbox.displayPrice(price*val,ticket.currencyCode));});$("#ticket_order").delegate('#ticket_checkout','click',function(){self.model.set('ticket',null,true);var state=sandbox.getCurrentState();var _event=sandbox.getDataByStateURL(state.url);var opts={"prop11":"Event details: Ticket listings: Ticket details","products":";"+(_event&&_event.id)||"","prop63":"mWeb:Ticket Details","prop62":"Order Tickets Button Touch","prop61":"Order Tickets Button Touch: mWeb:Ticket Details"};if(_event&&!_event.isScrubbed){opts.prop11='Event details: Unscrubbed listings: Ticket details';}
sandbox.trackInOmnitureVars(opts,'order tickets touch');setTimeout(function(){$("#ticket_form")[0].submit();},500);});$("#ticket_order").delegate('#send_reminder','click',function(){var state=sandbox.getCurrentState(),_event=state.paneSettings.event,buttontext=$("#send_reminder span").text()+" Button Touch",pgname="mWeb:Ticket Details";var opts={"prop11":"Event details: Ticket listings: Ticket details","products":";"+(_event&&_event.id)||"","prop63":pgname,"prop62":buttontext,"prop61":buttontext+": "+pgname};if(_event&&!_event.isScrubbed){opts.prop11='Event details: Unscrubbed listings: Ticket details';}
sandbox.trackInOmnitureVars(opts,buttontext);});}
function bindGlobalEvents(){var self=this;sandbox.core.subscribe('TicketDetail-setTicket',function(data){self.model.set('ticket',data);});sandbox.core.subscribe('url.update.state',getTicketDataFromURLState,self);}
function unbindGlobalEvents(){sandbox.core.unsubscribe('TicketDetail-setTicket');sandbox.core.unsubscribe('url.update.state',getTicketDataFromURLState);}
function getTicketDataFromURLState(data){var state=data.state,type=state&&state.type;var self=this;if(type=='ticket'){var ps=state.paneSettings;$('#EventTitleModule').removeClass("hidden");if(typeof $('#close_seller_info')!==undefined){$('#close_seller_info').trigger("click");}
if(self.model&&self.model.ticketId&&ps&&ps.ticket&&ps.ticket.id&&self.model.ticketId==ps.ticket.id){if(self.model&&!self.model.ticket){self.model.ticket=sandbox.getGVar('ticket.'+ps.ticket.id);}
return;}
self.view.processing();if(ps.ticket.id){var t=sandbox.getGVar('ticket.'+ps.ticket.id);var eId=(ps.event&&ps.event.id)||(t&&t.listing&&t.listing.eventId);if(eId){var _ev=sandbox.getEventFromLSById(eId);var _venueId=_ev.geography_parent;var bvids=sandbox.getGVar('blockedVenueIds');if(bvids&&bvids.length>0&&bvids.indexOf(_venueId+"")!=-1){self.model.set('checkoutBlocked',true,true);}else{self.model.set('checkoutBlocked',false,true);}}
self.model.set('ticketId',ps.ticket.id,true);if(t){self.model.set('ticket',t);}else{getTicketById(ps.ticket.id,function(data){sandbox.setGVar('ticket.'+ps.ticket.id,data,true);self.model.set('ticket',data);});}}else{console.error('*TicketDetail*  ERROR  no ticket id');}}}
function getTicketById(ticketId,callback){var listingApiUrl=sandbox.getGVar("site.listingsAPIUrl")+ticketId+"?_type=json&_"+(new Date().getTime());sandbox.StubHubService(listingApiUrl,{success:function(data){callback(data);},error:function(){},name:'Listing API',omniPageName:'mWeb: Ticket Details'});}}
TicketDetailController.prototype=new StubHubCore.Controller();this.init=function(){opt=sandbox.options;msg=opt&&opt.msg;formfactor=opt.ui&&opt.ui.formfactor;this.m=new StubHubCore.Model();this.v=new TicketDetailView(this.m);this.c=new TicketDetailController(this.m,this.v);this.c.init();mboxDefine('mweb_mbox_placeholder_savereminder_ticketDetail',mweb_mbox_name.savereminder_ticketDetail);mboxUpdate(mweb_mbox_name.savereminder_ticketDetail);};this.destroy=function(){};};})(StubHub);(function(SH){SH.Modules.Section=SH.Modules.Section||function Section(sandbox){var updateTicketListing=false,filterApplied,formfactor,hasImage,opt,url,container,connectSuccess,$templateTicket,$target,$processing,$noresults,$unabletoconnect,id_param;var singleTicketRowTemplate;var C=sandbox.core;function getImageUrl(event,sectionId,big){var imgUrl=sandbox.getImageUrl(sectionId);var size=big?'500x271':'195x106';var sectionImageUrl="//"+imgUrl+"/sectionviews/venues/"+event.geography_parent+"/config/"+event.venue_config_id+"/"+size+"/"+sectionId+".jpg";return sectionImageUrl;}
function loadBigImage($ele){var $p=$ele.parent();if($p.hasClass('novfs')){return;}
var url=$ele.attr('data-image');var imge=document.createElement('img');imge.onload=function(){$ele.css('backgroundImage','url('+url+')');$ele.attr('data-image','');};imge.onerror=function(){$p.addClass('novfs');};imge.src=url;}
function highlightRow(row,selected){if(selected){if(row.hasClass("selected")){return;}
if(row.siblings("li")){row.siblings("li").removeClass("selected");}
row.addClass("selected");}else{row.removeClass("selected");}}
function SectionView(){this.constructor.apply(this,arguments);$unabletoconnect=$("#SEC-unabletoconnect").removeClass("hidden").attr('id','').remove();$processing=$("#SEC-processing").removeClass("hidden").attr('id','').remove();$noresults=$("#SEC-noresults").removeClass("hidden").attr('id','').remove();$templateTicket=$("#SEC-listitem").remove();$target=$(container);var $section=$('#SectionItem').removeClass('hidden').remove();this.render=function(keys){var publishRender=false;if(keys){switch(keys[0]){case"listings":this.updateAllticketView();publishRender=true;break;case"formfactor":formfactor=this.model.formfactor;break;case"error":displayMessage.call(this,this.model.error);break;case"sdata":this.updateSectionViews();publishRender=true;break;case"view":var view=this.model.view;if(view=='list'){$('#SectionViewSwitch').removeClass('grouped');$('#SV-bysection').addClass('hidden');$('#SV-all').removeClass('hidden');}else{$('#SectionViewSwitch').addClass('grouped');$('#SV-bysection').removeClass('hidden');$('#SV-all').addClass('hidden');}
publishRender=true;break;}}
if(publishRender){sandbox.publish("view-rendered","TicketList");}};this.processing=function(){$("#SI-all-list").empty();$("#SV-message").append($processing.clone());};this.updateAllticketView=function(){if(this.model.listings){var sids=this.model.sids;if(this.model.isScrubbed){var listings=this.model.listings.listing;updateListingViewForSection.call(this,'all',listings);}else{this.model.set('view','grouped');}}};this.updateSectionViews=function(){var m=this.model;clearMessage();var $con=$('#SV-bysection');$con.find('.sectionItem').addClass('unsynced');if(m.sids&&m.sdata){m.sids.forEach(function(sectionId){sectionId=sectionId+"";var $si=$con.find('#SectionItem-'+sectionId);var sec=m.sdata[sectionId];if($si.length===1){$si.find('#SI-'+sectionId+'-SectioName').text(sec.sectionName);if(sec&&sec.minTicketPrice){$si.find('#SI-'+sectionId+'-MinPrice').text(sandbox.displayPrice(sec.minTicketPrice,sec.currencyCode));$si.removeClass('unsynced');}}else{if(sec&&sec.minTicketPrice){var $newSection=$section.clone().attr('id','SectionItem-'+sectionId);var temp={};temp.SectionName={text:sec.sectionName};temp.MinPrice={text:sandbox.displayPrice(sec.minTicketPrice,sec.currencyCode)};temp.Currency={text:sec.currencyCode};if(m.event.view_from_section_ind){var url=getImageUrl(m.event,sectionId);$newSection.find('.sectionDetail').css('backgroundImage','url('+url+')').attr('data-image',getImageUrl(m.event,sectionId,true));}else{$newSection.addClass('novfs');}
sandbox.prefillDom({$elem:$newSection,tgtPrefix:'tgt-SEC-',newPrefix:'SI-'+sectionId+'-',data:temp});$con.prepend($newSection);}else{}}
if(sec&&sec.minTicketPrice){updateListingViewForSection.call(this,sectionId,sec.listing);}});}
$con.find('.sectionItem.unsynced').remove();var $items=$con.find('.sectionItem'),len=$items.length||0;if(len>1){$('#SectionViewSwitch').removeClass('hidden');setHeight.call(this,true);}else{$('#SectionViewSwitch').addClass('hidden');setHeight.call(this);if(len===0){if(m.sdata){displayMessage(null);}}else{var $sd=$items.find('.sectionDetail');if($sd.attr('data-image')){loadBigImage($sd);}
$sd.addClass('open');}}
if(len<m.sids.length){if(filterApplied){}}};function setHeight(visible){if(this.model.formfactor>2){var $s=$('#SectionModule'),h=$s.height();if(visible){var t=$('#SectionViewSwitch').height();h=h-t;}
$pro=$s.find('#pricePromote');if($pro.length){h=h-$pro.height();}
$('#SV-all, #SV-bysection').css('height',h+'px');}}
function updateListingViewForSection(sectionId,listings){var isUnScrubbed=sectionId=="0";var $p=$('#SI-'+sectionId+'-list');if($p.length===0){return;}
$p.empty();if(isUnScrubbed){$p.removeClass('scrubbed').addClass('unscrubbed');$p.parents('#sectionColumn').addClass('unscrubbed');}else{$p.removeClass('unscrubbed').addClass('scrubbed');$p.parents('#sectionColumn').removeClass('unscrubbed');}
if(!listings){displayMessage({code:'processing'});}else{var ll=listings.length;if(ll===0){displayMessage(null);}else{listings.forEach(function(listing,i){var $row=generateTicketListings.call(this,listing,isUnScrubbed?'show':'');if(i%2!==0){$row.addClass("even");}
$p.append($row);});}}}
function clearMessage(){$('#SV-message').empty();}
function displayMessage(error,$parent){if(!$("#sectionColumn").hasClass("ui-column-active")&&updateTicketListing){C.publish("Section-module-error",error);}
$parent=$parent||$('#SV-message').empty();$parent.empty();if(error){var code=error.code;if(code=='timeout'||code=='error'){$parent.empty().append($unabletoconnect.clone());}else if(code=='processing'){$parent.empty().append($processing.clone());}}else{if(filterApplied){$noresults.html(sandbox.getGVar("MSG.shared.exec.noTicketsForFilter"));}else{$noresults.html(sandbox.getGVar("MSG.shared.exec.noTickets"));}
$parent.append($noresults);}}
function generateTicketListings(listing,cssClass){var splitVector=listing.splitVector,ticketsAvaialble=splitVector,ticketId=listing.listingId,href=url,index,isSplit=(listing.splitOption!="0"),deliveryTypeName=sandbox.getGVar("MSG.module.Event.deliveryType.names").split(","),deliveryTypeIdList=sandbox.getGVar("MSG.module.Event.deliveryType.ids").split(","),eachText=sandbox.getGVar("MSG.module.Section.each"),$newRow=$templateTicket.clone().removeClass("hidden").attr("id","SEC-"+ticketId);var deliveryType=listing.deliveryTypeList;if(deliveryType&&typeof deliveryType!=="undefined"&&deliveryType!="null"){var _temp=[];for(var i=0,im=deliveryType.length;i<im;i++){index=deliveryTypeIdList.indexOf(""+deliveryType[i]);_temp.push(deliveryTypeName[index]);}
deliveryType=_temp.join(",");}else{deliveryType=" ";}
if(isSplit){splitVector.sort(function(a,b){return a-b;});var _cnt=splitVector.length;if(_cnt===1){ticketsAvaialble=splitVector[0];}else{ticketsAvaialble=splitVector[0]+"-"+splitVector[_cnt-1];}}
if(ticketsAvaialble===1||ticketsAvaialble=="1"){$newRow.find('.ticketcounts').html(singleTicketRowTemplate);}
var temp={},price=listing.currentPrice;href=sandbox.appendParamToUrl(url,'ticket_id',ticketId);var priceDisplay=sandbox.displayPrice(price.amount,price.currency);if(parseInt(price.amount,10)>10000){var pformat=sandbox.getGVar('I18N.MONEY')[price.currency].format,decimalSep=pformat.replace("###","").match(/###[^#]+##[^#]*/)[0].replace(/#/g,""),pindex=priceDisplay.indexOf(decimalSep);priceDisplay=priceDisplay.substring(0,pindex);}
temp["SEC-"+ticketId]={UnscrubbedSectionName:{text:listing.sectionName,cssClass:cssClass},RowDesc:{text:listing.row},DeliveryOptions:{text:deliveryType},Ticket:{text:ticketsAvaialble+" "},TicketId:{href:href,data:{"target-id":ticketId}},Price:{text:priceDisplay},Currency:{text:(price.currency=="USD")?eachText:price.currency}};sandbox.prefillDom({$elem:$newRow,tgtPrefix:"tgt-SEC-",newPrefix:"SEC-"+ticketId+"-",data:temp["SEC-"+ticketId]});var sN=listing.sectionName&&listing.sectionName.toLowerCase();if(sN=='ga'||sN=='general admission'){$newRow.find('.rowdetail').find('.rowInfo').addClass('hidden');}
if(ticketId==id_param){$newRow.addClass('selected');}
return $newRow;}}
SectionView.prototype=new C.View();function SectionController(){this.constructor.apply(this,arguments);this.destroy=function(){unbindGlobalEvents();};this.init=function(){bindGlobalEvents.call(this);if(this.view){bindViewEvents.call(this);}
var state=sandbox.getCurrentState();if(state&&state.type&&state.url){getDataFromURLState.call(this,{state:state});}};this.model.change(function(keys){if(keys){var k=keys[0];var data=this.model[k];if(k=='section'||k=='zones'){this.getSectionListings(data);}else if(k=="formfactor"){formfactor=data;this.model.set('formfactor',data,true,true);}else if(k=='filter'){if(data&&(data.quantity||data.price||data.delivery)){filterApplied=true;}else{filterApplied=false;}}else if(k=='listings'){syncSdata.call(this);track.call(this);}else if(k=='error'){track.call(this,true);}}},this);function track(error){var state=sandbox.getCurrentState(),eventId,event,filter=this.model.filter,events='prodview',omniture,ps=state&&state.paneSettings;if(filter){if(filter.delivery||filter.price||filter.quantity){omniture=[];if(filter.price){omniture.push('price');}
if(filter.quantity){omniture.push('quantity');}
if(filter.delivery){omniture.push('electronic delivery');}}}
if(ps&&ps.event){eventId=ps.event.id;event=C.ls.getEventFromLSById(eventId);}
if(typeof omniture!=="undefined"){if(error&&$('#sectionColumn').hasClass('ui-column-active')){events="prodview,event24";}else{return;}
sandbox.trackInOmniture(null,null,omniture.join("/"),omniture.join(":")+" filter touch: "+sandbox.getOmniPageName(),omniture.join("/")+' touch',events,eventId,null,null);}else{var genreId="",genredesc="";if(ps){var genre=sandbox.getGenreDetailForOmni(ps.channelId,ps.event);genreId=genre.id;genredesc=genre.desc;}
var opts={pageName:"mWeb: Event Details",prop11:"Event details: Unscrubbed listings",prop1:"Event details",events:events,prop70:genreId,prop4:genredesc,products:";"+eventId};if(event&&event.is_scrubbing_enabled=='1'){opts.pageName="mWeb: Ticket Listings";opts.prop11="Event details: Scrubbed listings: Ticket listings";opts.prop1="Ticket listings";if($("#EventMapModule").css("display")==='block'){opts.prop11="Event details: Interactive map: Ticket listings";}}
var duration=C.util.getTimeAheadOfEvent(event);if(duration){opts.eVar14=duration;}
sandbox.setOmnitureVariables(opts,true);}}
function syncSdata(data){var data=this.model.listings||data,sdata=this.model.sdata||{};var _sids=[];this.model.sdata=null;for(var secId in sdata){var section=sdata[secId];section.listing=[];delete section.minTicketPrice;}
if(data.listing){data.listing.forEach(function(listing){var sId=(listing.sectionId||0)+"";var section=sdata[sId]||{listing:[]};section.listing.push(listing);if(!section.sectionName){section.sectionName=listing.sectionName;section.sectionId=listing.sectionId;section.currencyCode=listing.currentPrice.currency;}
section.totalTickets=section.totalTickets||0;section.totalTickets+=parseInt(listing.quantity,10);var p=listing.currentPrice.amount;section.minTicketPrice=Math.min(section.minTicketPrice,p)||p;sdata[sId]=section;if(_sids.indexOf(sId)==-1){_sids.push(sId);}});}
if(this.model.selectbyzone){this.model.set('sids',_sids);}
this.model.set('sdata',sdata);}
this.getSectionListings=function(data){if(!data){return;}
this.view.processing();var self=this,queryString,_sortBy=null,ids=data.id,eventId=this.model.event.id,inventoryAPIUrl=sandbox.getGVar('site.inventoryAPIUrl'),filter,selectByZone=data.selectbyzone;filter=sandbox.getFilterValue(eventId);self.model.set('filter',filter);filter=filter||{};if(filter.ssort=='0'){_sortBy="currentprice asc";}else if(filter.ssort=='1'){_sortBy="currentprice des";}
queryString='?eventId='+eventId+'&pricingSummary=false&zoneStats=false&start=0&rows=500';if(ids){if(selectByZone){queryString+='&zoneIdList='+ids;}else{queryString+='&sectionIdList='+ids;}}
if(filter.price){queryString+=filter.price.min?('&pricemin='+filter.price.min):'';queryString+=filter.price.max?('&pricemax='+filter.price.max):'';}
if(filter.delivery){queryString+=filter.delivery?('&deliverytypelist='+filter.delivery):'';}
if(filter.quantity){queryString+=filter.quantity?('&quantity='+filter.quantity):'';}
if(_sortBy){queryString+='&sort='+_sortBy;}
queryString+='&_type=json&_='+(new Date()).getTime();sandbox.StubHubService(inventoryAPIUrl+queryString,{success:function(data){if(data.listing){if(filter.ssort=='2'){data.listing.sort(sandbox.getSortFunc('row',true,Number));}else if(filter.ssort=='3'){data.listing.sort(sandbox.getSortFunc('row',false,Number));}}
self.model.set('listings',data);},error:function(xhr,errorCode,error){self.model.set('error',{code:errorCode,error:error});},name:'Inventory API',omniPageName:'mWeb:Ticket Listings'});};function bindViewEvents(){var self=this;var $container=$(container);$container.delegate('.sectionDetail','click',function(){var $this=$(this);if($this.hasClass('open')){$this.removeClass('open');}else{if($this.attr('data-image')){loadBigImage($this);}
$this.addClass('open');}
window.setTimeout(function(){sandbox.publish("view-rendered","TicketList");},400);});$container.find('#SectionViewSwitch').bind('click.fast',function(){var $this=$(this);var opts={"prop11":"Event details: Ticket listings","prop63":"mWeb: Ticket Listings","prop62":"mWeb: link","prop61":"mWeb: Ticketlistings : View by sections"};if($this.hasClass('grouped')){self.model.set('view','list');opts.prop61="mWeb: Ticketlistings : View all tickets"}else{self.model.set('view','grouped');}
sandbox.trackInOmnitureVars(opts);});$container.delegate('.ticketrow','click',function(e){e.preventDefault();e.stopPropagation();var $link=$(this).find(".SEC-link");var targetName='ticket';var targetId=$link.attr('data-target-id');var href=$link.attr('href');var relevantDataForTarget=sandbox.toArray(self.model.listings.listing).SH_getElem("listingId",targetId);var ps=sandbox.getCurrentState().paneSettings;if(ps){ps.ticket={id:targetId};}
if(self.model.filter){filter=self.model.filter;}else{filter=sandbox.getFilterValue(ps.event.id);filter=filter||{};}
var isFixedQuantityTicket=(relevantDataForTarget&&(relevantDataForTarget.splitOption=="0"||relevantDataForTarget.quantity=="1"));highlightRow($("#SEC-"+targetId),true);id_param=targetId;var onTicketPage=sandbox.getCurrentState().type==targetName;C.publish("ui-link-clicked",{target:targetName,targetId:targetId,href:href,paneSettings:ps,data:relevantDataForTarget,replace:onTicketPage});});}
function bindGlobalEvents(){C.subscribe('sort-listing-by',function(c){var l=this.model.listings;if(c.field&&l&&l.listing){l.listing.sort(sandbox.getSortFunc(c.field,c.asc,c.type));this.model.listings=null;this.model.set('listings',l);}},this);C.subscribe('ui-formfactor-changed',function(data){formfactor=data;this.model.set('formfactor',data,false,true);},this);C.subscribe('url.update.state',getDataFromURLState,this);C.subscribe('event-filter-change',onFilterChange,this);}
function onFilterChange(data){this.model.filter=null;this.model.set('filter',data.filter);if(data){var lc=data.lastchange;if(lc=='ssort'&&data.filter){var ss=data.filter[lc];if(ss=='2'||ss=='3'){C.publish('sort-listing-by',{field:'row',type:Number,asc:ss=='2'});}else if(ss=='0'||ss=='1'){C.publish('sort-listing-by',{field:'currentPrice.amount',type:Number,asc:ss=='0'});}}else if(typeof this.model.zones!="undefined"&&this.model.selectbyzone){this.getSectionListings(this.model.zones);}else{this.getSectionListings(this.model.section);}}}
function unbindGlobalEvents(){C.unsubscribe('ui-formfactor-changed');C.unsubscribe('url.update.state',getDataFromURLState);}
function getDataFromURLState(data){var state=data.state,type=state&&state.type,ui=state&&state.ui;if(type=='event'||type=='section'||type=='ticket'){var self=this;var ps=state.paneSettings,_event=ps.event,returnWhenSameZone=false;hasImage=_event.viewFromSectionEnable;self.model.set('isScrubbed',_event.isScrubbed,true);if(!ui){ui=opt.ui;}
if(ui){formfactor=ui.formfactor;self.model.set('formfactor',ui.formfactor,true);}
if(self.model.selectbyzone&&ps&&ps.section&&ps.section.zones&&ps.section.zones.id&&ps.section.zones.id!==undefined&&self.model.zones&&self.model.zones.id!==undefined&&ps.section.zones.id==self.model.zones.id){returnWhenSameZone=true;}
if(type=='event'||ps&&ps.section&&ps.section.id&&ps.section.id!==undefined&&self.model.section&&self.model.section.id!==undefined&&ps.section.id==self.model.section.id||returnWhenSameZone){return;}else if(!_event.isScrubbed){if(self.model.eventId==_event.id){return;}else{self.model.view=null;}}
self.model.set('eventId',_event.id+"",true);url=state.url;var section=ps.section;if(type=='ticket'){id_param=ps.ticket.id;highlightRow($("#SEC-"+id_param),true);}
var path_metadata=sandbox.getEventFromLSById(_event.id);if(path_metadata&&section){self.model.set('event',path_metadata,false,true);if(!section.zones){var sectionId=section.id+"";self.model.set('sids',section.ids||(section.id&&sectionId.split(','))||["0"]);}
self.model.set('selectbyzone',ps.selectbyzone);if(ps.selectbyzone){var zones=ps.section.zones;self.model.set('zones',{id:section.zones.id,selectbyzone:true});}else{self.model.set('section',{id:section.id,selectbyzone:false});}
if(section.sdata){self.model.set('sdata',section.data);}
if(sandbox.getGVar('exec.section_view')){self.model.set('view',sandbox.getGVar('exec.section_view'));sandbox.setGVar('exec.section_view',undefined);}else if(!self.model.view){self.model.set('view','list');}}}}}
SectionController.prototype=new C.Controller();this.init=function(){opt=sandbox.options;formfactor=opt.ui.formfactor;container=sandbox.getContainer();connectSuccess=false;this.m=new C.Model();this.v=new SectionView(this.m);this.c=new SectionController(this.m,this.v);this.c.init();singleTicketRowTemplate=opt.msg.ticket.replace('{0}','<span id="tgt-SEC-Ticket" class="ticket"></span>');};this.destroy=function(){};};})(StubHub);(function(SH){function GeoSelector(sandbox){var bob_id=sandbox.getGVar('exec.book_of_business_id'),l10n;var C=sandbox.core;function GeoList(){this.constructor.apply(this,arguments);this.findClosestMetro=function(latitude,longitude,_coordinates){if(latitude=='0'&longitude=='0'){return{geoId:0,geoName:l10n.all_loc,city:l10n.all_loc};}
var geoList=_coordinates||this.coordinates,lat=latitude?latitude:(this.current_location?this.current_location.lat:0),lng=longitude?longitude:(this.current_location?this.current_location.lng:0);if(!geoList||!lat||!lng){return{geoId:0};}
var minD=40000,_loc,radConv=Math.PI/180,latR=lat*radConv,lngR=lng*radConv,R=6371;for(var i=geoList.length;i;i--){var _geo=geoList[i-1],latMR=_geo.latitude*radConv,lngMR=_geo.longitude*radConv,d=Math.acos(Math.sin(latR)*Math.sin(latMR)+Math.cos(latR)*Math.cos(latMR)*Math.cos(lngR-lngMR))*R;if(d<minD){minD=d;_loc=_geo;}}
return{domain:_loc.domainName,geoId:_loc.geographicId,geoName:_loc.city,city:_loc.city,stateShort:_loc.stateShort,country:_loc.country,position:_loc.latitude+','+_loc.longitude};};}
GeoList.prototype=new C.Model();function GeoView(){this.constructor.apply(this,arguments);$('#geo_domain_'+bob_id).addClass('hidden');this.render=function(keys){if(keys){if(keys[0]=='coordinates'){if(this.container){buildGeoList.call(this,this.model.coordinates);}}else if(keys[0]=='current_location'){var loc=this.model.current_location;if(loc){$(this.container).find('.geo_checked_marker').remove();$('#geo_'+loc.geoId).prepend('<div class="geo_checked_marker sprite sprite-check_button"></div>');}}}};function buildGeoList(coords){var countryCode=null,stateCode=null,stateGroup=null,$country=null,$stategroup=null,$cities=null,$geoWrapper=$('#geoWrapper');$geoWrapper.empty();for(var i=0,j=coords.length;i<j;i++){var coord=coords[i];if(coord.country!=countryCode){var cw_html='<div class="geo_toggleCountry" id="geo_'+coord.country+'">'+'<div class="geo_country geo_topitem">'+l10n[coord.country]+'<div class="geo_toggle sprite ui-toggle-icon sprite-plus_sign"></div></div>'+'</div>';$geoWrapper.append(cw_html);var cl_html='<div id="geo_'+coord.country+'_list" class="geo_citylist hidden"></div>';$country=$(cl_html);$geoWrapper.append($country);countryCode=coord.country;}
if(coord.state!=stateCode){if(coord.state.charAt(0)!=stateGroup){var group_html='<div class="geo_groupby1stchar"></div>';$stategroup=$(group_html);$country.append($stategroup);stateGroup=coord.state.charAt(0);}
var state_html='<div class="geo_citylist4state"><ul><li class="geo_state" data-ss="'+coord.stateShort+'" data-ct="'+coord.country+'">'+coord.state+'</li></ul></div>',$state=$(state_html);$cities=$state.find('ul');$stategroup.append($state);stateCode=coord.state;}
$cities.append('<li class="geo_city geo_select" id="geo_'+coord.geographicId+'" data-ps="'+coord.latitude+','+coord.longitude+'"><a href="javascript:void(0);">'+coord.city+'</a></li>');}
$geoWrapper.find('.geo_citylist').append('<div class="geo_clear"></div>');return $geoWrapper;}}
GeoView.prototype=new C.View();function GeoCtrl(){this.constructor.apply(this,arguments);this.init=function(){bindGlobalEvents.call(this);var container=sandbox.getContainer();if(this.view){if(container){this.view.container=container;}
bindViewEvents.call(this);}
if(this.model){var self=this;this.model.change(function(keys){if(keys[0]=='current_location'){var cur_loc=this.model.current_location;sandbox.setGVar('geo.location',cur_loc);C.publish('geo-current-location',cur_loc);}},self);}};this.destroy=function(){unbindGeoDetection(sandbox);};function bindViewEvents(){var _container=this.view.container,self=this;if(!_container){return;}
var $container=$(_container);$container.delegate('.geo_toggleCountry','click',function(event){event.preventDefault();event.stopPropagation();var $this=$(this),$list=$(this.nextSibling),$toggle=$this.find('.geo_toggle');if($toggle.hasClass('sprite-plus_sign')){$toggle.removeClass('sprite-plus_sign').addClass('sprite-minus_sign');$list.removeClass('hidden');}else if($toggle.hasClass('sprite-minus_sign')){$toggle.removeClass('sprite-minus_sign').addClass('sprite-plus_sign');$list.addClass('hidden');}
sandbox.publish("view-rendered");});$container.delegate('.geo_select','click',function(event){event.preventDefault();event.stopPropagation();var $this=$(this);var $state=$this.siblings('.geo_state');var loc={geoId:this.id.substr(4),geoName:$this.find('a').text(),stateShort:$state.attr('data-ss'),country:$state.attr('data-ct'),position:$this.attr('data-ps')};loc.city=loc.geoName;sandbox.trackInOmnitureVars({"eVar68":loc.geoName,"prop10":loc.geoName,"prop11":"Choose Location","prop63":sandbox.getOmniPageName(),"prop62":"choose location touch","prop61":"chosse location touch: "+loc.geoName+": "+sandbox.getOmniPageName()},'location touch');self.model.set('current_location',loc);sandbox.setGVar('geo.position',null);});$container.find('.geo_domain').bind('click',function(){var $this=$(this);var bob=$this.attr("bob-id");if(bob_id!=bob){var _href=sandbox.getHostByBobId(bob);if(window.confirm(sandbox.getGVar('MSG.shared.exec.domainPop.'+bob))){sandbox.goToDomainUrl(_href);}}});$container.delegate('#geoDetection','click',function(event){event.preventDefault();event.stopPropagation();$('#geoHeader').attr('class','loading');C.publish('geo.request.location',true);sandbox.trackInOmniture("Choose Location",null,"current location touch",null,'current location touch');});}
function bindGlobalEvents(){bindGeoDetection.call(this);}
function validateDomainForGeo(loc,param){var cty=loc.country;if(!sandbox.getGVar('exec.is'+cty)){var bob=sandbox.getBobFromDomain(loc.domain);var msg=sandbox.getGVar('MSG.shared.exec.domainPop2.'+bob);if(window.confirm(msg)){var _url=sandbox.getHostByCountry(cty);sandbox.goToDomainUrl(_url+param);}else{if(param.indexOf('pgeo')!=-1){return false;}}}
return true;}
function geoSuccess(position){var coord=position.coords;var pre_check_loc=this.model.findClosestMetro.call(this.model,coord.latitude,coord.longitude,coordinates.typical.coordinates);if(pre_check_loc){validateDomainForGeo(pre_check_loc,'/?lat_lon='+coord.latitude+','+coord.longitude);}
var cur_loc=this.model.findClosestMetro.call(this.model,coord.latitude,coord.longitude);this.model.set('current_location',cur_loc);$('#geoHeader').attr('class','');sandbox.setOmnitureVariables({"eVar68":cur_loc.geoName,"prop10":cur_loc.geoName},false);sandbox.trackInOmnitureVars({"eVar68":cur_loc.geoName,"prop10":cur_loc.geoName},'location touch');}
function validatePgeoData(geoid){var _pgeo;var _co=coordinates['.com']['coordinate'],_pgeo=_co.SH_getElem('geographicId',geoid);if(!_pgeo){_co=coordinates['.co.uk']['coordinate'];_pgeo=_co.SH_getElem('geographicId',geoid);}
if(_pgeo){var geoName=(_pgeo&&_pgeo.city),loc;loc={geoId:geoid,geoName:geoName,city:geoName,stateShort:_pgeo.stateShort,country:_pgeo.country,position:_pgeo.latitude+','+_pgeo.longitude,domain:_pgeo.domainName};var isValidDomain=validateDomainForGeo(loc,'/?pgeo='+geoid);if(!isValidDomain){loc=this.model.findClosestMetro.call(this.model,0,0);geoName=loc&&loc.geoName;}
this.model.set('current_location',loc);sandbox.setOmnitureVariables({"eVar68":geoName,"prop10":geoName},false);sandbox.trackInOmnitureVars({"eVar68":geoName,"prop10":geoName},'location touch')}else{sandbox.core.publish("geo.request.location");}}
function bindGeoDetection(){if(C.lsModules().indexOf("GeoDetection")==-1){C.register("GeoDetection",StubHub.Modules.GeoDetection);}
if(C.lsInstances().indexOf("GeoDetection")==-1){C.start("GeoDetection");}
function geoError(){$('#geoHeader').attr('class','error');}
C.subscribe('geo-location-detect-success',geoSuccess,this);C.subscribe('geo-location-detect-fail',geoError,this);C.subscribe('geo-location-detect-timeout',geoError,this);C.subscribe('pgeo-location-detect',validatePgeoData,this);}
function unbindGeoDetection(){C.unsubscribe('geo-location-detect-success',geoSuccess);C.unsubscribe('geo-location-detect-fail');C.unsubscribe('geo-location-detect-timeout');C.unsubscribe('pgeo-location-detect');}}
GeoCtrl.prototype=new StubHubCore.Controller();this.init=function(){var opts=sandbox.options;l10n=l10n||opts.msg;var site=sandbox.getGVar('exec.site');var _coordinates=coordinates[site];this.m=new GeoList();this.v=new GeoView(this.m);this.c=new GeoCtrl(this.m,this.v);this.c.init(sandbox);this.m.set('coordinates',_coordinates.coordinate||opts.coordinates);var loc=sandbox.getGVar('geo.location');this.m.set('current_location',loc);};this.destroy=function(){this.c.destroy();};var coordinates={".com":{"coordinate":[{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Alabama","city":"Birmingham","latitude":33.5206608,"longitude":-86.80249,"geographicId":4945,"stateShort":"AL"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Alaska","city":"Anchorage","latitude":61.2180556,"longitude":-149.9002778,"geographicId":8765,"stateShort":"AK"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Arizona","city":"Phoenix","latitude":33.4483771,"longitude":-112.0740373,"geographicId":226,"stateShort":"AZ"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Arkansas","city":"Little Rock","latitude":34.7464809,"longitude":-92.2895948,"geographicId":3864,"stateShort":"AR"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"California","city":"Los Angeles Metro","latitude":34.0522342,"longitude":-118.2436849,"geographicId":10,"stateShort":"CA"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"California","city":"Sacramento","latitude":38.5815719,"longitude":-121.4943996,"geographicId":81690,"stateShort":"CA"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"California","city":"San Diego","latitude":32.7153292,"longitude":-117.1572551,"geographicId":81689,"stateShort":"CA"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"California","city":"SF Bay Area","latitude":37.7749295,"longitude":-122.4194155,"geographicId":81,"stateShort":"CA"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Colorado","city":"Denver","latitude":39.7391536,"longitude":-104.9847034,"geographicId":678,"stateShort":"CO"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Connecticut","city":"Hartford","latitude":41.7637111,"longitude":-72.6850932,"geographicId":1869,"stateShort":"CT"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Delaware","city":"Wilmington","latitude":39.7458333,"longitude":-75.5466667,"geographicId":110102,"stateShort":"DE"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Dist. of Columbia","city":"Washington D.C.","latitude":38.8951118,"longitude":-77.0363658,"geographicId":525,"stateShort":"DC"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Florida","city":"Jacksonville","latitude":30.3321838,"longitude":-81.655651,"geographicId":708,"stateShort":"FL"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Florida","city":"Miami / S. Florida","latitude":25.7889689,"longitude":-80.2264393,"geographicId":669,"stateShort":"FL"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Florida","city":"Orlando","latitude":28.5383355,"longitude":-81.3792365,"geographicId":663,"stateShort":"FL"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Florida","city":"Tallahassee","latitude":30.4382559,"longitude":-84.2807329,"geographicId":6750,"stateShort":"FL"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Florida","city":"Tampa / St. Petersburg","latitude":27.949436,"longitude":-82.4651441,"geographicId":404,"stateShort":"FL"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Georgia","city":"Atlanta","latitude":33.7489954,"longitude":-84.3879824,"geographicId":670,"stateShort":"GA"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Hawaii","city":"Honolulu","latitude":21.3069444,"longitude":-157.8583333,"geographicId":422,"stateShort":"HI"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Idaho","city":"Boise","latitude":43.612631,"longitude":-116.211076,"geographicId":4921,"stateShort":"ID"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Illinois","city":"Chicago","latitude":41.850033,"longitude":-87.6500523,"geographicId":666,"stateShort":"IL"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Indiana","city":"Indianapolis","latitude":39.7683765,"longitude":-86.1580423,"geographicId":697,"stateShort":"IN"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Iowa","city":"Des Moines","latitude":41.6005448,"longitude":-93.6091064,"geographicId":5637,"stateShort":"IA"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Kansas","city":"Topeka","latitude":39.0558235,"longitude":-95.6890185,"geographicId":9545,"stateShort":"KS"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Kansas","city":"Wichita","latitude":37.6922361,"longitude":-97.3375448,"geographicId":79282,"stateShort":"KS"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Kentucky","city":"Louisville","latitude":38.2527684,"longitude":-85.7584463,"geographicId":4421,"stateShort":"KY"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Louisiana","city":"New Orleans","latitude":29.9647222,"longitude":-90.0705556,"geographicId":242,"stateShort":"LA"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Maryland","city":"Baltimore","latitude":39.2903848,"longitude":-76.6121893,"geographicId":81691,"stateShort":"MD"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Massachusetts","city":"Boston","latitude":42.3584308,"longitude":-71.0597732,"geographicId":674,"stateShort":"MA"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Michigan","city":"Detroit","latitude":42.331427,"longitude":-83.0457538,"geographicId":676,"stateShort":"MI"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Michigan","city":"Grand Rapids","latitude":42.9633599,"longitude":-85.6680863,"geographicId":4204,"stateShort":"MI"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Minnesota","city":"Minneapolis","latitude":44.9799654,"longitude":-93.2638361,"geographicId":680,"stateShort":"MN"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Mississippi","city":"Jackson","latitude":32.2987573,"longitude":-90.1848103,"geographicId":5543,"stateShort":"MS"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Missouri","city":"Kansas City","latitude":39.0997265,"longitude":-94.5785667,"geographicId":702,"stateShort":"MO"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Missouri","city":"St. Louis","latitude":38.646991,"longitude":-90.224967,"geographicId":683,"stateShort":"MO"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Montana","city":"Missoula","latitude":46.872146,"longitude":-113.9939982,"geographicId":5924,"stateShort":"MT"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Nebraska","city":"Lincoln","latitude":40.806862,"longitude":-96.681679,"geographicId":5530,"stateShort":"NE"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Nevada","city":"Las Vegas","latitude":36.114646,"longitude":-115.172816,"geographicId":689,"stateShort":"NV"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Nevada","city":"Reno","latitude":39.5296329,"longitude":-119.8138027,"geographicId":5627,"stateShort":"NV"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"New Hampshire","city":"Manchester","latitude":42.9956397,"longitude":-71.4547891,"geographicId":76587,"stateShort":"NH"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"New Jersey","city":"Atlantic City","latitude":39.3642834,"longitude":-74.4229266,"geographicId":78083,"stateShort":"NJ"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"New Mexico","city":"Albuquerque","latitude":35.0844909,"longitude":-106.6511367,"geographicId":5647,"stateShort":"NM"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"New York","city":"Albany","latitude":42.6525793,"longitude":-73.7562317,"geographicId":1868,"stateShort":"NY"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"New York","city":"Buffalo","latitude":42.8864468,"longitude":-78.8783689,"geographicId":695,"stateShort":"NY"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"New York","city":"New York Metro","latitude":40.7143528,"longitude":-74.0059731,"geographicId":664,"stateShort":"NY"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"New York","city":"Syracuse","latitude":43.0481221,"longitude":-76.1474244,"geographicId":6472,"stateShort":"NY"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"North Carolina","city":"Charlotte","latitude":35.2270869,"longitude":-80.8431267,"geographicId":684,"stateShort":"NC"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"North Carolina","city":"Raleigh-Durham","latitude":35.772096,"longitude":-78.6386145,"geographicId":685,"stateShort":"NC"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"North Dakota","city":"Fargo","latitude":46.8771863,"longitude":-96.7898034,"geographicId":4423,"stateShort":"ND"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Ohio","city":"Cincinnati","latitude":39.1361111,"longitude":-84.5030556,"geographicId":11863,"stateShort":"OH"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Ohio","city":"Cleveland","latitude":41.4994954,"longitude":-81.6954088,"geographicId":3261,"stateShort":"OH"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Ohio","city":"Columbus","latitude":39.9611755,"longitude":-82.9987942,"geographicId":11883,"stateShort":"OH"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Oklahoma","city":"Oklahoma City","latitude":35.4675602,"longitude":-97.5164276,"geographicId":3863,"stateShort":"OK"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Oregon","city":"Portland","latitude":45.5234515,"longitude":-122.6762071,"geographicId":704,"stateShort":"OR"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Pennsylvania","city":"Philadelphia","latitude":39.952335,"longitude":-75.163789,"geographicId":522,"stateShort":"PA"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Pennsylvania","city":"Pittsburgh","latitude":40.4406248,"longitude":-79.9958864,"geographicId":681,"stateShort":"PA"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Rhode Island","city":"Providence","latitude":41.8239891,"longitude":-71.4128343,"geographicId":92294,"stateShort":"RI"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"South Carolina","city":"Charleston","latitude":32.7765656,"longitude":-79.9309216,"geographicId":4481,"stateShort":"SC"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"South Carolina","city":"Columbia","latitude":34.0007104,"longitude":-81.0348144,"geographicId":5630,"stateShort":"SC"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"South Dakota","city":"Sioux Falls","latitude":43.5499749,"longitude":-96.700327,"geographicId":6743,"stateShort":"SD"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Tennessee","city":"Knoxville","latitude":35.9606384,"longitude":-83.9207392,"geographicId":5528,"stateShort":"TN"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Tennessee","city":"Memphis","latitude":35.1495343,"longitude":-90.0489801,"geographicId":701,"stateShort":"TN"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Tennessee","city":"Nashville","latitude":36.1658899,"longitude":-86.7844432,"geographicId":700,"stateShort":"TN"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Texas","city":"Austin / San Antonio","latitude":30.267153,"longitude":-97.7430608,"geographicId":707,"stateShort":"TX"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Texas","city":"Dallas","latitude":32.802955,"longitude":-96.769923,"geographicId":672,"stateShort":"TX"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Texas","city":"El Paso","latitude":31.7587198,"longitude":-106.4869314,"geographicId":4426,"stateShort":"TX"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Texas","city":"Houston","latitude":29.7628844,"longitude":-95.3830615,"geographicId":694,"stateShort":"TX"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Texas","city":"Lubbock","latitude":33.5778631,"longitude":-101.8551665,"geographicId":3861,"stateShort":"TX"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Utah","city":"Salt Lake City","latitude":40.7607793,"longitude":-111.8910474,"geographicId":706,"stateShort":"UT"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Virginia","city":"Richmond","latitude":37.542979,"longitude":-77.469092,"geographicId":4425,"stateShort":"VA"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Washington","city":"Seattle","latitude":47.6062095,"longitude":-122.3320708,"geographicId":693,"stateShort":"WA"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"West Virginia","city":"Charleston","latitude":38.3498195,"longitude":-81.6326234,"geographicId":4541,"stateShort":"WV"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Wisconsin","city":"Green Bay","latitude":44.519159,"longitude":-88.019826,"geographicId":4422,"stateShort":"WI"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Wisconsin","city":"Milwaukee","latitude":43.0389025,"longitude":-87.9064736,"geographicId":691,"stateShort":"WI"},{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Wyoming","city":"Casper","latitude":42.866632,"longitude":-106.313081,"geographicId":9465,"stateShort":"WY"},{"domainName":"stubhub.com","country":"CA","countryGeographicId":197077,"state":"Alberta","city":"Calgary","latitude":51.045,"longitude":-114.0572222,"geographicId":5878,"stateShort":"AB"},{"domainName":"stubhub.com","country":"CA","countryGeographicId":197077,"state":"Alberta","city":"Edmonton","latitude":53.543564,"longitude":-113.490452,"geographicId":5877,"stateShort":"AB"},{"domainName":"stubhub.com","country":"CA","countryGeographicId":197077,"state":"British Columbia","city":"Vancouver","latitude":49.248523,"longitude":-123.1088,"geographicId":5871,"stateShort":"BC"},{"domainName":"stubhub.com","country":"CA","countryGeographicId":197077,"state":"Manitoba","city":"Winnipeg","latitude":49.886083,"longitude":-97.152921,"geographicId":6203,"stateShort":"MB"},{"domainName":"stubhub.com","country":"CA","countryGeographicId":197077,"state":"New Brunswick","city":"Fredericton","latitude":45.954364,"longitude":-66.645619,"geographicId":7126,"stateShort":"NB"},{"domainName":"stubhub.com","country":"CA","countryGeographicId":197077,"state":"Nova Scotia","city":"Halifax","latitude":44.648881,"longitude":-63.575312,"geographicId":7124,"stateShort":"NS"},{"domainName":"stubhub.com","country":"CA","countryGeographicId":197077,"state":"Ontario","city":"Ottawa","latitude":45.411572,"longitude":-75.698194,"geographicId":5874,"stateShort":"ON"},{"domainName":"stubhub.com","country":"CA","countryGeographicId":197077,"state":"Ontario","city":"Toronto","latitude":43.6525,"longitude":-79.3816667,"geographicId":5869,"stateShort":"ON"},{"domainName":"stubhub.com","country":"CA","countryGeographicId":197077,"state":"Quebec","city":"Montreal","latitude":45.508867,"longitude":-73.554242,"geographicId":5879,"stateShort":"QC"},{"domainName":"stubhub.com","country":"CA","countryGeographicId":197077,"state":"Saskatchewan","city":"Saskatoon","latitude":52.13437,"longitude":-106.647656,"geographicId":7604,"stateShort":"SK"}]},".co.uk":{"coordinate":[{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Midlands","city":"Nottingham","latitude":52.9551147,"longitude":-1.1491718,"geographicId":201890,"stateShort":"MI"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Midlands","city":"Stoke-on-Trent","latitude":53.0265053,"longitude":-2.1766359,"geographicId":201915,"stateShort":"MI"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Midlands","city":"Wolverhampton","latitude":52.5857278,"longitude":-2.1292507,"geographicId":201916,"stateShort":"MI"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Midlands","city":"Derby","latitude":52.9218993,"longitude":-1.475642,"geographicId":201891,"stateShort":"MI"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Midlands","city":"Birmingham","latitude":52.4829614,"longitude":-1.893592,"geographicId":204678,"stateShort":"MI"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Midlands","city":"Leicester","latitude":52.6347704,"longitude":-1.1295191,"geographicId":201889,"stateShort":"MI"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Northern Ireland","city":"Armagh","latitude":54.3475392,"longitude":-6.6561082,"geographicId":201924,"stateShort":"NI"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Northern Ireland","city":"Antrim","latitude":54.7133822,"longitude":-6.2167609,"geographicId":204580,"stateShort":"NI"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Northern Ireland","city":"Derry","latitude":54.9945099,"longitude":-7.3199955,"geographicId":201922,"stateShort":"NI"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Northern Ireland","city":"Fermanagh","latitude":54.4513524,"longitude":-7.7125018,"geographicId":204680,"stateShort":"NI"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Northern Ireland","city":"Tyrone","latitude":54.6146242,"longitude":-7.1535164,"geographicId":204582,"stateShort":"NI"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Northern Ireland","city":"Down","latitude":54.3412911,"longitude":-5.7484854,"geographicId":204581,"stateShort":"NI"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"South","city":"Bristol","latitude":51.4553129,"longitude":-2.5919023,"geographicId":201906,"stateShort":"SO"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"South","city":"Brighton","latitude":50.819522,"longitude":-0.13642,"geographicId":201941,"stateShort":"SO"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"South","city":"Southampton","latitude":50.904966,"longitude":-1.403234,"geographicId":201942,"stateShort":"SO"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"South","city":"Oxford","latitude":51.7522792,"longitude":-1.2558838,"geographicId":201944,"stateShort":"SO"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"South","city":"Norwich","latitude":52.6281014,"longitude":1.2993494,"geographicId":201894,"stateShort":"SO"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"South","city":"Milton Keynes","latitude":52.0414376,"longitude":-0.7605567,"geographicId":204579,"stateShort":"SO"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"South","city":"Reading","latitude":51.455041,"longitude":-0.9690884,"geographicId":204679,"stateShort":"SO"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Scotland","city":"Glasgow","latitude":55.8656274,"longitude":-4.2572227,"geographicId":10925,"stateShort":"SC"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Scotland","city":"Edinburgh","latitude":55.9501755,"longitude":-3.1875359,"geographicId":201980,"stateShort":"SC"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Scotland","city":"Aberdeen","latitude":57.1474915,"longitude":-2.095397,"geographicId":201981,"stateShort":"SC"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Wales\/North West","city":"Liverpool","latitude":53.4107766,"longitude":-2.9778383,"geographicId":201900,"stateShort":"NW"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Wales\/North West","city":"Manchester","latitude":53.4807125,"longitude":-2.2343765,"geographicId":201901,"stateShort":"NW"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Wales\/North West","city":"Cardiff","latitude":51.4813069,"longitude":-3.1804979,"geographicId":201926,"stateShort":"NW"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"North East","city":"Leeds","latitude":53.8371263,"longitude":-1.4722292,"geographicId":201935,"stateShort":"NE"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"North East","city":"Sheffield","latitude":53.3830548,"longitude":-1.4647953,"geographicId":201936,"stateShort":"NE"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"North East","city":"Newcastle","latitude":54.9778404,"longitude":-1.6129165,"geographicId":201932,"stateShort":"NE"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"North East","city":"Grimsby","latitude":53.565444,"longitude":-0.0751875,"geographicId":204677,"stateShort":"NE"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Greater & Central London","city":"London","latitude":51.51333,"longitude":-0.088947,"geographicId":6629,"stateShort":"LN"}]},"typical":{"coordinates":[{"domainName":"stubhub.com","country":"US","countryGeographicId":196976,"state":"Missouri","city":"Kansas City","latitude":39.0997265,"longitude":-94.5785667,"geographicId":702,"stateShort":"MO"},{"domainName":"stubhub.co.uk","country":"UK","countryGeographicId":6628,"state":"Greater & Central London","city":"London","latitude":51.51333,"longitude":-0.088947,"geographicId":6629,"stateShort":"LN"}]}};}
SH.Modules.GeoSelector=GeoSelector;function GeoDetection(sandbox){var C=sandbox.core;function GeoDetectCtrl(){this.constructor.apply(this,arguments);var retrievedCurrentPosition=false;var applyTempLocLock;this.init=function(){var container=sandbox.getContainer();if(this.view){if(container){this.view.container=container;}}
var self=this;var state=sandbox.getCurrentState();var latlng=state&&state.search&&state.search.lat_lon;if(latlng){startGeoSelector();var _latlng=latlng.split(','),lat=_latlng[0],lng=_latlng[1],position={coords:{latitude:lat,longitude:lng}};if(!isNaN(lat)&&!isNaN(lng)){sandbox.setGVar('geo.position',position);sandbox.publish('geo-location-detect-success',position);}}
var pgeo=state&&state.search&&state.search.pgeo;if(pgeo){startGeoSelector();sandbox.publish('pgeo-location-detect',pgeo);}
C.subscribe('geo.request.location',function(data){var loc=sandbox.getGVar('geo.location');if(!data&&loc&&loc.geoId!=null&&loc.geoName){C.publish('geo-current-location',loc);}else{startGeoSelector();geo_getCurrentLocation.call(self);}});};function startGeoSelector(){if(C.lsModules().indexOf("GeoSelector")==-1){var options={container:"GeoSelector",msg:sandbox.getGVar("MSG.module.GeoSelector")};C.register("GeoSelector",StubHub.Modules.GeoSelector,options);}
if(C.lsInstances().indexOf("GeoSelector")==-1){C.start("GeoSelector");}}
function geo_detect_success(position){retrievedCurrentPosition=true;C.publish('geo-location-detect-success',position);sandbox.setGVar('geo.position',position);window.setTimeout(function(){applyTempLocLock=false;},3000);}
function geo_getCurrentLocation(options){options=options||{};var self=this;var sb=sandbox,success=options.success||function(position){geo_detect_success.call(self,position);},fail=options.fail||function(positionFail){C.publish('geo-location-detect-fail',positionFail);self.model.set('status','done');},timeout=options.timeout||function(){C.publish('geo-location-detect-timeout');self.model.set('status','done');},timeout_setting=options.timeout_setting||{geo_timeout:9000,maximumAge:900000};if(typeof(navigator.geolocation)!=='undefined'){self.model.set('status','run');try{retrievedCurrentPosition=false;applyTempLocLock=true;navigator.geolocation.getCurrentPosition(success,fail,timeout_setting);window.setTimeout(function(){if(!retrievedCurrentPosition){timeout.call(self);}},9000);}catch(e){fail.call(self);}}else{C.publish('geo-location-detect-unsupport');}}}
GeoDetectCtrl.prototype=new StubHubCore.Controller();this.init=function(){this.m=new C.Model();this.m.status='done';this.v=new C.View(this.m);this.c=new GeoDetectCtrl(this.m,this.v);this.c.init(sandbox);};this.destroy=function(){};}
SH.Modules.GeoDetection=GeoDetection;})(StubHub);(function(SH){SH.Modules.EventControl=SH.Modules.EventControl||function(sandbox){var isOmniRequestFired=false,isOverride=false;var C=sandbox.core,getGVar=sandbox.getGVar;function fireOmniRequest(sw){if(!isOmniRequestFired){var isInteractiveMap=getGVar("map-type")=="Interactive",isMap=getGVar("map-type")!="no-map",state=sandbox.getCurrentState(),eventId="",genreId="",genreDescription="",ps=state&&state.paneSettings,_event=ps&&ps.event,eventInitializerShown=!$('#EventInitializerModule').hasClass('hidden');if(state&&state.type!='event'&&state.f&&state.f=="ui-link-clicked"){if(!isOverride){return;}}
if(_event){var genre=sandbox.getGenreDetailForOmni(ps.channelId,ps.event);genreId=genre.id;genreDescription=genre.desc;if(_event.id){eventId=_event.id;}}
var opts={pageName:"mWeb: Event Details",prop11:"Event details: Scrubbed listing",prop1:"Event details",events:"prodview",prop70:genreId,prop4:genreDescription,products:";"+eventId};if(sw=='list'||!isMap){if(!isInteractiveMap){opts.prop11="Event details: Scrubbed listing";}}else{if(isMap){if(isInteractiveMap){opts.prop11='Event details: Interactive map';opts.prop61='Event details: Interactive map view';opts.prop62='mWeb view';opts.prop63='Event details';}else{opts.prop11='Event details: Static map';}}}
if(eventInitializerShown){opts.prop61='Event details: Filter view';opts.prop62='mWeb: View';opts.prop63='Event details';opts.prop1='Event details';opts.prop4=genreDescription;opts.prop11="Event details: Filter view";}
var duration=StubHubCore.util.getTimeAheadOfEvent(StubHubCore.ls.getEventFromLSById(eventId));if(duration){opts.eVar14=duration;}
sandbox.setOmnitureVariables(opts,true);isOmniRequestFired=true;isOverride=false;}}
function scrollTo(obj){var _top=obj.offset().top;var lastScrollOffset=_top||0;window.scrollTo(0,lastScrollOffset);}
function switchView(sw){var isInteractiveMap=getGVar("map-type")=="Interactive",isMap=getGVar("map-type")!="no-map",state=sandbox.getCurrentState(),formfactor,$promo=$('#pricePromote'),$EventTitleModule=$('#EventTitleModule'),$actionButtonObj=$('#actionButtonPanel');if(state.ui){formfactor=state.ui.formfactor;}
if(isInteractiveMap){$('#eventColumn').addClass('interactive');}else{$('#eventColumn').removeClass('interactive');}
var $switcher=$('#switchToEventList');if(!isMap){$switcher.addClass('hidden');$('#map_label').addClass('hidden');$('#sortByDropdownWrapper').removeClass('hidden');return;}
if(sw=='list'){$('#sortByDropdownWrapper').removeClass('hidden');$switcher.find('.sprite').removeClass('sprite-list_view').addClass('sprite-seatmap');$switcher.removeClass('hidden');$('#icon_text_list, #map_label').addClass('hidden');$('#icon_text_map').removeClass('hidden');if(formfactor<=2){$promo.removeClass("hidden");$EventTitleModule.removeClass("hidden");}}else if(sw=='map'){$('#sortByDropdownWrapper').addClass('hidden');$switcher.find('.sprite').removeClass('sprite-seatmap').addClass('sprite-list_view');$switcher.removeClass('hidden');$('#icon_text_map').addClass('hidden');$('#icon_text_list').removeClass('hidden');if(isInteractiveMap){$('#map_label').removeClass('hidden');if(formfactor<=2){$promo.addClass("hidden");$EventTitleModule.addClass("hidden");scrollTo($actionButtonObj);}}else{$('#map_label').addClass('hidden');if(formfactor<=2){$promo.removeClass("hidden");$EventTitleModule.removeClass("hidden");}}}else{$switcher.addClass('hidden');}
fireOmniRequest.call(this,sw);sandbox.publish("view-rendered");}
function EventControlView(){this.constructor.apply(this,arguments);}
EventControlView.prototype=new StubHubCore.View();EventControlView.prototype.render=function(keys){if(keys){if(keys[0]=='switcher'){var sw=this.model.switcher;isOmniRequestFired=false;switchView(sw);}else if(keys[0]=='pagetype'){this.doViewChanges();}else if(keys[0]=='formfactor'){this.doViewChanges();}}};EventControlView.prototype.doViewChanges=function(){var isMap=getGVar("map-type")!="no-map";var $switcher=$('#switchToEventList');if(this.model.formfactor<=2){if(this.model.pagetype=='section'){$('#sortByDropdownWrapper').removeClass('hidden');if(!this.model.isUnscrubbed){$switcher.addClass('hidden');}}else{if(this.model.pagetype=='event'&&this.model.switcher=='map'){$('#sortByDropdownWrapper').addClass('hidden');}
$switcher.removeClass('hidden');}
$('#actionButtonPanel').removeClass('hidden');$("#FilterModule").addClass('hidden');}else{$switcher.removeClass('hidden');if(this.model.switcher=='list'||this.model.isUnscrubbed){$('#sortByDropdownWrapper').removeClass('hidden');}else{$('#sortByDropdownWrapper').addClass('hidden');}
if(this.model.pagetype=='ticket'){$('#actionButtonPanel').addClass('hidden');$('#eventControlPanel').addClass('hidden');$("#FilterModule").addClass('hidden');}else{$('#actionButtonPanel').removeClass('hidden');$('#eventControlPanel').removeClass('hidden');$("#FilterModule").removeClass('hidden');}}
if(!isMap||this.model.switcher=='both'){$switcher.addClass('hidden');}};EventControlView.prototype.showEventInitializer=function(type){var container=sandbox.getContainer();$('#eventInitializerLoading').removeClass('hidden');if(type=='event'){$(container).find('#EventControlContainer').addClass("hidden");$('#eventColumn').hide();$('#sectionColumn').hide();$('#ticketColumn').hide();$('#eventInitializerLoading').addClass('hidden');if(sandbox.getGVar('exec.showEventInitializer')){if(C.lsModules().indexOf('EventInitializer')===-1){C.register('EventInitializer',SH.Modules.EventInitializer);}
if(C.lsInstances().indexOf('EventInitializer')===-1){C.start('EventInitializer');}
$(container).find('#EventInitializerModule').removeClass("hidden");sandbox.setGVar("eventInitlizerDisplay",true);}
else{proceedToNormalFlow();}}
else{proceedToNormalFlow();}}
function proceedToNormalFlow(){$('#eventInitializerLoading').addClass('hidden');$('#EventInitializerModule').addClass("hidden");$('#EventControlContainer').removeClass("hidden");$('#eventColumn').css('display','');$('#sectionColumn').css('display','');$('#ticketColumn').css('display','');$('#eventPane').find('.ui-column-active').show();}
function EventControlController(){this.constructor.apply(this,arguments);this.distroy=function(){unbindGlobalEvents();};this.init=function(){if(C.lsModules().indexOf('EventFilter')===-1){C.register('EventFilter',SH.Modules.EventFilter);}
if(C.lsInstances().indexOf('EventFilter')===-1){C.start('EventFilter');}
bindGlobalEvents.call(this);var container=sandbox.getContainer();if(this.view){if(container){this.view.container=container;}
if(typeof bindViewEvents=='function'){bindViewEvents.call(this);}}
this.model.change(function(keys){if(keys){if(keys[0]=='switcher'){var sw=this.model.switcher;C.publish('eventcontrol.switcher.type',sw);}}},this);if(typeof sandbox.getCurrentState=='function'){var state=sandbox.getCurrentState();if(state&&state.type&&state.url){getDataFromURLState.call(this,{state:state});}}};function bindViewEvents(){var _container=this.view?this.view.container:null,self=this;if(_container){var $container=$(_container);$container.find('.switch-control-icon').bind('click.fast',function(e){e.preventDefault();e.stopPropagation();var $sprite=$(this).find('.sprite'),sw;if($sprite.hasClass('sprite-filter_icon')){var $filtermodule=$("#FilterModule");if($filtermodule.hasClass('hidden')){$filtermodule.removeClass('hidden');}else{$filtermodule.addClass('hidden');}
sandbox.publish("view-rendered");}else{if($sprite.hasClass('sprite-list_view')){sw='list';}else if($sprite.hasClass('sprite-seatmap')){sw='map';}else{return;}
if(sw!=self.model.switcher){isOverride=true;self.model.set('switcher',sw);}}});}}
function bindGlobalEvents(){var self=this;C.subscribe('ui-formfactor-changed',handleFormFactorChange,self);C.subscribe('url.update.state',getDataFromURLState,self);C.subscribe('map-type',function(type){var state=sandbox.getCurrentState(),formfactor;if(sandbox.getGVar('exec.showEventInitializer')){this.view.showEventInitializer((state&&state.type));this.view.doViewChanges();return;}
if(state.ui){formfactor=state.ui.formfactor;}else if(sandbox.options.ui){formfactor=sandbox.options.ui.formfactor;}
var showlist=(type!='Interactive'),showMap=sandbox.getGVar('exec.showmap');if(formfactor>=3&&!showlist){this.model.set('switcher','both');return;}
if(!showlist){showlist=sandbox.getGVar('exec.showlistfirst')||showlist;}
if(showMap){this.model.set('switcher','map');}else{this.model.switcher=null;this.model.set('switcher','list');}
this.view.doViewChanges();},self);C.subscribe('eventcontrol.switcher.type.set',function(data){var state=sandbox.getCurrentState(),formfactor;if(state.ui){formfactor=state.ui.formfactor;}else if(sandbox.options.ui){formfactor=sandbox.options.ui.formfactor;}
if(!data){if(formfactor&&formfactor<=2){this.model.set('switcher','list');}}else if(this.model.switcher!=data){var maptype=data;if(data.type&&data.type=='interactive'){maptype=(getGVar("map-type")=="Interactive")?data.switchView:'list';}
this.model.set('switcher',maptype);}},self);}
function unbindGlobalEvents(){C.unsubscribe('ui-formfactor-changed',handleFormFactorChange);C.unsubscribe('url.update.state',getDataFromURLState);C.unsubscribe('eventcontrol.switcher.type.set');C.unsubscribe('map-type');}
function handleFormFactorChange(data){this.model.set('formfactor',data);}
function getDataFromURLState(data){var state=data.state,type=state&&state.type,ps=state.paneSettings,evt=ps.event,container=$(this.view.container),formfactor;var $promo=$('#pricePromote');var allUnscrubbed=!(state&&state.paneSettings&&state.paneSettings.event&&state.paneSettings.event.isScrubbed);if(state.ui){formfactor=state.ui.formfactor;}else if(sandbox.options.ui){formfactor=sandbox.options.ui.formfactor;}
if(formfactor){this.model.set('formfactor',formfactor,true);}
if($("#MAP-details").hasClass("hidden")){isOmniRequestFired=false;}
this.model.set('isUnscrubbed',allUnscrubbed,true);if(formfactor<=2&&!allUnscrubbed&&evt.venue_config_map_type==5&&evt.totalPostings>=10){this.view.showEventInitializer(type);}else{$('#EventInitializerModule').addClass("hidden");$('#EventControlModule').removeClass("hidden");}
if(type=='ticket'&&container!=null){container.addClass("hide-me");this.model.set('pagetype','ticket');}else{container.removeClass("hide-me");var sw=this.model.switcher;if(!this.model.switcher&&(type=='event'&&formfactor<=2&&evt.totalPostings<=10)){sw='list';}
if(sw){this.model.set('switcher',sw);}
this.view.doViewChanges();if(type=='event'){this.model.set('pagetype','event');if(formfactor>2){$promo.insertBefore('#EVT-msg');}else{$promo.insertBefore('#eventControlPanel');}
$promo.removeClass('hidden');}else if(type=='section'){this.model.set('pagetype','section');if(formfactor>2){$promo.insertBefore('#SectionViewSwitch');}else{$promo.insertBefore('#eventControlPanel');}
$promo.removeClass('hidden');}else{$promo.addClass('hidden');}}
if(type=='ticket'||type=='section'||type=='event'){try{var eId=state.paneSettings.event.id;var ev=sandbox.getEventFromLSById(eId);if(ev&&ev.bundled_type=='2'&&getGVar('exec.isUS')){$promo.removeClass('hidden');}else{$promo.addClass('hidden');}}catch(e){$promo.addClass('hidden');}}}}
EventControlController.prototype=new StubHubCore.Controller();this.init=function(){this.m=new StubHubCore.Model();this.v=new EventControlView(this.m);this.c=new EventControlController(this.m,this.v);this.c.init(sandbox);};this.destroy=function(){};};})(StubHub);(function(SH){SH.Modules.EventInitializer=SH.Modules.EventInitializer||function EventInitializer(sandbox){var C=sandbox.core,subscribe=C.subscribe,publish=C.publish;function EventInitializerView(){this.constructor.apply(this,arguments);}
EventInitializerView.prototype=new StubHubCore.View();function EventInitializerController(){this.constructor.apply(this,arguments);this.init=function(){var container=("#EventInitializerModule");this.view.container=container;this.model.change(function(keys){if(keys&&keys[0]){var k=keys[0],m=this.model,v=m[keys[0]];switch(k){case'genreId':var $container=$(this.view.container),$quantity=$container.find('#eiquantity'),$minP=$container.find('#eifromPriceTxt'),$maxP=$container.find('#eitoPriceTxt');$minP.attr('placeholder','').val('');$maxP.attr('placeholder','').val('');$quantity.val('');var existingFilters=getExistingFilter(v);if(existingFilters){if(existingFilters.price){$minP.val((existingFilters.price.min)?existingFilters.price.min:'');$maxP.val((existingFilters.price.max)?existingFilters.price.max:'');}
$quantity.val((existingFilters.quantity)?existingFilters.quantity:'');}
break;case'price':case'quantity':var pfx='filter.'+m.genreId;sandbox.setGVar(pfx+'.'+k,m[k]);broadcast.call(this,k);break;}}},this);var state=sandbox.getCurrentState();getDataFromURLState.call(this,{state:state});bindViewEvents.call(this);bindGlobalEvents.call(this);};function broadcast(lastchange){publish('event-initializer-change',{lastchange:lastchange,filter:getExistingFilter(this.model.genreId)});}
function bindGlobalEvents(){subscribe('url.update.state',getDataFromURLState,this);subscribe('eventfilter.price.label.values',function(v){var $minP=$(this.view.container).find('#eifromPriceTxt'),$maxP=$(this.view.container).find('#eitoPriceTxt');if(v==null)
return;var min=v&&v.min,i=min?1:0,max=v&&v.max,j=max?1:0;min=Math.floor(min);max=Math.ceil(max);$minP.attr('placeholder',min);$maxP.attr('placeholder',max);},this);}
function bindViewEvents(){var self=this;var $container=$('#EventIntializerContainer');var isIOS6=sandbox.getGVar('exec.isIOS6'),isIPad=sandbox.getGVar('exec.isIPad');var $is=$('#eifromPriceTxt, #eitoPriceTxt');$is.bind('keypress',function(e){var kc=e.keyCode||e.charCode;if((48<=kc&&kc<=57)){}else{if(e.keyCode==13){$container.find('#eisubmitForm').trigger('click');this.blur();}else{e.preventDefault();}}});$('#quantity_filter_container').bind('click.fast',function(e){$(this).find('select')[0].focus();});$container.find('#eisubmitForm').bind('click',function(){var $minP=$container.find('#eifromPriceTxt'),$maxP=$container.find('#eitoPriceTxt'),$quantity=$container.find('#eiquantity'),minP=$minP.val(),maxP=$maxP.val(),p={},quantity=$quantity.val(),filtersApplied=false,propdata='Go button';if(minP&&isNumeric(minP)){p.min=parseInt(minP,10);}else{$minP.val('');}
if(maxP&&isNumeric(maxP)){p.max=parseInt(maxP,10);}else{$maxP.val('');}
if(p.min&&p.max){if(p.min>p.max){var m=p.min;p.min=p.max;p.max=m;}
propdata+=': price range';self.model.set('price',p);filtersApplied=true;}else if(p.min||p.max){propdata+=': '+((p.min)?'min price':'')+((p.max)?'max price':'');self.model.set('price',p);filtersApplied=true;}else{self.model.set('price',null);}
if(quantity!=''){propdata+=': '+'quantity';self.model.set('quantity',quantity);filtersApplied=true;}
fireOmniRequest(propdata);$('#EventInitializerModule').addClass("hidden");$('#eventPane').find('#EventControlContainer').removeClass("hidden");$('#eventPane').find('.ui-column-active').show();sandbox.core.publish('view-rendered','EventInitializerModule');if(filtersApplied){sandbox.core.publish('eventcontrol.switcher.type.set',{switchView:'map',type:'interactive'});sandbox.core.publish('event.seatmap.position.top');}else{sandbox.core.publish('eventcontrol.switcher.type.set');}
sandbox.core.publish('eventcontrol.fire.omnirequest',propdata);C.publish("ui-link-clicked",{target:'event',targetId:targetId,href:href,paneSettings:ps,data:relevantDataForTarget,prefix:prefix});});}
function getExistingFilter(gId){return sandbox.getGVar('filter.'+gId);}
function isNumeric(input){var RE=/^-{0,1}\d*\.{0,1}\d+$/;return(RE.test(input)&&input.length>0);}
function getDataFromURLState(data){if(data&&data.state){var state=data.state,t=state.type,ps=state.paneSettings;if(t=='event'||t=='section'||t=='ticket'){this.model.set('page',t);var agids=ps.event.ancestorGenreIds;if(!agids){agids=sandbox.getEventFromLSById(ps.event.id);agids=agids&&agids.ancestorGenreIds;}
var gId=agids&&agids.split(' ').pop();this.model.genreId=null;this.model.set('genreId',gId);}}}
function fireOmniRequest(propdata){var state=sandbox.getCurrentState(),eventId="",genreId="",genreDescription="",ps=state&&state.paneSettings,_event=ps&&ps.event;if(_event){var genre=sandbox.getGenreDetailForOmni(ps.channelId,ps.event);genreId=genre.id;genreDescription=genre.desc;if(_event.id){eventId=_event.id;}}
var opts={prop61:'Event details: Filter view: ',prop62:'mWeb: View',prop63:'Event details',prop1:'Filter view',prop4:genreDescription};opts.prop61+=' '+propdata;console.log("Event Initializer, omniture tracking",opts);sandbox.trackInOmnitureVars(opts);}
this.destroy=function(){};}
EventInitializerController.prototype=new StubHubCore.Controller();this.init=function(){this.m=new StubHubCore.Model();this.v=new EventInitializerView(this.m);this.c=new EventInitializerController(this.m,this.v);this.c.init();};this.destroy=function(){if(this.c&&typeof this.c.destroy=='function'){this.c.destroy();}};};})(StubHub);(function(SH){SH.Modules.Starred=SH.Modules.Starred||function Starred(sandbox){var C=sandbox.core;var EL=SH.Modules.EventList,GL=SH.Modules.GenreList,TAB=SH.Modules.Tab;var events_opts={prefix:'starred_events',parentName:'Starred',container:'starred_events_list'},sports_opts={prefix:'starred_sports',parent:'Starred',container:'starred_sports_list',enableStar:true},concerts_opts={prefix:'starred_concerts',parent:'Starred',container:'starred_concerts_list',enableStar:true},theater_opts={prefix:'starred_theater',parent:'Starred',container:'starred_theater_list',enableStar:true},tabs_opts={prefix:'starred',parent:'Starred',tabs:'#starred_header',contents:'#starred_results',defaultTab:0};function triggerOmniture(i){var val="Starred Event",pageName="mWeb: "+val,opts={pageName:pageName,prop1:"Starred",prop11:"Starred: Event",prop61:"tab touch: Genre: "+pageName,prop62:"tab touch",prop63:pageName};if(i==1){val="Starred Genre";opts.pageName=opts.prop63=pageName="mWeb: "+val;opts.prop11="Starred: Genre";opts.prop61="tab touch: Genre: "+pageName;}
sandbox.trackInOmnitureVars(opts);}
function StarredView(){this.constructor.apply(this,arguments);var $sports_count=$('#starred_count_sports'),$concerts_count=$('#starred_count_concerts'),$theater_count=$('#starred_count_theater');this.render=function(keys){var publishRender=false;console.log("*Starred*  in View render()     keys:",keys);if(keys){switch(keys[0]){case"events":break;case"sports":var sl=0;if(this.model.sports&&this.model.sports.constructor==Array){sl=this.model.sports.length;}
$sports_count.text(sl);if(sl===0){$('#starred_sports_header').find('.genre_toggle').removeClass('sprite');$('#starred_sports_list').addClass('hidden');}else{$('#starred_sports_header').find('.genre_toggle').addClass('sprite');$('#starred_sports_list').removeClass('hidden');}
break;case'concerts':var cl=0;if(this.model.concerts&&this.model.concerts.constructor==Array){cl=this.model.concerts.length;}
$concerts_count.text(cl);if(cl===0){$('#starred_concerts_header').find('.genre_toggle').removeClass('sprite');$('#starred_concerts_list').addClass('hidden');}else{$('#starred_concerts_header').find('.genre_toggle').addClass('sprite');$('#starred_concerts_list').removeClass('hidden');}
break;case'theater':var tl=0;if(this.model.theater&&this.model.theater.constructor==Array){tl=this.model.theater.length;}
$theater_count.text(tl);if(tl===0){$('#starred_theater_header').find('.genre_toggle').removeClass('sprite');$('#starred_theater_list').addClass('hidden');}else{$('#starred_theater_header').find('.genre_toggle').addClass('sprite');$('#starred_theater_list').removeClass('hidden');}
break;}}
if(publishRender){sandbox.publish("view-rendered","Starred");}};}
StarredView.prototype=new C.View();function StarredController(){this.constructor.apply(this,arguments);this.onStarredPane=false;this.needUpdate=true;this.updateEventsOnce=true;this.init=function(sandbox){this.sandbox=sandbox;C.register('StarredEventList',EL,events_opts);C.register('StarredGenreListSports',GL,sports_opts);C.register('StarredGenreListConcert',GL,concerts_opts);C.register('StarredGenreListTheater',GL,theater_opts);C.register('StarredTab',TAB,tabs_opts);if(typeof bindGlobalEvents=='function'){bindGlobalEvents.call(this,this.sandbox);}
var container=sandbox.getContainer();if(this.view){if(container){this.view.container=container;}
if(typeof bindViewEvents=='function'){bindViewEvents.call(this,this.sandbox);}}
$(container).removeClass('hidden');C.start('StarredEventList');C.start('StarredGenreListSports');C.start('StarredGenreListConcert');C.start('StarredGenreListTheater');C.start('StarredTab');var self=this;this.model.change(function(keys){console.log('*Starred*  in Controller init method, moniter model change ',keys,this.model);if(keys){var m=this.model;switch(keys[0]){case"events":C.publish('starred_events-eventdata',m.events);break;case"sports":case'concerts':case'theater':var r=m[keys[0]];if(r&&r.constructor==Array&&r.length>0){C.publish('starred_'+keys[0]+'-genredata',m[keys[0]]);}else{C.publish('starred_'+keys[0]+'-genredata');}
break;}}},self);if(typeof sandbox.getCurrentState=='function'){var state=sandbox.getCurrentState();if(state&&state.type){getDataFromURLState.call(self,{state:state});}}};this.destroy=function(){unbindGlobalEvents.call(this,this.sandbox);if(this.view){unbindViewEvents.call(this,this.sandbox);}
C.stop('StarredEventList');C.stop('StarredGenreListSports');C.stop('StarredGenreListConcert');C.stop('StarredGenreListTheater');C.unregister('StarredEventList');C.unregister('StarredGenreListSports');C.unregister('StarredGenreListConcert');C.unregister('StarredGenreListTheater');};function updateGenres(){this.model.set('sports',getGenresByIds(sandbox.getStarredGenreIds('sports')));this.model.set('concerts',getGenresByIds(sandbox.getStarredGenreIds('concerts')));this.model.set('theater',getGenresByIds(sandbox.getStarredGenreIds('theater')));}
function updateEvents(){var ids=sandbox.getStarredEventIds();if(!ids||ids.length===0){this.model.set('events',[]);return;}
var cachedEvent=getEventsByIds(ids);this.model.set('events',cachedEvent);if(this.updateEventsOnce){var self=this;syncEvents(ids,function(docs){self.model.set('events',docs);self.updateEventsOnce=false;for(var i=0,m=docs.length;i<m;i++){var _doc=docs[i];sandbox.cacheEventToLS(_doc);}});}}
function _sortEvent(a,b){if(a.event_date_time_local<b.event_date_time_local){return-1;}else if(a.event_date_time_local==b.event_date_time_local){return 0;}else{return 1;}}
function _sortGenre(a,b){var ad=sandbox.getGenreDescription(a),bd=sandbox.getGenreDescription(b);if(ad<bd){return-1;}else if(ad==bd){return 0;}else{return 1;}}
function getGenresByIds(ids){console.log("getGenresByIds ",ids);if(!ids){return[];}
var ret=[];for(var i=0,m=ids.length;i<m;i++){var d=sandbox.getGenreFromLSById(ids[i]);if(d){ret.push(d);}}
ret.sort(_sortGenre);return ret;}
function getEventsByIds(ids){if(!ids){return;}
var ret=[];for(var i=0,m=ids.length;i<m;i++){var d=sandbox.getEventFromLSById(ids[i]);if(d){if(!sandbox.checkEventExpire(d)){ret.push(d);}}}
ret.sort(_sortEvent);return ret;}
function bindViewEvents(){var _container=this.view?this.view.container:null;if(_container){var $container=$(_container);$container.find('.genre_section_title').bind('click.fast',function(){var $this=$(this),$toggle=$this.find('.genre_toggle');if(!$toggle.hasClass('sprite')){return;}
var $list=$(this.nextSibling);if($toggle.hasClass('sprite-plus_sign')){$toggle.removeClass('sprite-plus_sign').addClass('sprite-minus_sign');$list.removeClass('hidden');}else if($toggle.hasClass('sprite-minus_sign')){$toggle.removeClass('sprite-minus_sign').addClass('sprite-plus_sign');$list.addClass('hidden');}});}}
function unbindViewEvents(){var _container=this.view?this.view.container:null;if(_container){var $container=$(_container);$container.find('.genre_section_title').unbind('click.fast');}}
function bindGlobalEvents(){var self=this;C.subscribe('gvar.starred.event',handleStarredEvents,self);C.subscribe('gvar.starred.genre',handleStarredGenres,self);C.subscribe('url.update.state',getDataFromURLState,self);C.subscribe('starred-tab-selected',function(i){triggerOmniture(i);},self);}
function unbindGlobalEvents(){C.unsubscribe('gvar.starred.event',handleStarredEvents);C.unsubscribe('gvar.starred.genre',handleStarredGenres);C.unsubscribe('url.update.state',getDataFromURLState);C.unsubscribe('starred-tab-selected');}
function handleStarredEvents(){console.log('*Starred*  in Controller handleStarredEvents');this.needUpdate=true;}
function handleStarredGenres(){console.log('*Starred*  in Controller handleStarredGenres');this.needUpdate=true;}
function getDataFromURLState(data){console.log('*Starred*  in Controller getDataFromURLState',data);var state=data.state,type=state.type;this.onStarredPane=(type=='starred');if(this.onStarredPane){triggerOmniture();}
console.log('*Starred*  in Controller getDataFromURLState, this is starred page',this.onStarredPane,this.needUpdate);if(this.onStarredPane&&this.needUpdate){updateGenres.call(this);updateEvents.call(this);this.needUpdate=false;}}
function syncEvents(eids,callback){var self=this;var ids=eids.join(' ');var url=sandbox.getGVar('site.lcsService'),avd=sandbox.getGVar('exec.lcsquery.event.allowedViewingDomain'),fl='&fl='+sandbox.getGVar('exec.lcsquery.event.minfl')+' minPrice currency_code';var qs="q=stubhubDocumentType:event%20AND%20active:1%20AND%20id:("+ids+")"+avd+fl+"&start=0&wt=json&sort=event_date_time_local%20asc&json.wrf=?";sandbox.getJSON(url,qs,function(data){var resp=data.response,docs=resp.docs;if(typeof callback=='function'){callback.call(self,docs);}});}}
StarredController.prototype=new C.Controller();this.init=function(){this.m=new C.Model();this.v=new StarredView(this.m);this.c=new StarredController(this.m,this.v);this.c.init(sandbox);};this.destroy=function(){if(this.c&&typeof this.c.destroy=='function'){this.c.destroy(sandbox);}
this.c=this.v=this.m=null;$(sandbox.getContainer()).addClass('hidden');};};})(StubHub);(function(SH){SH.Modules.EventMap=SH.Modules.EventMap||function(sandbox){var container,opt,$map,mapReadyCallback,formfactor;var C=sandbox.core;var isOmniRequestFired=false;C.exec.maxSelection=C.exec.maxSelection||10;function getZoomLevel(){formfactor=formfactor||(opt&&opt.ui&&opt.ui.formfactor);var zoomLevel=(formfactor<=2)?3:5;return zoomLevel;}
function scrollTo(obj){formfactor=formfactor||(opt&&opt.ui&&opt.ui.formfactor);if(formfactor>2){return;}
var _top=obj.offset().top;var lastScrollOffset=_top||0;window.scrollTo(0,lastScrollOffset);}
function setUIPaneHeight(){sandbox.publish('view-rendered','Event Map');}
function getSectionImageTemplate(id,src){return'<img class="sectionview" id="sectionview-'+id+'" src="'+src+'" onerror="$(this).remove();"></img>';}
function EventMapModel(){this.constructor.apply(this,arguments);}
EventMapModel.prototype=new StubHubCore.Model();function EventMapView(){this.constructor.apply(this,arguments);this.render=function(keys){if(keys){if(keys[0]=='mapColored'){if(this.model.mapColored&&mapReadyCallback&&typeof mapReadyCallback=='function'){mapReadyCallback.call();mapReadyCallback=null;}}else if(keys[0]=='type'){var v=this.model.type;if(v==='Interactive'){$('#MAP-bar').removeClass('hidden');}else{$('#MAP-bar').addClass('hidden');}}}};}
EventMapView.prototype=new StubHubCore.View();function EventMapController(){this.constructor.apply(this,arguments);this.model.change(function(keys){if(keys&&keys[0]=='sectiondata'){var sectiondata=this.model.sectiondata;if(sectiondata&&sectiondata.section){var map={};sandbox.toArray(sectiondata.section).forEach(function(sec){map[sec.sectionId+""]=sec;});this.sectionMap=map;}else{this.sectionMap=null;}}
else if(keys&&keys[0]=='selectbyzone'){$map.blueprint.enableSelectSectionsByZone(this.model.selectbyzone);}},this);}
EventMapController.prototype=new StubHubCore.Controller();EventMapController.prototype.bindGlobalEvents=function(){C.subscribe('reset.seatmap',this.resetMap,this);C.subscribe('url.update.state',this.getDataFromURLState,this);C.subscribe('event.seatmap.sectiondata',function(data){this.model.set('sectiondata',data);},this);C.subscribe('event.seatmap.refresh',this.refreshMap,this);C.subscribe('event.seatmap.loading',this.loadingMap,this);C.subscribe('event.seatmap.selectSectionsByZone',function(flag){$map.blueprint.enableSelectSectionsByZone(flag);});C.subscribe('event.seatmap.multiSelectSection',function(flag){$map.blueprint.multiSelectSection(flag);});C.subscribe('event.seatmap.position.top',function(){$map.blueprint.positionMap('top',true);});C.subscribe('ui-panedimension-complete',function(){if($("#EventMapModule").css("display")==='block'){$("#pricePromote").addClass('hidden');$('#EventTitleModule').addClass("hidden");}});};EventMapController.prototype.unbindGlobalEvents=function(){C.unsubscribe('reset.seatmap');C.unsubscribe('url.update.state',this.getDataFromURLState);C.unsubscribe('event.seatmap.sectiondata');C.unsubscribe('event.seatmap.refresh');C.unsubscribe('event.seatmap.loading');C.unsubscribe('ui-panedimension-complete');};EventMapController.prototype.bindViewEvents=function(){var self=this;var propdata='',selectedZonesOrSections=[];if($map){$map.parent().find('.MAP-link').bind('click.fast',function(){if(self.model.selectbyzone){selectedZonesOrSections=self.getSelectedZones();propdata='View ticket listings: Zone: '+selectedZonesOrSections.length;}else{selectedZonesOrSections=self.getSelectedSectionData();propdata='View ticket listings: Section: '+selectedZonesOrSections.length;}
self.fireOmniRequest(propdata);C.publish('event.seatmap.selected_sections',{selectbyzone:self.model.selectbyzone,sections:self.getSelectedSectionData()});});$map.parent().find('.mapctrl_item').bind('click.fast',function(){var $this=$(this),id=$this.attr('id');if(id=='selectbyBox'){var $zone=$this.find('.zone'),$section=$this.find('.section'),sections=$map.blueprint.getSelectedSections();if($zone.hasClass('on')){$zone.removeClass('on');$section.addClass('on');if(sections&&sections.length>10){self.model.set('persistMapCtrl',true);$map.blueprint.blurSections(sections);$map.blueprint.positionMap('top',true);}
self.model.set('selectbyzone',false);propdata='Switch to section view';}else{$zone.addClass('on');$section.removeClass('on');self.model.set('selectbyzone',true);propdata='Switch to zone view';for(var s=0;s<sections.length;s++){$map.blueprint.focusZoneBySection(sections[s]);}
if(formfactor<=2){self.updateMapSection.call(self);}else{C.publish('event.seatmap.selected_sections',{selectbyzone:self.model.selectbyzone,sections:self.getSelectedSectionData()});}}}else if(id=='mapreset'){$map.blueprint.blurSections($map.blueprint.getSelectedSections());$map.blueprint.positionMap('top',true);propdata='Reset Map';$("#MAP-details").removeClass('background-grey');}
self.fireOmniRequest(propdata);});}};EventMapController.prototype.fireOmniRequest=function(propdata){var state=sandbox.getCurrentState(),eventId="",genreId="",genreDescription="",ps=state&&state.paneSettings,_event=ps&&ps.event;if(_event){var genre=sandbox.getGenreDetailForOmni(ps.channelId,ps.event);genreId=genre.id;genreDescription=genre.desc;}
var opts={prop61:'Event details: Interactive Map: ',prop62:'mWeb: View',prop63:'Event details',prop1:'Filter view',prop4:genreDescription};opts.prop61+=' '+propdata;sandbox.trackInOmnitureVars(opts);};EventMapController.prototype.resetMap=function(){var formfactor=opt&&opt.ui&&opt.ui.formfactor;if(typeof formfactor!="undefined"&&formfactor<=2){$map.blueprint.blurSections($map.blueprint.getSelectedSections());$map.blueprint.positionMap('top',true);}};EventMapController.prototype.getDataFromURLState=function(data){var state=data.state,formfactor=state.ui&&state.ui.formfactor,type=state&&state.type;this.model.set('pageType',type,true);if(type!='event'&&type!='section'&&type!='ticket'){if(this.model.sectiondata&&this.model.type=='Interactive'){$map.blueprint.resetMap();if(typeof formfactor!="undefined"&&formfactor<=2){$('#MAP-sectionInfo').addClass('hidden');$('#MAP-info').removeClass('hidden');$('#MAP-details').removeClass('hidden');$("#MAP-details").removeClass('background-grey');}}}else if(type==='event'||type==='section'){var self=this,ps=state.paneSettings;if(self.model&&self.model.eventId&&ps&&ps.event&&ps.event.id&&self.model.eventId==ps.event.id){var $selectedSection=$map.blueprint.getSelectedSections();if(data.direction=='back'){if(type=='event'){var sss=[].concat($selectedSection);if(typeof formfactor!="undefined"&&formfactor>2){$map.blueprint.blurSections(sss);$map.blueprint.positionMap('top',true);}else{var actionButtonObj=$('#actionButtonPanel');window.setTimeout(function(){setUIPaneHeight();scrollTo(actionButtonObj);},500);}}else if(type=='section'){}}else{if(type=='section'){if($map.blueprint.isMapReady()){if(ps.section.id){var sss2=[].concat($selectedSection);$map.blueprint.blurSections(sss2,false)
$map.blueprint.focusSections(ps.section.id.split(','),false);self.updateMapSection.call(self);}}}else if(type=='event'){var sids=$selectedSection,slength=sids.length;if(slength===0){$('#MAP-sectionInfo').addClass('hidden');$('#MAP-info').removeClass('hidden');$('#MAP-details').removeClass('hidden');if(!self.model.persistMapCtrl){$('#mapctrl').addClass('hidden');self.model.persistMapCtrl=false;}
$("#MAP-details").removeClass('background-grey');}
$map.blueprint.positionMap('top',true);}}
return;}
this.destroyMap();this.model.set('mapColored',false);var section=ps.section,zones=section&&section.zones;if(section&&(section.id||(zones&&zones.id))){mapReadyCallback=function(){if(section.id){$map.blueprint.focusSections(section.id.split(','));}else if(zones&&zones.id){var _zones=zones.id.split(','),_sections;for(var z=0;z<_zones.length;z++){_sections=$map.blueprint.getSectionsByZone(_zones[z]);$map.blueprint.focusSections(_sections,false);}}};}
self.model.set('eventId',ps.event.id+"",true);var _event=sandbox.getEventFromLSById(ps.event.id);self.model.set('sectiondata',null,true);self.model.set('event',_event);}};EventMapController.prototype.loadingMap=function(data){if(data){$('#mapmask').removeClass('hidden');}else{$('#mapmask').addClass('hidden');}};EventMapController.prototype.refreshMap=function(){if(this.model){var sss;if(this.model.type=='Interactive'){sss=$map.blueprint.getSelectedSections();}
if(sss&&sss.length>0){$map.blueprint.zoomMap(getZoomLevel());$map.blueprint.positionMap('top');$map.blueprint.centerSection(sss[0],false,true,false);}else{if($map.blueprint.isMapStatic()){$map.blueprint.zoomMap(3);}
$map.blueprint.positionMap('top');}}};EventMapController.prototype.updateMapSection=function(){var self=this;if(!self.model.sectiondata){return;}
var formfactor=opt&&opt.ui&&opt.ui.formfactor,$imageBox=$("#MAP-imagebox"),$sectionInfo=$('#MAP-sectionInfo'),$mapDetails=$('#MAP-details'),$mapCtrl=$('#mapctrl'),$mapInfo=$('#MAP-info');var sids=$map.blueprint.getSelectedSections(),slength=sids.length,d=sandbox.toArray(self.model.sectiondata.section),minPrice,totalTix=0;var mapParent=$map.parent(),sectiondata=self.model.sectiondata,imgUrl=sectiondata.smallViewFromSectionUrl,hasImage=(sectiondata.isViewFromSectionEnabled),showImage=imgUrl&&hasImage,imgStrs=[];if(slength===0){$sectionInfo.addClass('hidden');$mapInfo.removeClass('hidden');$mapDetails.removeClass('hidden');if(!self.model.persistMapCtrl){$mapCtrl.addClass('hidden');self.model.persistMapCtrl=false;}
$("#MAP-details").removeClass('background-grey');}else{var section;for(var i=slength-1;i>=0;i--){var sid=sids[i];section=self.sectionMap?self.sectionMap[sid+""]:d.SH_getElem("sectionId",sid);if(showImage){var _imgUrl=imgUrl.replace(/cache[0-9]*.stubhubstatic.com/,sandbox.getImageUrl(sid));imgStrs.push(getSectionImageTemplate(sid,'//'+_imgUrl+'/'+sid+'.jpg'));}
if(!section){continue;}
minPrice=Math.min(minPrice,section.minTicketPrice)||section.minTicketPrice;totalTix+=parseInt(section.totalTickets,10)||0;}
mapParent.find("#MAP-SectionName").html(C.util.getConditionMsg('section_selcted',[slength=="1"?"1":"2"],[slength]));if(minPrice>0){mapParent.find("#MAP-CurrPrice").html(sandbox.displayPrice(minPrice,self.model.sectiondata.currencyCode));mapParent.find("#MAP-Currency").html(self.model.sectiondata.currencyCode);mapParent.find('.price').removeClass('hidden');}else{mapParent.find('.price').addClass('hidden');}
if(showImage){$imageBox.removeClass('hidden');}
if(formfactor<=2){$imageBox.html(imgStrs.slice(0,2).join());$sectionInfo.removeClass('hidden');$mapInfo.addClass('hidden');$mapDetails.removeClass('hidden');$mapDetails.addClass('background-grey');}else{$mapDetails.addClass('hidden');$sectionInfo.addClass('hidden');$mapInfo.addClass('hidden');$mapDetails.removeClass('background-grey');}
$mapCtrl.removeClass('hidden');}
var actionButtonObj=$('#actionButtonPanel');setUIPaneHeight();scrollTo(actionButtonObj);};EventMapController.prototype.updateMap=function(event){var self=this;var formfactor=opt&&opt.ui&&opt.ui.formfactor;var token=sandbox.getGVar('exec.env')=='prod'?'PerOewmb9jUZUixS_7bEsvflZHka':'eTSFEiwfiCZSeJCqfkHiZhioVPEa';var server=StubHubCore.exec.server||'srwd21';var zoomLevel=getZoomLevel();var mapT=(typeof window.Raphael!==undefined&&window.Raphael&&(window.Raphael.svg||window.Raphael.vml))?'Interactive':'Static';this.loadingMap(true);$map.blueprint({nodeId:event.geography_parent,configId:event.venue_config_id,token:opt.token||token,server:server,env:sandbox.getGVar('exec.env'),useStubHubColors:true,autoFetchMetaData:true,multiSelectSection:true,selectSectionsByZone:false,version:event.venue_configuration_version,metadataUrl:sandbox.getGVar('exec.apiDomain')+"/catalog/venues/v2/{{nodeId}}/venueconfig/{{configId}}/metadata?maptype=2d",initialZoom:zoomLevel,initialPosition:'top',onSectionFocus:opt.onSectionFocus||function(sid){var isEventColumnActive=$("#eventColumn").hasClass("ui-column-active"),sss=$map.blueprint.getSelectedSections();if(self.model.selectbyzone){var zzz=self.getSelectedZones();}
if(!self.model.selectbyzone&&C.exec.maxSelection&&sss&&sss.length>C.exec.maxSelection){var toBlur=sss.slice(C.exec.maxSelection);$map.blueprint.blurSections(toBlur);}else if(self.model.selectbyzone&&C.exec.maxSelection&&zzz&&zzz.length>C.exec.maxSelection){var zoneToBlur=$map.blueprint.getZoneBySection(sid);var sectionsToBlur=$map.blueprint.getSectionsByZone(zoneToBlur);$map.blueprint.blurSections(sectionsToBlur);}else{var selectedSection=self.getSelectedSectionData();if(self.model.selectbyzone){$map.blueprint.enableSelectSectionsByZone(true);for(var s=0;s<sss.length;s++){$map.blueprint.focusZoneBySection(sss[s]);selectedSection=self.getSelectedSectionData();}}
if(!isOmniRequestFired){self.fireOmniRequest('Selected section');isOmniRequestFired=true;}
if(typeof formfactor!="undefined"&&formfactor>2){C.publish('event.seatmap.selected_sections',{selectbyzone:self.model.selectbyzone,sections:selectedSection});if(isEventColumnActive){}}
self.updateMapSection.call(self,event);}},onSectionBlur:opt.onSectionBlur||function(s){var selectedSection=self.getSelectedSectionData();if(typeof formfactor!="undefined"&&formfactor<=2){sandbox.publish("view-rendered");}else{C.publish('event.seatmap.selected_sections',{selectbyzone:self.model.selectbyzone,sections:selectedSection});}
if(!selectedSection||selectedSection.length===0){$map.blueprint.zoomMap(zoomLevel);$map.blueprint.positionMap('top');}
self.updateMapSection.call(self,event);},onMapReady:function(status){isOmniRequestFired=false;var mapType='Interactive';if($map.blueprint.isMapStatic()){mapType='Static';}else{$("pricePromote").hide();function selectByZone(){if(sandbox.getGVar('exec.selectbyzone')){self.model.set('selectbyzone',true);$('#mapctrl').find(".zone").addClass('on');$('#mapctrl').find(".section").removeClass('on');}else{self.model.set('selectbyzone',false);$('#mapctrl').find(".section").addClass('on');$('#mapctrl').find(".zone").removeClass('on');}}
var isIPad=sandbox.getGVar('exec.isIPad');if(isIPad){sandbox.pollProperty(StubHubCore.exec,"selectbyzone",function(){selectByZone();},function(){self.model.set('selectbyzone',false);$('#mapctrl').find(".section").addClass('on');},undefined,3000);}else{selectByZone();}}
if(status===0){mapType='no-map';}
if(mapT=='no-map'&&mapType!='Interactive'){}else{self.model.set('type',mapType);}
self.loadingMap(false);if(mapType=='Interactive'&&!self.model.mapColored&&self.model.sectiondata){self.colorMap();}
$map.blueprint.centerMap();},beforeMapError:function(errCode){if(errCode===9||errCode===11){self.model.set('type','Static');}else if(errCode===15){self.model.set('type','no-map');}
$('#mapctrl').addClass('hidden');},onMapStatus:function(code){if(code===1){var scope=sandbox.getGVar('exec.showlistfirst_scope')||['1','28','174'];self.model.type=null;if(scope&&scope.indexOf(""+event.channelId)!==-1){}else{sandbox.setGVar('exec.showlistfirst',false,true);}}}});};EventMapController.prototype.getSelectedZones=function(sectionid){var sections=$map.blueprint.getSelectedSections()||[],ret=[];var selectedZones=[];var zoneid;for(var i=sections.length-1;i>=0;i--){zoneid=$map.blueprint.getZoneBySection(sections[i]);if(selectedZones.indexOf(zoneid)==-1){selectedZones.push(zoneid);}};return selectedZones;};EventMapController.prototype.getSelectedSectionData=function(){var sss=$map.blueprint.getSelectedSections()||[],ret=[];for(var i=sss.length;i>0;i--){var sid=sss[i-1]+'';var sec=this.sectionMap&&this.sectionMap[sid]||{sectionId:sid};sec.zoneId=$map.blueprint.getZoneBySection(sid);ret.push(sec);}
return ret;};EventMapController.prototype.colorMap=function(sectiondata){var d=sectiondata||this.model.sectiondata,sections=d.section,sectionIdArray=[];if(!$.isArray(sections)){sections=[sections];}
for(var i=0,l=sections.length;i<l;i++){sectionIdArray.push(""+sections[i].sectionId);}
var allSections=$map.blueprint.getAllSections();var allSectionsLength=Object.keys(allSections).length;if(!this.model.mapColored||sectionIdArray.length>allSectionsLength){$map.blueprint.styleSections(sectionIdArray);this.model.set('mapColored',true);}else{var sss=$map.blueprint.getSelectedSections();if(sectionIdArray.length<allSectionsLength){var toFocus=[];for(var j=0,jm=sss.length;j<jm;j++){var sId=sss[j];if(sectionIdArray.indexOf(sId)!=-1){toFocus.push(sId);}}
$map.blueprint.resetMap();$map.blueprint.styleSections(sectionIdArray);$map.blueprint.filterSections(sectionIdArray);if(toFocus.length>0){$map.blueprint.focusSections(toFocus);}}
if(sectionIdArray.length===0){$map.blueprint.blurSections(sss);}}};EventMapController.prototype.init=function(sandbox){if(typeof this.bindGlobalEvents=='function'){this.bindGlobalEvents(sandbox);}
if(this.view){if(typeof this.bindViewEvents=='function'){this.bindViewEvents(sandbox);}}
this.model.change(function(keys){var m=this.model;if(keys[0]=='event'){this.updateMap(m.event);}else if(keys[0]=='sectiondata'){if(m.type=='Interactive'){if($map.blueprint.isMapReady()){this.colorMap();}
this.updateMapSection.call(this,m.event);}}else if(keys[0]=='type'){sandbox.setGVar("map-type",m.type);C.publish("map-type",m.type);}},this);if(typeof sandbox.getCurrentState=='function'){var state=sandbox.getCurrentState();if(state&&(state.type=='event'||state.type=='section')){this.getDataFromURLState({state:state});}}};EventMapController.prototype.destroy=function(sandbox){if(this.view){if(typeof this.unbindViewEvents=='function'){this.unbindViewEvents(sandbox);}}
if(typeof this.unbindGlobalEvents=='function'){this.unbindGlobalEvents(sandbox);}
this.destroyMap();this.view=null;this.model=null;};EventMapController.prototype.destroyMap=function(){var map=$map||$('#map');if(map&&map.length&&map.blueprint){map.blueprint.destroyMap();}};this.init=function(){opt=sandbox.options||{};container=sandbox.getContainer();$map=$('#map');this.m=new StubHubCore.Model();this.v=new EventMapView(this.m);this.c=new EventMapController(this.m,this.v);this.c.init(sandbox);};this.destroy=function(){};};})(StubHub);(function(SH){SH.Modules.Search=SH.Modules.Search||function(sandbox){var C=sandbox.core,gvar=sandbox.getGVar;var eventlist_opts={prefix:'srch',parentName:'Search',container:'srch-list-wrapper'};var genrelist_opts={prefix:'srch',parent:'Search',container:'srch-genrelist-wrapper',enableStar:true};var tab_opts={prefix:'search',parent:'Search',tabs:'#search_result_header',contents:'#search_result_container',defaultTab:0};var search_keyword="",opts,$container;var isSearchButtonClicked=false;function getOmniOpts(t,es,bh,more){var o={},type=(t==1)?'Event':'Genre',type1=type+'s',bhv=bh?'Performed':'Tap';o.prop63=o.pageName='mWeb: Search Results: '+type1;o.prop11='Search: '+type1;o.prop62='Search '+bhv;if(!more){o.prop61='Search '+type+' '+bhv+': '+o.pageName;}else{o.prop61='Search '+type+': Show more '+type1.toLowerCase()+':'+more;}
o.eVar31=search_keyword;o.prop1='Search';if(es===0){o.events='event17,event18';}else if(es===1){o.events='event17';}
return o;}
function SearchView(){this.constructor.apply(this,arguments);this.render=function(keys){if(keys){if(keys[0]=='location'){$('#search_location').text(sandbox.displayLocation(this.model.location));}
else if(keys[0]=='hasMoreEvent'){if(this.model.hasMoreEvent){$('#search_event_getmore').removeClass('hidden');}else{$('#search_event_getmore').addClass('hidden');}}else if(keys[0]=='hasMoreGenre'){if(this.model.hasMoreGenre){$('#search_genre_getmore').removeClass('hidden');}else{$('#search_genre_getmore').addClass('hidden');}}}};}
SearchView.prototype=new C.View();function SearchCtrl(){this.constructor.apply(this,arguments);var timer;var eKeyword,eStart=0,eRow=5,eNumFound;var gStart=0,gRow=6;C.register('SearchEventList',SH.Modules.EventList,eventlist_opts);C.register('SearchGenreList',SH.Modules.GenreList,genrelist_opts);C.register('SearchTab',SH.Modules.Tab,tab_opts);this.init=function(){bindGlobalEvents.call(this);if(this.view){bindViewEvents.call(this);}
this.model.change(function(keys){if(keys){if(keys[0]=='location'){if(this.model.keywords){goSearch.call(this,this.model.keywords,true);}}else if(keys[0]=='keywords'){this.searchEvents(this.model.keywords,this.model.location.geoId,null);}}},this);var geoLocation=gvar('geo.location')||{geoId:0,geoName:'All locations',position:undefined};this.model.set('location',geoLocation);C.start('SearchEventList');C.start('SearchGenreList');C.start('SearchTab');};this.searchGenres=function(keywords,position){var self=this,start=gStart||0,row=(gRow||6),geoId=this.model.location.geoId||'0',baseUrl=gvar('site.lcsService'),fl='&fl=genre_parent_name,genreUrlPath,genre_parent,channelId,pageType,ancestorGenreIds,ancestorGeoIds,ancestorDescriptions, artistPrimaryStyle, ancestorGenreDescriptions, espnAbbr,gameType,sportsTeam',allowViewDomain='%20AND%20allowedViewingDomain:'+gvar('exec.subDomain'),querytrim=keywords.trim(),genrequerypre=querytrim.replace(/ /g," AND act_primary:"),genrequery='(act_primary:'+genrequerypre+'*) OR (act_primary:"'+querytrim+'"~1000000^10)',queryStr='fq=stubhubDocumentType:event%20AND%20active:1'+
allowViewDomain+'&start='+start+'&rows='+row+fl+'&wt=json&group=true&group.field=eventGenreParentDescription_facet_str&group.main=true&json.wrf=?&q='+genrequery+'&fq=NOT(act_primary:PARKING%20PASSES%20ONLY*)';self.model.set('hasMoreGenre',false);if(geoId!='0'){queryStr+='&sort=geodist()%20asc&sfield=lat_lon&pt='+position+'';}
if(row==6){C.publish('srch-genredata');}
C.publish('srch-genredata-loading');sandbox.getJSON(baseUrl,queryStr,function(data){var resp=data.response,docs=resp.docs,count=resp.docs.length,genredata=[];if(count==row){self.model.set('hasMoreGenre',true);count--;}else{self.model.set('hasMoreGenre',false);}
for(var i=row-6;i<count;i++){var _g=docs[i];var g={ancestorGenreIds:_g.ancestorGenreIds,channelId:_g.channelId,description:_g.genre_parent_name,id:_g.genre_parent,urlpath:_g.genreUrlPath,leaf:true};if(_g.pageType){g.pageType=_g.pageType;}
if(_g.sportsTeam){g.sportsTeam=_g.sportsTeam;}
if(_g.espnAbbr){g.espnAbbr=_g.espnAbbr;}
if(_g.gameType){g.gameType=_g.gameType;}
genredata.push(g);}
if(row==6){C.publish('srch-genredata',genredata);}else{C.publish('srch-genredata-more',genredata);}
var more=parseInt(row/5,10)-1;search_keyword=keywords;if(count===0||isSearchButtonClicked||more){var es=0;if(isSearchButtonClicked&&count!==0){es=1;}
sandbox.setOmnitureVariables(getOmniOpts(2,es,true,more),true);}});};this.searchEvents=function(keywords,geoId){$('#search_result_outside_area').addClass('hidden');geoId=geoId||'0';var self=this,start=eStart||0,row=eRow||5,keyword=keywords,baseUrl=gvar('site.lcsService'),fl='&fl='+gvar('exec.lcsquery.event.minfl')+' minPrice currency_code',allowViewDomain='%20AND%20allowedViewingDomain:'+gvar('exec.subDomain'),querytrim=keywords.trim(),eventquerypre=querytrim.replace(/ /g," AND "),eventquery='('+eventquerypre+'*) OR ("'+querytrim+'"~1000000^10)',queryStr='fq=stubhubDocumentType:event%20AND%20ancestorGenreIds:(28%20OR%20174%20OR%201)%20AND%20event_date:[NOW%20TO%20*]%20AND%20ancestorGeoIds:'+geoId+'%20AND%20active:1%20AND%20NOT%20maxPrice:0.0'+allowViewDomain+'&start='+start+'&rows='+row+fl+'&sort=tickets_1d desc&wt=json&json.wrf=?&q='+eventquery;self.model.set('hasMoreEvent',false);if(start===0){C.publish('srch-eventdata',null);}
C.publish('srch-eventdata-loading');sandbox.getJSON(baseUrl,queryStr,function(data){var resp=data.response,numF=resp.numFound,_start=resp.start,count=resp.docs.length;eStart=_start+count;eNumFound=numF;if(count==0&&geoId!='0'){return self.searchEvents(keywords,'0');}
if(count>0&&geoId=='0'&&self.model.location.geoName!="All locations (US/Canada)"){$('#search_result_outside_area').removeClass('hidden');}
self.model.set('hasMoreEvent',eStart<numF);if(_start===0){C.publish('srch-eventdata',resp.docs);if(resp.docs.length===0){var $con=$('#'+eventlist_opts.container);$con.find('.noresults-keyword').text(keyword);if(self.model.location.geoId=='0'){$con.find('#srch-noresults-1').addClass('hidden');$con.find('#srch-noresults-2').removeClass('hidden');}else{$con.find('#noresults-location').text(sandbox.displayLocation(self.model.location));$con.find('#srch-noresults-2').addClass('hidden');$con.find('#srch-noresults-1').removeClass('hidden');}}}else{C.publish('srch-eventdata-more',resp.docs);}
search_keyword=keywords;var more=parseInt((_start+row-5)/row,10);if(count===0||isSearchButtonClicked||more){var es=0;if(isSearchButtonClicked&&count!==0){es=1;}
sandbox.setOmnitureVariables(getOmniOpts(1,es,true,more),true);}});};function bindViewEvents(){var self=this;$container.find('#search_event_getmore').bind('click.fast',function(){searchMoreEvents.call(self);});$container.find('#search_genre_getmore').bind('click.fast',function(){searchMoreGenres.call(self);});$container.find('form').bind('submit',function(event){event.preventDefault();event.stopPropagation();var keyword=$('#search_keyword').val().toLowerCase();if(!!timer){window.clearTimeout(timer);timer=null;}
isSearchButtonClicked=true;goSearch.call(self,keyword);document.getElementById('search_keyword').blur();});$container.find('#search_button').bind('click.fast',function(event){event.preventDefault();event.stopPropagation();var keyword=$('#search_keyword').val().toLowerCase();if(keyword.trim().length>0){if(!!timer){window.clearTimeout(timer);timer=null;}
isSearchButtonClicked=true;goSearch.call(self,keyword);}});$container.find('#search_clear_button').bind('click.fast',function(event){event.preventDefault();event.stopPropagation();$('#search_keyword').val('');$('#search_clear_wrapper').addClass('hidden');$("#searchresult").addClass('hidden');document.getElementById('search_keyword').focus();});$('#search_keyword').bind('focus',function(){var state=sandbox.getCurrentState(),ui=state&&state.ui;if(ui&&ui.formfactor&&ui.formfactor<=2){setTimeout(function(){window.scrollTo(0,60);},30);}});$('#search_keyword').bind('keyup',function(){var searchKeyword=""+$(this).val().toLowerCase();if(searchKeyword!==""&&searchKeyword.length>1&&!searchKeyword.match(/[ ]+\S?$/)){if(!!timer){window.clearTimeout(timer);timer=null;}
timer=window.setTimeout(function(){isSearchButtonClicked=false;goSearch.call(self,searchKeyword);},300);}
if(searchKeyword.length<=1){if(timer!==null){window.clearTimeout(timer);timer=null;}
$("#searchresult").addClass('hidden');}
if(searchKeyword.length>0){$('#search_clear_wrapper').removeClass('hidden');}else{$('#search_clear_wrapper').addClass('hidden');$("#searchresult").addClass('hidden');}});}
function goSearch(keyword,force){eStart=gStart=0;eNumFound=0;eRow=5;gRow=6;eKeyword=keyword;if(this.model.keywords!=keyword||force){$('#search_genre_getmore').addClass('hidden');$('#search_event_getmore').addClass('hidden');this.model.keywords=keyword;this.searchGenres.call(this,keyword,this.model.location.position);this.searchEvents.call(this,keyword,this.model.location.geoId)
$("#search_result_header").removeClass('hidden');}
$("#searchresult").removeClass('hidden').show();}
function searchMoreEvents(){eRow=25;if(eKeyword){this.searchEvents(eKeyword,this.model.location.geoId);}}
function searchMoreGenres(){gRow=gRow+5;if(eKeyword){this.searchGenres(eKeyword,this.model.location.position);}}
function bindGlobalEvents(){C.subscribe('ui-link-clicked:before',function(d){if(d.prefix==eventlist_opts.prefix){sandbox.setOmnitureVariables(getOmniOpts(d.type,1),true);sandbox.setOmnitureVariables({prop5:''},false);}});C.subscribe('search-tab-selected',function(i){if(i===0){sandbox.setOmnitureVariables({pageName:'mWeb: Search Event',prop1:''},false);sandbox.trackInOmniture("Search Event",null,"search tab touch","search tab touch: Event: "+sandbox.getOmniPageName(),"tab touch");}else{sandbox.setOmnitureVariables({pageName:'mWeb: Search Genre',prop1:''},false);sandbox.trackInOmniture("Search Genre",null,"search tab touch","search tab touch: Genre: "+sandbox.getOmniPageName(),"tab touch");}});C.subscribe('geo-current-location',function(location){if(this.model.location.geoId!=location.geoId){this.model.set('location',location);}},this);C.subscribe('url.update.state',function(data){if(data.state.type=='search'){if($('#search_keyword').val().length>1){$("#searchresult").show();}}else{$("#searchresult").hide();}});}}
SearchCtrl.prototype=new C.Controller();this.init=function(){opts=sandbox.options;$container=$(sandbox.getContainer());this.m=new C.Model();this.v=new SearchView(this.m);this.c=new SearchCtrl(this.m,this.v);this.c.init();};this.destroy=function(){};};})(StubHub);